// @xterm/xterm@5.5.0 downloaded from https://ga.jspm.io/npm:@xterm/xterm@5.5.0/lib/xterm.js

var u=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var f={};!function(u,g){f=g()}(globalThis,(()=>(()=>{var f={4567:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.AccessibilityManager=void 0;const y=m(9042),E=m(9924),L=m(844),R=m(4725),x=m(2585),A=m(3656);let B=g.AccessibilityManager=class extends L.Disposable{constructor(u,f,g,m){super(),this._terminal=u,this._coreBrowserService=g,this._renderService=m,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let u=0;u<this._terminal.rows;u++)this._rowElements[u]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[u]);if(this._topBoundaryFocusListener=u=>this._handleBoundaryFocus(u,0),this._bottomBoundaryFocusListener=u=>this._handleBoundaryFocus(u,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new E.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize((u=>this._handleResize(u.rows)))),this.register(this._terminal.onRender((u=>this._refreshRows(u.start,u.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((u=>this._handleChar(u)))),this.register(this._terminal.onLineFeed((()=>this._handleChar("\n")))),this.register(this._terminal.onA11yTab((u=>this._handleTab(u)))),this.register(this._terminal.onKey((u=>this._handleKey(u.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this.register((0,A.addDisposableDomListener)(document,"selectionchange",(()=>this._handleSelectionChange()))),this.register(this._coreBrowserService.onDprChange((()=>this._refreshRowsDimensions()))),this._refreshRows(),this.register((0,L.toDisposable)((()=>{this._accessibilityContainer.remove(),this._rowElements.length=0})))}_handleTab(u){for(let f=0;f<u;f++)this._handleChar(" ")}_handleChar(u){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==u&&(this._charsToAnnounce+=u):this._charsToAnnounce+=u,"\n"===u&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=y.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(u){this._clearLiveRegion(),/\p{Control}/u.test(u)||this._charsToConsume.push(u)}_refreshRows(u,f){this._liveRegionDebouncer.refresh(u,f,this._terminal.rows)}_renderRows(u,f){const g=this._terminal.buffer,m=g.lines.length.toString();for(let C=u;C<=f;C++){const u=g.lines.get(g.ydisp+C),f=[],b=u?.translateToString(!0,void 0,void 0,f)||"",y=(g.ydisp+C+1).toString(),E=this._rowElements[C];E&&(0===b.length?(E.innerText="Â ",this._rowColumns.set(E,[0,1])):(E.textContent=b,this._rowColumns.set(E,f)),E.setAttribute("aria-posinset",y),E.setAttribute("aria-setsize",m))}this._announceCharacters()}_announceCharacters(){0!==this._charsToAnnounce.length&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(u,f){const g=u.target,m=this._rowElements[0===f?1:this._rowElements.length-2];if(g.getAttribute("aria-posinset")===(0===f?"1":`${this._terminal.buffer.lines.length}`))return;if(u.relatedTarget!==m)return;let C,b;if(0===f?(C=g,b=this._rowElements.pop(),this._rowContainer.removeChild(b)):(C=this._rowElements.shift(),b=g,this._rowContainer.removeChild(C)),C.removeEventListener("focus",this._topBoundaryFocusListener),b.removeEventListener("focus",this._bottomBoundaryFocusListener),0===f){const u=this._createAccessibilityTreeNode();this._rowElements.unshift(u),this._rowContainer.insertAdjacentElement("afterbegin",u)}else{const u=this._createAccessibilityTreeNode();this._rowElements.push(u),this._rowContainer.appendChild(u)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===f?-1:1),this._rowElements[0===f?1:this._rowElements.length-2].focus(),u.preventDefault(),u.stopImmediatePropagation()}_handleSelectionChange(){if(0===this._rowElements.length)return;const u=document.getSelection();if(!u)return;if(u.isCollapsed)return void(this._rowContainer.contains(u.anchorNode)&&this._terminal.clearSelection());if(!u.anchorNode||!u.focusNode)return void console.error("anchorNode and/or focusNode are null");let f={node:u.anchorNode,offset:u.anchorOffset},g={node:u.focusNode,offset:u.focusOffset};if((f.node.compareDocumentPosition(g.node)&Node.DOCUMENT_POSITION_PRECEDING||f.node===g.node&&f.offset>g.offset)&&([f,g]=[g,f]),f.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(f={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(f.node))return;const m=this._rowElements.slice(-1)[0];if(g.node.compareDocumentPosition(m)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(g={node:m,offset:m.textContent?.length??0}),!this._rowContainer.contains(g.node))return;const r=({node:u,offset:f})=>{const g=u instanceof Text?u.parentNode:u;let m=parseInt(g?.getAttribute("aria-posinset"),10)-1;if(isNaN(m))return console.warn("row is invalid. Race condition?"),null;const C=this._rowColumns.get(g);if(!C)return console.warn("columns is null. Race condition?"),null;let b=f<C.length?C[f]:C.slice(-1)[0]+1;return b>=this._terminal.cols&&(++m,b=0),{row:m,column:b}},C=r(f),b=r(g);if(C&&b){if(C.row>b.row||C.row===b.row&&C.column>=b.column)throw new Error("invalid range");this._terminal.select(C.column,C.row,(b.row-C.row)*this._terminal.cols-C.column+b.column)}}_handleResize(u){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let u=this._rowContainer.children.length;u<this._terminal.rows;u++)this._rowElements[u]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[u]);for(;this._rowElements.length>u;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const u=this._coreBrowserService.mainDocument.createElement("div");return u.setAttribute("role","listitem"),u.tabIndex=-1,this._refreshRowDimensions(u),u}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let u=0;u<this._terminal.rows;u++)this._refreshRowDimensions(this._rowElements[u])}}_refreshRowDimensions(u){u.style.height=`${this._renderService.dimensions.css.cell.height}px`}};g.AccessibilityManager=B=C([b(1,x.IInstantiationService),b(2,R.ICoreBrowserService),b(3,R.IRenderService)],B)},3614:(u,f)=>{function i(u){return u.replace(/\r?\n/g,"\r")}function s(u,f){return f?"[200~"+u+"[201~":u}function r(u,f,g,m){u=s(u=i(u),g.decPrivateModes.bracketedPasteMode&&!0!==m.rawOptions.ignoreBracketedPasteMode),g.triggerDataEvent(u,!0),f.value=""}function n(u,f,g){const m=g.getBoundingClientRect(),C=u.clientX-m.left-10,b=u.clientY-m.top-10;f.style.width="20px",f.style.height="20px",f.style.left=`${C}px`,f.style.top=`${b}px`,f.style.zIndex="1000",f.focus()}Object.defineProperty(f,"__esModule",{value:!0}),f.rightClickHandler=f.moveTextAreaUnderMouseCursor=f.paste=f.handlePasteEvent=f.copyHandler=f.bracketTextForPaste=f.prepareTextForTerminal=void 0,f.prepareTextForTerminal=i,f.bracketTextForPaste=s,f.copyHandler=function(u,f){u.clipboardData&&u.clipboardData.setData("text/plain",f.selectionText),u.preventDefault()},f.handlePasteEvent=function(u,f,g,m){u.stopPropagation(),u.clipboardData&&r(u.clipboardData.getData("text/plain"),f,g,m)},f.paste=r,f.moveTextAreaUnderMouseCursor=n,f.rightClickHandler=function(u,f,g,m,C){n(u,f,g),C&&m.rightClickSelect(u),f.value=m.selectionText,f.select()}},7239:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.ColorContrastCache=void 0;const m=g(1505);f.ColorContrastCache=class{constructor(){this._color=new m.TwoKeyMap,this._css=new m.TwoKeyMap}setCss(u,f,g){this._css.set(u,f,g)}getCss(u,f){return this._css.get(u,f)}setColor(u,f,g){this._color.set(u,f,g)}getColor(u,f){return this._color.get(u,f)}clear(){this._color.clear(),this._css.clear()}}},3656:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.addDisposableDomListener=void 0,f.addDisposableDomListener=function(u,f,g,m){u.addEventListener(f,g,m);let C=!1;return{dispose:()=>{C||(C=!0,u.removeEventListener(f,g,m))}}}},3551:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.Linkifier=void 0;const y=m(3656),E=m(8460),L=m(844),R=m(2585),x=m(4725);let A=g.Linkifier=class extends L.Disposable{get currentLink(){return this._currentLink}constructor(u,f,g,m,C){super(),this._element=u,this._mouseService=f,this._renderService=g,this._bufferService=m,this._linkProviderService=C,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new E.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new E.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,L.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,L.toDisposable)((()=>{this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()}))),this.register(this._bufferService.onResize((()=>{this._clearCurrentLink(),this._wasResized=!0}))),this.register((0,y.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,y.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,y.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,y.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(u){this._lastMouseEvent=u;const f=this._positionFromMouseEvent(u,this._element,this._mouseService);if(!f)return;this._isMouseOut=!1;const g=u.composedPath();for(let u=0;u<g.length;u++){const f=g[u];if(f.classList.contains("xterm"))break;if(f.classList.contains("xterm-hover"))return}this._lastBufferCell&&f.x===this._lastBufferCell.x&&f.y===this._lastBufferCell.y||(this._handleHover(f),this._lastBufferCell=f)}_handleHover(u){if(this._activeLine!==u.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(u,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,u)||(this._clearCurrentLink(),this._askForLink(u,!0))}_askForLink(u,f){this._activeProviderReplies&&f||(this._activeProviderReplies?.forEach((u=>{u?.forEach((u=>{u.link.dispose&&u.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=u.y);let g=!1;for(const[m,C]of this._linkProviderService.linkProviders.entries())if(f){const f=this._activeProviderReplies?.get(m);f&&(g=this._checkLinkProviderResult(m,u,g))}else C.provideLinks(u.y,(f=>{if(this._isMouseOut)return;const C=f?.map((u=>({link:u})));this._activeProviderReplies?.set(m,C),g=this._checkLinkProviderResult(m,u,g),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(u.y,this._activeProviderReplies)}))}_removeIntersectingLinks(u,f){const g=new Set;for(let m=0;m<f.size;m++){const C=f.get(m);if(C)for(let f=0;f<C.length;f++){const m=C[f],b=m.link.range.start.y<u?0:m.link.range.start.x,y=m.link.range.end.y>u?this._bufferService.cols:m.link.range.end.x;for(let u=b;u<=y;u++){if(g.has(u)){C.splice(f--,1);break}g.add(u)}}}}_checkLinkProviderResult(u,f,g){if(!this._activeProviderReplies)return g;const m=this._activeProviderReplies.get(u);let C=!1;for(let f=0;f<u;f++)this._activeProviderReplies.has(f)&&!this._activeProviderReplies.get(f)||(C=!0);if(!C&&m){const u=m.find((u=>this._linkAtPosition(u.link,f)));u&&(g=!0,this._handleNewLink(u))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!g)for(let u=0;u<this._activeProviderReplies.size;u++){const m=this._activeProviderReplies.get(u)?.find((u=>this._linkAtPosition(u.link,f)));if(m){g=!0,this._handleNewLink(m);break}}return g}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(u){if(!this._currentLink)return;const f=this._positionFromMouseEvent(u,this._element,this._mouseService);f&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,f)&&this._currentLink.link.activate(u,this._currentLink.link.text)}_clearCurrentLink(u,f){this._currentLink&&this._lastMouseEvent&&(!u||!f||this._currentLink.link.range.start.y>=u&&this._currentLink.link.range.end.y<=f)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,L.disposeArray)(this._linkCacheDisposables))}_handleNewLink(u){if(!this._lastMouseEvent)return;const f=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);f&&this._linkAtPosition(u.link,f)&&(this._currentLink=u,this._currentLink.state={decorations:{underline:void 0===u.link.decorations||u.link.decorations.underline,pointerCursor:void 0===u.link.decorations||u.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,u.link,this._lastMouseEvent),u.link.decorations={},Object.defineProperties(u.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:u=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==u&&(this._currentLink.state.decorations.pointerCursor=u,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",u))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:f=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==f&&(this._currentLink.state.decorations.underline=f,this._currentLink.state.isHovered&&this._fireUnderlineEvent(u.link,f))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((u=>{if(!this._currentLink)return;const f=0===u.start?0:u.start+1+this._bufferService.buffer.ydisp,g=this._bufferService.buffer.ydisp+1+u.end;if(this._currentLink.link.range.start.y>=f&&this._currentLink.link.range.end.y<=g&&(this._clearCurrentLink(f,g),this._lastMouseEvent)){const u=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);u&&this._askForLink(u,!1)}}))))}_linkHover(u,f,g){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(f,!0),this._currentLink.state.decorations.pointerCursor&&u.classList.add("xterm-cursor-pointer")),f.hover&&f.hover(g,f.text)}_fireUnderlineEvent(u,f){const g=u.range,m=this._bufferService.buffer.ydisp,C=this._createLinkUnderlineEvent(g.start.x-1,g.start.y-m-1,g.end.x,g.end.y-m-1,void 0);(f?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(C)}_linkLeave(u,f,g){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(f,!1),this._currentLink.state.decorations.pointerCursor&&u.classList.remove("xterm-cursor-pointer")),f.leave&&f.leave(g,f.text)}_linkAtPosition(u,f){const g=u.range.start.y*this._bufferService.cols+u.range.start.x,m=u.range.end.y*this._bufferService.cols+u.range.end.x,C=f.y*this._bufferService.cols+f.x;return g<=C&&C<=m}_positionFromMouseEvent(u,f,g){const m=g.getCoords(u,f,this._bufferService.cols,this._bufferService.rows);if(m)return{x:m[0],y:m[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(u,f,g,m,C){return{x1:u,y1:f,x2:g,y2:m,cols:this._bufferService.cols,fg:C}}};g.Linkifier=A=C([b(1,x.IMouseService),b(2,x.IRenderService),b(3,R.IBufferService),b(4,x.ILinkProviderService)],A)},9042:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.tooMuchOutput=f.promptLabel=void 0,f.promptLabel="Terminal input",f.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.OscLinkProvider=void 0;const y=m(511),E=m(2585);let L=g.OscLinkProvider=class{constructor(u,f,g){this._bufferService=u,this._optionsService=f,this._oscLinkService=g}provideLinks(u,f){const g=this._bufferService.buffer.lines.get(u-1);if(!g)return void f(void 0);const m=[],C=this._optionsService.rawOptions.linkHandler,b=new y.CellData,E=g.getTrimmedLength();let L=-1,R=-1,x=!1;for(let f=0;f<E;f++)if(-1!==R||g.hasContent(f)){if(g.loadCell(f,b),b.hasExtendedAttrs()&&b.extended.urlId){if(-1===R){R=f,L=b.extended.urlId;continue}x=b.extended.urlId!==L}else-1!==R&&(x=!0);if(x||-1!==R&&f===E-1){const g=this._oscLinkService.getLinkData(L)?.uri;if(g){const b={start:{x:R+1,y:u},end:{x:f+(x||f!==E-1?0:1),y:u}};let y=!1;if(!C?.allowNonHttpProtocols)try{const u=new URL(g);["http:","https:"].includes(u.protocol)||(y=!0)}catch(u){y=!0}y||m.push({text:g,range:b,activate:(u,f)=>C?C.activate(u,f,b):h(0,f),hover:(u,f)=>C?.hover?.(u,f,b),leave:(u,f)=>C?.leave?.(u,f,b)})}x=!1,b.hasExtendedAttrs()&&b.extended.urlId?(R=f,L=b.extended.urlId):(R=-1,L=-1)}}f(m)}};function h(u,f){if(confirm(`Do you want to navigate to ${f}?\n\nWARNING: This link could potentially be dangerous`)){const u=window.open();if(u){try{u.opener=null}catch{}u.location.href=f}else console.warn("Opening link blocked as opener could not be cleared")}}g.OscLinkProvider=L=C([b(0,E.IBufferService),b(1,E.IOptionsService),b(2,E.IOscLinkService)],L)},6193:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.RenderDebouncer=void 0,f.RenderDebouncer=class{constructor(u,f){this._renderCallback=u,this._coreBrowserService=f,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(u){return this._refreshCallbacks.push(u),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(u,f,g){this._rowCount=g,u=void 0!==u?u:0,f=void 0!==f?f:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,u):u,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,f):f,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return void this._runRefreshCallbacks();const u=Math.max(this._rowStart,0),f=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(u,f),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const u of this._refreshCallbacks)u(0);this._refreshCallbacks=[]}}},3236:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Terminal=void 0;const m=g(3614),C=g(3656),b=g(3551),y=g(9042),E=g(3730),L=g(1680),R=g(3107),x=g(5744),A=g(2950),B=g(1296),T=g(428),M=g(4269),O=g(5114),I=g(8934),H=g(3230),F=g(9312),W=g(4725),U=g(6731),N=g(8055),$=g(8969),j=g(8460),z=g(844),K=g(6114),q=g(8437),V=g(2584),G=g(7399),X=g(5941),J=g(9074),Y=g(2585),Z=g(5435),Q=g(4567),ee=g(779);class P extends $.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(u={}){super(u),this.browser=K,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new z.MutableDisposable),this._onCursorMove=this.register(new j.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new j.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new j.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new j.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new j.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new j.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new j.EventEmitter),this._onBlur=this.register(new j.EventEmitter),this._onA11yCharEmitter=this.register(new j.EventEmitter),this._onA11yTabEmitter=this.register(new j.EventEmitter),this._onWillOpen=this.register(new j.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(J.DecorationService),this._instantiationService.setService(Y.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(ee.LinkProviderService),this._instantiationService.setService(W.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(E.OscLinkProvider)),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((u,f)=>this.refresh(u,f)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((u=>this._reportWindowsOptions(u)))),this.register(this._inputHandler.onColor((u=>this._handleColorEvent(u)))),this.register((0,j.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,j.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,j.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,j.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((u=>this._afterResize(u.cols,u.rows)))),this.register((0,z.toDisposable)((()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)})))}_handleColorEvent(u){if(this._themeService)for(const f of u){let u,g="";switch(f.index){case 256:u="foreground",g="10";break;case 257:u="background",g="11";break;case 258:u="cursor",g="12";break;default:u="ansi",g="4;"+f.index}switch(f.type){case 0:const m=N.color.toColorRGB("ansi"===u?this._themeService.colors.ansi[f.index]:this._themeService.colors[u]);this.coreService.triggerDataEvent(`${V.C0.ESC}]${g};${(0,X.toRgbString)(m)}${V.C1_ESCAPED.ST}`);break;case 1:if("ansi"===u)this._themeService.modifyColors((u=>u.ansi[f.index]=N.channels.toColor(...f.color)));else{const g=u;this._themeService.modifyColors((u=>u[g]=N.channels.toColor(...f.color)))}break;case 2:this._themeService.restoreColor(f.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(u){u?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(Q.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(u){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(V.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(V.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const u=this.buffer.ybase+this.buffer.y,f=this.buffer.lines.get(u);if(!f)return;const g=Math.min(this.buffer.x,this.cols-1),m=this._renderService.dimensions.css.cell.height,C=f.getWidth(g),b=this._renderService.dimensions.css.cell.width*C,y=this.buffer.y*this._renderService.dimensions.css.cell.height,E=g*this._renderService.dimensions.css.cell.width;this.textarea.style.left=E+"px",this.textarea.style.top=y+"px",this.textarea.style.width=b+"px",this.textarea.style.height=m+"px",this.textarea.style.lineHeight=m+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,C.addDisposableDomListener)(this.element,"copy",(u=>{this.hasSelection()&&(0,m.copyHandler)(u,this._selectionService)})));const e=u=>(0,m.handlePasteEvent)(u,this.textarea,this.coreService,this.optionsService);this.register((0,C.addDisposableDomListener)(this.textarea,"paste",e)),this.register((0,C.addDisposableDomListener)(this.element,"paste",e)),K.isFirefox?this.register((0,C.addDisposableDomListener)(this.element,"mousedown",(u=>{2===u.button&&(0,m.rightClickHandler)(u,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,C.addDisposableDomListener)(this.element,"contextmenu",(u=>{(0,m.rightClickHandler)(u,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),K.isLinux&&this.register((0,C.addDisposableDomListener)(this.element,"auxclick",(u=>{1===u.button&&(0,m.moveTextAreaUnderMouseCursor)(u,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,C.addDisposableDomListener)(this.textarea,"keyup",(u=>this._keyUp(u)),!0)),this.register((0,C.addDisposableDomListener)(this.textarea,"keydown",(u=>this._keyDown(u)),!0)),this.register((0,C.addDisposableDomListener)(this.textarea,"keypress",(u=>this._keyPress(u)),!0)),this.register((0,C.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,C.addDisposableDomListener)(this.textarea,"compositionupdate",(u=>this._compositionHelper.compositionupdate(u)))),this.register((0,C.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,C.addDisposableDomListener)(this.textarea,"input",(u=>this._inputEvent(u)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(u){if(!u)throw new Error("Terminal requires a parent element.");if(u.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=u.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),u.appendChild(this.element);const f=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),f.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,C.addDisposableDomListener)(this.screenElement,"mousemove",(u=>this.updateCursorStyle(u)))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),f.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",y.promptLabel),K.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(O.CoreBrowserService,this.textarea,u.ownerDocument.defaultView??window,this._document??"undefined"!=typeof window?window.document:null)),this._instantiationService.setService(W.ICoreBrowserService,this._coreBrowserService),this.register((0,C.addDisposableDomListener)(this.textarea,"focus",(u=>this._handleTextAreaFocus(u)))),this.register((0,C.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(T.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(W.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(U.ThemeService),this._instantiationService.setService(W.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(M.CharacterJoinerService),this._instantiationService.setService(W.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(H.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(W.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((u=>this._onRender.fire(u)))),this.onResize((u=>this._renderService.resize(u.cols,u.rows))),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(A.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(I.MouseService),this._instantiationService.setService(W.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(b.Linkifier,this.screenElement)),this.element.appendChild(f);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(L.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((u=>this.scrollLines(u.amount,u.suppressScrollEvent,1))),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(F.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(W.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((u=>this.scrollLines(u.amount,u.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((u=>this._renderService.handleSelectionChanged(u.start,u.end,u.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((u=>{this.textarea.value=u,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((u=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,C.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.register(this._instantiationService.createInstance(R.BufferDecorationRenderer,this.screenElement)),this.register((0,C.addDisposableDomListener)(this.element,"mousedown",(u=>this._selectionService.handleMouseDown(u)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(Q.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(u=>this._handleScreenReaderModeOptionChange(u)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(x.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(u=>{!this._overviewRulerRenderer&&u&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(x.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(B.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const u=this,f=this.element;function i(f){const g=u._mouseService.getMouseReportCoords(f,u.screenElement);if(!g)return!1;let m,C;switch(f.overrideType||f.type){case"mousemove":C=32,void 0===f.buttons?(m=3,void 0!==f.button&&(m=f.button<3?f.button:3)):m=1&f.buttons?0:4&f.buttons?1:2&f.buttons?2:3;break;case"mouseup":C=0,m=f.button<3?f.button:3;break;case"mousedown":C=1,m=f.button<3?f.button:3;break;case"wheel":if(u._customWheelEventHandler&&!1===u._customWheelEventHandler(f))return!1;if(0===u.viewport.getLinesScrolled(f))return!1;C=f.deltaY<0?0:1,m=4;break;default:return!1}return!(void 0===C||void 0===m||m>4)&&u.coreMouseService.triggerMouseEvent({col:g.col,row:g.row,x:g.x,y:g.y,button:m,action:C,ctrl:f.ctrlKey,alt:f.altKey,shift:f.shiftKey})}const g={mouseup:null,wheel:null,mousedrag:null,mousemove:null},m={mouseup:u=>(i(u),u.buttons||(this._document.removeEventListener("mouseup",g.mouseup),g.mousedrag&&this._document.removeEventListener("mousemove",g.mousedrag)),this.cancel(u)),wheel:u=>(i(u),this.cancel(u,!0)),mousedrag:u=>{u.buttons&&i(u)},mousemove:u=>{u.buttons||i(u)}};this.register(this.coreMouseService.onProtocolChange((u=>{u?("debug"===this.optionsService.rawOptions.logLevel&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(u)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&u?g.mousemove||(f.addEventListener("mousemove",m.mousemove),g.mousemove=m.mousemove):(f.removeEventListener("mousemove",g.mousemove),g.mousemove=null),16&u?g.wheel||(f.addEventListener("wheel",m.wheel,{passive:!1}),g.wheel=m.wheel):(f.removeEventListener("wheel",g.wheel),g.wheel=null),2&u?g.mouseup||(g.mouseup=m.mouseup):(this._document.removeEventListener("mouseup",g.mouseup),g.mouseup=null),4&u?g.mousedrag||(g.mousedrag=m.mousedrag):(this._document.removeEventListener("mousemove",g.mousedrag),g.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,C.addDisposableDomListener)(f,"mousedown",(u=>{if(u.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(u))return i(u),g.mouseup&&this._document.addEventListener("mouseup",g.mouseup),g.mousedrag&&this._document.addEventListener("mousemove",g.mousedrag),this.cancel(u)}))),this.register((0,C.addDisposableDomListener)(f,"wheel",(u=>{if(!g.wheel){if(this._customWheelEventHandler&&!1===this._customWheelEventHandler(u))return!1;if(!this.buffer.hasScrollback){const f=this.viewport.getLinesScrolled(u);if(0===f)return;const g=V.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(u.deltaY<0?"A":"B");let m="";for(let u=0;u<Math.abs(f);u++)m+=g;return this.coreService.triggerDataEvent(m,!0),this.cancel(u,!0)}return this.viewport.handleWheel(u)?this.cancel(u):void 0}}),{passive:!1})),this.register((0,C.addDisposableDomListener)(f,"touchstart",(u=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(u),this.cancel(u)}),{passive:!0})),this.register((0,C.addDisposableDomListener)(f,"touchmove",(u=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(u)?void 0:this.cancel(u)}),{passive:!1}))}refresh(u,f){this._renderService?.refreshRows(u,f)}updateCursorStyle(u){this._selectionService?.shouldColumnSelect(u)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(u,f,g=0){1===g?(super.scrollLines(u,f,g),this.refresh(0,this.rows-1)):this.viewport?.scrollLines(u)}paste(u){(0,m.paste)(u,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(u){this._customKeyEventHandler=u}attachCustomWheelEventHandler(u){this._customWheelEventHandler=u}registerLinkProvider(u){return this._linkProviderService.registerLinkProvider(u)}registerCharacterJoiner(u){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const f=this._characterJoinerService.register(u);return this.refresh(0,this.rows-1),f}deregisterCharacterJoiner(u){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(u)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(u){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+u)}registerDecoration(u){return this._decorationService.registerDecoration(u)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(u,f,g){this._selectionService.setSelection(u,f,g)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(u,f){this._selectionService?.selectLines(u,f)}_keyDown(u){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&!1===this._customKeyEventHandler(u))return!1;const f=this.browser.isMac&&this.options.macOptionIsMeta&&u.altKey;if(!f&&!this._compositionHelper.keydown(u))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;f||"Dead"!==u.key&&"AltGraph"!==u.key||(this._unprocessedDeadKey=!0);const g=(0,G.evaluateKeyboardEvent)(u,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(u),3===g.type||2===g.type){const f=this.rows-1;return this.scrollLines(2===g.type?-f:f),this.cancel(u,!0)}return 1===g.type&&this.selectAll(),!!this._isThirdLevelShift(this.browser,u)||(g.cancel&&this.cancel(u,!0),!g.key||!!(u.key&&!u.ctrlKey&&!u.altKey&&!u.metaKey&&1===u.key.length&&u.key.charCodeAt(0)>=65&&u.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(g.key!==V.C0.ETX&&g.key!==V.C0.CR||(this.textarea.value=""),this._onKey.fire({key:g.key,domEvent:u}),this._showCursor(),this.coreService.triggerDataEvent(g.key,!0),!this.optionsService.rawOptions.screenReaderMode||u.altKey||u.ctrlKey?this.cancel(u,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(u,f){const g=u.isMac&&!this.options.macOptionIsMeta&&f.altKey&&!f.ctrlKey&&!f.metaKey||u.isWindows&&f.altKey&&f.ctrlKey&&!f.metaKey||u.isWindows&&f.getModifierState("AltGraph");return"keypress"===f.type?g:g&&(!f.keyCode||f.keyCode>47)}_keyUp(u){this._keyDownSeen=!1,this._customKeyEventHandler&&!1===this._customKeyEventHandler(u)||(function(u){return 16===u.keyCode||17===u.keyCode||18===u.keyCode}(u)||this.focus(),this.updateCursorStyle(u),this._keyPressHandled=!1)}_keyPress(u){let f;if(this._keyPressHandled=!1,this._keyDownHandled)return!1;if(this._customKeyEventHandler&&!1===this._customKeyEventHandler(u))return!1;if(this.cancel(u),u.charCode)f=u.charCode;else if(null===u.which||void 0===u.which)f=u.keyCode;else{if(0===u.which||0===u.charCode)return!1;f=u.which}return!(!f||(u.altKey||u.ctrlKey||u.metaKey)&&!this._isThirdLevelShift(this.browser,u)||(f=String.fromCharCode(f),this._onKey.fire({key:f,domEvent:u}),this._showCursor(),this.coreService.triggerDataEvent(f,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(u){if(u.data&&"insertText"===u.inputType&&(!u.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const f=u.data;return this.coreService.triggerDataEvent(f,!0),this.cancel(u),!0}return!1}resize(u,f){u!==this.cols||f!==this.rows?super.resize(u,f):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(u,f){this._charSizeService?.measure(),this.viewport?.syncScrollArea(!0)}clear(){if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let u=1;u<this.rows;u++)this.buffer.lines.push(this.buffer.getBlankLine(q.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),this.viewport?.reset(),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;const u=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this.viewport?.reset(),this._customKeyEventHandler=u,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(V.C0.ESC+"[I"):this.coreService.triggerDataEvent(V.C0.ESC+"[O")}_reportWindowsOptions(u){if(this._renderService)switch(u){case Z.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const u=this._renderService.dimensions.css.canvas.width.toFixed(0),f=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${V.C0.ESC}[4;${f};${u}t`);break;case Z.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const g=this._renderService.dimensions.css.cell.width.toFixed(0),m=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${V.C0.ESC}[6;${m};${g}t`)}}cancel(u,f){if(this.options.cancelEvents||f)return u.preventDefault(),u.stopPropagation(),!1}}f.Terminal=P},9924:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.TimeBasedDebouncer=void 0,f.TimeBasedDebouncer=class{constructor(u,f=1e3){this._renderCallback=u,this._debounceThresholdMS=f,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(u,f,g){this._rowCount=g,u=void 0!==u?u:0,f=void 0!==f?f:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,u):u,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,f):f;const m=Date.now();if(m-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=m,this._innerRefresh();else if(!this._additionalRefreshRequested){const u=m-this._lastRefreshMs,f=this._debounceThresholdMS-u;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),f)}}_innerRefresh(){if(void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return;const u=Math.max(this._rowStart,0),f=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(u,f)}}},1680:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.Viewport=void 0;const y=m(3656),E=m(4725),L=m(8460),R=m(844),x=m(2585);let A=g.Viewport=class extends R.Disposable{constructor(u,f,g,m,C,b,E,R){super(),this._viewportElement=u,this._scrollArea=f,this._bufferService=g,this._optionsService=m,this._charSizeService=C,this._renderService=b,this._coreBrowserService=E,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new L.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,y.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((u=>this._activeBuffer=u.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((u=>this._renderDimensions=u))),this._handleThemeChange(R.colors),this.register(R.onChangeColors((u=>this._handleThemeChange(u)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()))}_handleThemeChange(u){this._viewportElement.style.backgroundColor=u.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame((()=>this.syncScrollArea()))}_refresh(u){if(u)return this._innerRefresh(),void(null!==this._refreshAnimationFrame&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));null===this._refreshAnimationFrame&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const u=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==u&&(this._lastRecordedBufferHeight=u,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const u=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==u&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=u),this._refreshAnimationFrame=null}syncScrollArea(u=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(u);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(u)}_handleScroll(u){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const f=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:f,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||-1===this._smoothScrollState.origin||-1===this._smoothScrollState.target)return;const u=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(u*(this._smoothScrollState.target-this._smoothScrollState.origin)),u<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(u,f){const g=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(f<0&&0!==this._viewportElement.scrollTop||f>0&&g<this._lastRecordedBufferHeight)||(u.cancelable&&u.preventDefault(),!1)}handleWheel(u){const f=this._getPixelsScrolled(u);return 0!==f&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,-1===this._smoothScrollState.target?this._smoothScrollState.target=this._viewportElement.scrollTop+f:this._smoothScrollState.target+=f,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=f,this._bubbleScroll(u,f))}scrollLines(u){if(0!==u)if(this._optionsService.rawOptions.smoothScrollDuration){const f=u*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+f,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:u,suppressScrollEvent:!1})}_getPixelsScrolled(u){if(0===u.deltaY||u.shiftKey)return 0;let f=this._applyScrollModifier(u.deltaY,u);return u.deltaMode===WheelEvent.DOM_DELTA_LINE?f*=this._currentRowHeight:u.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(f*=this._currentRowHeight*this._bufferService.rows),f}getBufferElements(u,f){let g,m="";const C=[],b=f??this._bufferService.buffer.lines.length,y=this._bufferService.buffer.lines;for(let f=u;f<b;f++){const u=y.get(f);if(!u)continue;const b=y.get(f+1)?.isWrapped;if(m+=u.translateToString(!b),!b||f===y.length-1){const u=document.createElement("div");u.textContent=m,C.push(u),m.length>0&&(g=u),m=""}}return{bufferElements:C,cursorElement:g}}getLinesScrolled(u){if(0===u.deltaY||u.shiftKey)return 0;let f=this._applyScrollModifier(u.deltaY,u);return u.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(f/=this._currentRowHeight+0,this._wheelPartialScroll+=f,f=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):u.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(f*=this._bufferService.rows),f}_applyScrollModifier(u,f){const g=this._optionsService.rawOptions.fastScrollModifier;return"alt"===g&&f.altKey||"ctrl"===g&&f.ctrlKey||"shift"===g&&f.shiftKey?u*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:u*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(u){this._lastTouchY=u.touches[0].pageY}handleTouchMove(u){const f=this._lastTouchY-u.touches[0].pageY;return this._lastTouchY=u.touches[0].pageY,0!==f&&(this._viewportElement.scrollTop+=f,this._bubbleScroll(u,f))}};g.Viewport=A=C([b(2,x.IBufferService),b(3,x.IOptionsService),b(4,E.ICharSizeService),b(5,E.IRenderService),b(6,E.ICoreBrowserService),b(7,E.IThemeService)],A)},3107:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.BufferDecorationRenderer=void 0;const y=m(4725),E=m(844),L=m(2585);let R=g.BufferDecorationRenderer=class extends E.Disposable{constructor(u,f,g,m,C){super(),this._screenElement=u,this._bufferService=f,this._coreBrowserService=g,this._decorationService=m,this._renderService=C,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((u=>this._removeDecoration(u)))),this.register((0,E.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){void 0===this._animationFrame&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(const u of this._decorationService.decorations)this._renderDecoration(u);this._dimensionsChanged=!1}_renderDecoration(u){this._refreshStyle(u),this._dimensionsChanged&&this._refreshXPosition(u)}_createElement(u){const f=this._coreBrowserService.mainDocument.createElement("div");f.classList.add("xterm-decoration"),f.classList.toggle("xterm-decoration-top-layer","top"===u?.options?.layer),f.style.width=`${Math.round((u.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,f.style.height=(u.options.height||1)*this._renderService.dimensions.css.cell.height+"px",f.style.top=(u.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",f.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const g=u.options.x??0;return g&&g>this._bufferService.cols&&(f.style.display="none"),this._refreshXPosition(u,f),f}_refreshStyle(u){const f=u.marker.line-this._bufferService.buffers.active.ydisp;if(f<0||f>=this._bufferService.rows)u.element&&(u.element.style.display="none",u.onRenderEmitter.fire(u.element));else{let g=this._decorationElements.get(u);g||(g=this._createElement(u),u.element=g,this._decorationElements.set(u,g),this._container.appendChild(g),u.onDispose((()=>{this._decorationElements.delete(u),g.remove()}))),g.style.top=f*this._renderService.dimensions.css.cell.height+"px",g.style.display=this._altBufferIsActive?"none":"block",u.onRenderEmitter.fire(g)}}_refreshXPosition(u,f=u.element){if(!f)return;const g=u.options.x??0;"right"===(u.options.anchor||"left")?f.style.right=g?g*this._renderService.dimensions.css.cell.width+"px":"":f.style.left=g?g*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(u){this._decorationElements.get(u)?.remove(),this._decorationElements.delete(u),u.dispose()}};g.BufferDecorationRenderer=R=C([b(1,L.IBufferService),b(2,y.ICoreBrowserService),b(3,L.IDecorationService),b(4,y.IRenderService)],R)},5871:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.ColorZoneStore=void 0,f.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(u){if(u.options.overviewRulerOptions){for(const f of this._zones)if(f.color===u.options.overviewRulerOptions.color&&f.position===u.options.overviewRulerOptions.position){if(this._lineIntersectsZone(f,u.marker.line))return;if(this._lineAdjacentToZone(f,u.marker.line,u.options.overviewRulerOptions.position))return void this._addLineToZone(f,u.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=u.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=u.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=u.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=u.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:u.options.overviewRulerOptions.color,position:u.options.overviewRulerOptions.position,startBufferLine:u.marker.line,endBufferLine:u.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(u){this._linePadding=u}_lineIntersectsZone(u,f){return f>=u.startBufferLine&&f<=u.endBufferLine}_lineAdjacentToZone(u,f,g){return f>=u.startBufferLine-this._linePadding[g||"full"]&&f<=u.endBufferLine+this._linePadding[g||"full"]}_addLineToZone(u,f){u.startBufferLine=Math.min(u.startBufferLine,f),u.endBufferLine=Math.max(u.endBufferLine,f)}}},5744:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.OverviewRulerRenderer=void 0;const y=m(5871),E=m(4725),L=m(844),R=m(2585),x={full:0,left:0,center:0,right:0},A={full:0,left:0,center:0,right:0},B={full:0,left:0,center:0,right:0};let T=g.OverviewRulerRenderer=class extends L.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(u,f,g,m,C,b,E){super(),this._viewportElement=u,this._screenElement=f,this._bufferService=g,this._decorationService=m,this._renderService=C,this._optionsService=b,this._coreBrowserService=E,this._colorZoneStore=new y.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement);const R=this._canvas.getContext("2d");if(!R)throw new Error("Ctx cannot be null");this._ctx=R,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,L.toDisposable)((()=>{this._canvas?.remove()})))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){const u=Math.floor(this._canvas.width/3),f=Math.ceil(this._canvas.width/3);A.full=this._canvas.width,A.left=u,A.center=f,A.right=u,this._refreshDrawHeightConstants(),B.full=0,B.left=0,B.center=A.left,B.right=A.left+A.center}_refreshDrawHeightConstants(){x.full=Math.round(2*this._coreBrowserService.dpr);const u=this._canvas.height/this._bufferService.buffer.lines.length,f=Math.round(Math.max(Math.min(u,12),6)*this._coreBrowserService.dpr);x.left=f,x.center=f,x.right=f}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*x.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*x.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*x.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*x.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const u of this._decorationService.decorations)this._colorZoneStore.addDecoration(u);this._ctx.lineWidth=1;const u=this._colorZoneStore.zones;for(const f of u)"full"!==f.position&&this._renderColorZone(f);for(const f of u)"full"===f.position&&this._renderColorZone(f);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(u){this._ctx.fillStyle=u.color,this._ctx.fillRect(B[u.position||"full"],Math.round((this._canvas.height-1)*(u.startBufferLine/this._bufferService.buffers.active.lines.length)-x[u.position||"full"]/2),A[u.position||"full"],Math.round((this._canvas.height-1)*((u.endBufferLine-u.startBufferLine)/this._bufferService.buffers.active.lines.length)+x[u.position||"full"]))}_queueRefresh(u,f){this._shouldUpdateDimensions=u||this._shouldUpdateDimensions,this._shouldUpdateAnchor=f||this._shouldUpdateAnchor,void 0===this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};g.OverviewRulerRenderer=T=C([b(2,R.IBufferService),b(3,R.IDecorationService),b(4,E.IRenderService),b(5,R.IOptionsService),b(6,E.ICoreBrowserService)],T)},2950:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.CompositionHelper=void 0;const y=m(4725),E=m(2585),L=m(2584);let R=g.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(u,f,g,m,C,b){this._textarea=u,this._compositionView=f,this._bufferService=g,this._optionsService=m,this._coreService=C,this._renderService=b,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(u){this._compositionView.textContent=u.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(u){if(this._isComposing||this._isSendingComposition){if(229===u.keyCode)return!1;if(16===u.keyCode||17===u.keyCode||18===u.keyCode)return!1;this._finalizeComposition(!1)}return 229!==u.keyCode||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(u){if(this._compositionView.classList.remove("active"),this._isComposing=!1,u){const u={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let f;this._isSendingComposition=!1,u.start+=this._dataAlreadySent.length,f=this._isComposing?this._textarea.value.substring(u.start,u.end):this._textarea.value.substring(u.start),f.length>0&&this._coreService.triggerDataEvent(f,!0)}}),0)}else{this._isSendingComposition=!1;const u=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(u,!0)}}_handleAnyTextareaChanges(){const u=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const f=this._textarea.value,g=f.replace(u,"");this._dataAlreadySent=g,f.length>u.length?this._coreService.triggerDataEvent(g,!0):f.length<u.length?this._coreService.triggerDataEvent(`${L.C0.DEL}`,!0):f.length===u.length&&f!==u&&this._coreService.triggerDataEvent(f,!0)}}),0)}updateCompositionElements(u){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const u=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),f=this._renderService.dimensions.css.cell.height,g=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,m=u*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=m+"px",this._compositionView.style.top=g+"px",this._compositionView.style.height=f+"px",this._compositionView.style.lineHeight=f+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const C=this._compositionView.getBoundingClientRect();this._textarea.style.left=m+"px",this._textarea.style.top=g+"px",this._textarea.style.width=Math.max(C.width,1)+"px",this._textarea.style.height=Math.max(C.height,1)+"px",this._textarea.style.lineHeight=C.height+"px"}u||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};g.CompositionHelper=R=C([b(2,E.IBufferService),b(3,E.IOptionsService),b(4,E.ICoreService),b(5,y.IRenderService)],R)},9806:(u,f)=>{function i(u,f,g){const m=g.getBoundingClientRect(),C=u.getComputedStyle(g),b=parseInt(C.getPropertyValue("padding-left")),y=parseInt(C.getPropertyValue("padding-top"));return[f.clientX-m.left-b,f.clientY-m.top-y]}Object.defineProperty(f,"__esModule",{value:!0}),f.getCoords=f.getCoordsRelativeToElement=void 0,f.getCoordsRelativeToElement=i,f.getCoords=function(u,f,g,m,C,b,y,E,L){if(!b)return;const R=i(u,f,g);return R?(R[0]=Math.ceil((R[0]+(L?y/2:0))/y),R[1]=Math.ceil(R[1]/E),R[0]=Math.min(Math.max(R[0],1),m+(L?1:0)),R[1]=Math.min(Math.max(R[1],1),C),R):void 0}},9504:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.moveToCellSequence=void 0;const m=g(2584);function r(u,f,g,m){const C=u-n(u,g),b=f-n(f,g),y=Math.abs(C-b)-function(u,f,g){let m=0;const C=u-n(u,g),b=f-n(f,g);for(let y=0;y<Math.abs(C-b);y++){const b="A"===o(u,f)?-1:1,E=g.buffer.lines.get(C+b*y);E?.isWrapped&&m++}return m}(u,f,g);return c(y,h(o(u,f),m))}function n(u,f){let g=0,m=f.buffer.lines.get(u),C=m?.isWrapped;for(;C&&u>=0&&u<f.rows;)g++,m=f.buffer.lines.get(--u),C=m?.isWrapped;return g}function o(u,f){return u>f?"A":"B"}function a(u,f,g,m,C,b){let y=u,E=f,L="";for(;y!==g||E!==m;)y+=C?1:-1,C&&y>b.cols-1?(L+=b.buffer.translateBufferLineToString(E,!1,u,y),y=0,u=0,E++):!C&&y<0&&(L+=b.buffer.translateBufferLineToString(E,!1,0,u+1),y=b.cols-1,u=y,E--);return L+b.buffer.translateBufferLineToString(E,!1,u,y)}function h(u,f){const g=f?"O":"[";return m.C0.ESC+g+u}function c(u,f){u=Math.floor(u);let g="";for(let m=0;m<u;m++)g+=f;return g}f.moveToCellSequence=function(u,f,g,m){const C=g.buffer.x,b=g.buffer.y;if(!g.buffer.hasScrollback)return function(u,f,g,m,C,b){return 0===r(f,m,C,b).length?"":c(a(u,f,u,f-n(f,C),!1,C).length,h("D",b))}(C,b,0,f,g,m)+r(b,f,g,m)+function(u,f,g,m,C,b){let y;y=r(f,m,C,b).length>0?m-n(m,C):f;const E=m,L=function(u,f,g,m,C,b){let y;return y=r(g,m,C,b).length>0?m-n(m,C):f,u<g&&y<=m||u>=g&&y<m?"C":"D"}(u,f,g,m,C,b);return c(a(u,y,g,E,"C"===L,C).length,h(L,b))}(C,b,u,f,g,m);let y;if(b===f)return y=C>u?"D":"C",c(Math.abs(C-u),h(y,m));y=b>f?"D":"C";const E=Math.abs(b-f);return c(function(u,f){return f.cols-u}(b>f?u:C,g)+(E-1)*g.cols+1+((b>f?C:u)-1),h(y,m))}},1296:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.DomRenderer=void 0;const y=m(3787),E=m(2550),L=m(2223),R=m(6171),x=m(6052),A=m(4725),B=m(8055),T=m(8460),M=m(844),O=m(2585),I="xterm-dom-renderer-owner-",H="xterm-rows",F="xterm-fg-",W="xterm-bg-",U="xterm-focus",N="xterm-selection";let $=1,j=g.DomRenderer=class extends M.Disposable{constructor(u,f,g,m,C,b,L,A,B,O,F,W,U){super(),this._terminal=u,this._document=f,this._element=g,this._screenElement=m,this._viewportElement=C,this._helperContainer=b,this._linkifier2=L,this._charSizeService=B,this._optionsService=O,this._bufferService=F,this._coreBrowserService=W,this._themeService=U,this._terminalClass=$++,this._rowElements=[],this._selectionRenderModel=(0,x.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new T.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(H),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(N),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,R.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._themeService.onChangeColors((u=>this._injectCss(u)))),this._injectCss(this._themeService.colors),this._rowFactory=A.createInstance(y.DomRendererRowFactory,document),this._element.classList.add(I+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((u=>this._handleLinkHover(u)))),this.register(this._linkifier2.onHideLinkUnderline((u=>this._handleLinkLeave(u)))),this.register((0,M.toDisposable)((()=>{this._element.classList.remove(I+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()}))),this._widthCache=new E.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const u=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*u,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*u),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/u),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/u),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const u of this._rowElements)u.style.width=`${this.dimensions.css.canvas.width}px`,u.style.height=`${this.dimensions.css.cell.height}px`,u.style.lineHeight=`${this.dimensions.css.cell.height}px`,u.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const f=`${this._terminalSelector} .${H} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=f,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(u){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let f=`${this._terminalSelector} .${H} { color: ${u.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;f+=`${this._terminalSelector} .${H} .xterm-dim { color: ${B.color.multiplyOpacity(u.foreground,.5).css};}`,f+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const g=`blink_underline_${this._terminalClass}`,m=`blink_bar_${this._terminalClass}`,C=`blink_block_${this._terminalClass}`;f+=`@keyframes ${g} { 50% {  border-bottom-style: hidden; }}`,f+=`@keyframes ${m} { 50% {  box-shadow: none; }}`,f+=`@keyframes ${C} { 0% {  background-color: ${u.cursor.css};  color: ${u.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${u.cursor.css}; }}`,f+=`${this._terminalSelector} .${H}.${U} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${g} 1s step-end infinite;}${this._terminalSelector} .${H}.${U} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${m} 1s step-end infinite;}${this._terminalSelector} .${H}.${U} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${C} 1s step-end infinite;}${this._terminalSelector} .${H} .xterm-cursor.xterm-cursor-block { background-color: ${u.cursor.css}; color: ${u.cursorAccent.css};}${this._terminalSelector} .${H} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${u.cursor.css} !important; color: ${u.cursorAccent.css} !important;}${this._terminalSelector} .${H} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${u.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${H} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${u.cursor.css} inset;}${this._terminalSelector} .${H} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${u.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,f+=`${this._terminalSelector} .${N} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${N} div { position: absolute; background-color: ${u.selectionBackgroundOpaque.css};}${this._terminalSelector} .${N} div { position: absolute; background-color: ${u.selectionInactiveBackgroundOpaque.css};}`;for(const[g,m]of u.ansi.entries())f+=`${this._terminalSelector} .${F}${g} { color: ${m.css}; }${this._terminalSelector} .${F}${g}.xterm-dim { color: ${B.color.multiplyOpacity(m,.5).css}; }${this._terminalSelector} .${W}${g} { background-color: ${m.css}; }`;f+=`${this._terminalSelector} .${F}${L.INVERTED_DEFAULT_COLOR} { color: ${B.color.opaque(u.background).css}; }${this._terminalSelector} .${F}${L.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${B.color.multiplyOpacity(B.color.opaque(u.background),.5).css}; }${this._terminalSelector} .${W}${L.INVERTED_DEFAULT_COLOR} { background-color: ${u.foreground.css}; }`,this._themeStyleElement.textContent=f}_setDefaultSpacing(){const u=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${u}px`,this._rowFactory.defaultSpacing=u}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(u,f){for(let u=this._rowElements.length;u<=f;u++){const u=this._document.createElement("div");this._rowContainer.appendChild(u),this._rowElements.push(u)}for(;this._rowElements.length>f;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(u,f){this._refreshRowElements(u,f),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(U),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(U),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(u,f,g){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(u,f,g),this.renderRows(0,this._bufferService.rows-1),!u||!f)return;this._selectionRenderModel.update(this._terminal,u,f,g);const m=this._selectionRenderModel.viewportStartRow,C=this._selectionRenderModel.viewportEndRow,b=this._selectionRenderModel.viewportCappedStartRow,y=this._selectionRenderModel.viewportCappedEndRow;if(b>=this._bufferService.rows||y<0)return;const E=this._document.createDocumentFragment();if(g){const g=u[0]>f[0];E.appendChild(this._createSelectionElement(b,g?f[0]:u[0],g?u[0]:f[0],y-b+1))}else{const g=m===b?u[0]:0,L=b===C?f[0]:this._bufferService.cols;E.appendChild(this._createSelectionElement(b,g,L));const R=y-b-1;if(E.appendChild(this._createSelectionElement(b+1,0,this._bufferService.cols,R)),b!==y){const u=C===y?f[0]:this._bufferService.cols;E.appendChild(this._createSelectionElement(y,0,u))}}this._selectionContainer.appendChild(E)}_createSelectionElement(u,f,g,m=1){const C=this._document.createElement("div"),b=f*this.dimensions.css.cell.width;let y=this.dimensions.css.cell.width*(g-f);return b+y>this.dimensions.css.canvas.width&&(y=this.dimensions.css.canvas.width-b),C.style.height=m*this.dimensions.css.cell.height+"px",C.style.top=u*this.dimensions.css.cell.height+"px",C.style.left=`${b}px`,C.style.width=`${y}px`,C}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const u of this._rowElements)u.replaceChildren()}renderRows(u,f){const g=this._bufferService.buffer,m=g.ybase+g.y,C=Math.min(g.x,this._bufferService.cols-1),b=this._optionsService.rawOptions.cursorBlink,y=this._optionsService.rawOptions.cursorStyle,E=this._optionsService.rawOptions.cursorInactiveStyle;for(let L=u;L<=f;L++){const u=L+g.ydisp,f=this._rowElements[L],R=g.lines.get(u);if(!f||!R)break;f.replaceChildren(...this._rowFactory.createRow(R,u,u===m,y,E,C,b,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${I}${this._terminalClass}`}_handleLinkHover(u){this._setCellUnderline(u.x1,u.x2,u.y1,u.y2,u.cols,!0)}_handleLinkLeave(u){this._setCellUnderline(u.x1,u.x2,u.y1,u.y2,u.cols,!1)}_setCellUnderline(u,f,g,m,C,b){g<0&&(u=0),m<0&&(f=0);const y=this._bufferService.rows-1;g=Math.max(Math.min(g,y),0),m=Math.max(Math.min(m,y),0),C=Math.min(C,this._bufferService.cols);const E=this._bufferService.buffer,L=E.ybase+E.y,R=Math.min(E.x,C-1),x=this._optionsService.rawOptions.cursorBlink,A=this._optionsService.rawOptions.cursorStyle,B=this._optionsService.rawOptions.cursorInactiveStyle;for(let y=g;y<=m;++y){const T=y+E.ydisp,M=this._rowElements[y],O=E.lines.get(T);if(!M||!O)break;M.replaceChildren(...this._rowFactory.createRow(O,T,T===L,A,B,R,x,this.dimensions.css.cell.width,this._widthCache,b?y===g?u:0:-1,b?(y===m?f:C)-1:-1))}}};g.DomRenderer=j=C([b(7,O.IInstantiationService),b(8,A.ICharSizeService),b(9,O.IOptionsService),b(10,O.IBufferService),b(11,A.ICoreBrowserService),b(12,A.IThemeService)],j)},3787:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.DomRendererRowFactory=void 0;const y=m(2223),E=m(643),L=m(511),R=m(2585),x=m(8055),A=m(4725),B=m(4269),T=m(6171),M=m(3734);let O=g.DomRendererRowFactory=class{constructor(u,f,g,m,C,b,y){this._document=u,this._characterJoinerService=f,this._optionsService=g,this._coreBrowserService=m,this._coreService=C,this._decorationService=b,this._themeService=y,this._workCell=new L.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(u,f,g){this._selectionStart=u,this._selectionEnd=f,this._columnSelectMode=g}createRow(u,f,g,m,C,b,L,R,A,T,O){const I=[],H=this._characterJoinerService.getJoinedCharacters(f),F=this._themeService.colors;let W,U=u.getNoBgTrimmedLength();g&&U<b+1&&(U=b+1);let N=0,$="",j=0,z=0,K=0,q=!1,V=0,G=!1,X=0;const J=[],Y=-1!==T&&-1!==O;for(let Z=0;Z<U;Z++){u.loadCell(Z,this._workCell);let U=this._workCell.getWidth();if(0===U)continue;let Q=!1,ee=Z,te=this._workCell;if(H.length>0&&Z===H[0][0]){Q=!0;const f=H.shift();te=new B.JoinedCellData(this._workCell,u.translateToString(!0,f[0],f[1]),f[1]-f[0]),ee=f[1]-1,U=te.getWidth()}const ie=this._isCellInSelection(Z,f),se=g&&Z===b,re=Y&&Z>=T&&Z<=O;let ne=!1;this._decorationService.forEachDecorationAtCell(Z,f,void 0,(u=>{ne=!0}));let oe=te.getChars()||E.WHITESPACE_CELL_CHAR;if(" "===oe&&(te.isUnderline()||te.isOverline())&&(oe="Â "),X=U*R-A.get(oe,te.isBold(),te.isItalic()),W){if(N&&(ie&&G||!ie&&!G&&te.bg===j)&&(ie&&G&&F.selectionForeground||te.fg===z)&&te.extended.ext===K&&re===q&&X===V&&!se&&!Q&&!ne){te.isInvisible()?$+=E.WHITESPACE_CELL_CHAR:$+=oe,N++;continue}N&&(W.textContent=$),W=this._document.createElement("span"),N=0,$=""}else W=this._document.createElement("span");if(j=te.bg,z=te.fg,K=te.extended.ext,q=re,V=X,G=ie,Q&&b>=Z&&b<=ee&&(b=Z),!this._coreService.isCursorHidden&&se&&this._coreService.isCursorInitialized)if(J.push("xterm-cursor"),this._coreBrowserService.isFocused)L&&J.push("xterm-cursor-blink"),J.push("bar"===m?"xterm-cursor-bar":"underline"===m?"xterm-cursor-underline":"xterm-cursor-block");else if(C)switch(C){case"outline":J.push("xterm-cursor-outline");break;case"block":J.push("xterm-cursor-block");break;case"bar":J.push("xterm-cursor-bar");break;case"underline":J.push("xterm-cursor-underline")}if(te.isBold()&&J.push("xterm-bold"),te.isItalic()&&J.push("xterm-italic"),te.isDim()&&J.push("xterm-dim"),$=te.isInvisible()?E.WHITESPACE_CELL_CHAR:te.getChars()||E.WHITESPACE_CELL_CHAR,te.isUnderline()&&(J.push(`xterm-underline-${te.extended.underlineStyle}`)," "===$&&($="Â "),!te.isUnderlineColorDefault()))if(te.isUnderlineColorRGB())W.style.textDecorationColor=`rgb(${M.AttributeData.toColorRGB(te.getUnderlineColor()).join(",")})`;else{let u=te.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&te.isBold()&&u<8&&(u+=8),W.style.textDecorationColor=F.ansi[u].css}te.isOverline()&&(J.push("xterm-overline")," "===$&&($="Â ")),te.isStrikethrough()&&J.push("xterm-strikethrough"),re&&(W.style.textDecoration="underline");let ae=te.getFgColor(),he=te.getFgColorMode(),ce=te.getBgColor(),le=te.getBgColorMode();const de=!!te.isInverse();if(de){const u=ae;ae=ce,ce=u;const f=he;he=le,le=f}let _e,ue,fe,ve=!1;switch(this._decorationService.forEachDecorationAtCell(Z,f,void 0,(u=>{"top"!==u.options.layer&&ve||(u.backgroundColorRGB&&(le=50331648,ce=u.backgroundColorRGB.rgba>>8&16777215,_e=u.backgroundColorRGB),u.foregroundColorRGB&&(he=50331648,ae=u.foregroundColorRGB.rgba>>8&16777215,ue=u.foregroundColorRGB),ve="top"===u.options.layer)})),!ve&&ie&&(_e=this._coreBrowserService.isFocused?F.selectionBackgroundOpaque:F.selectionInactiveBackgroundOpaque,ce=_e.rgba>>8&16777215,le=50331648,ve=!0,F.selectionForeground&&(he=50331648,ae=F.selectionForeground.rgba>>8&16777215,ue=F.selectionForeground)),ve&&J.push("xterm-decoration-top"),le){case 16777216:case 33554432:fe=F.ansi[ce],J.push(`xterm-bg-${ce}`);break;case 50331648:fe=x.channels.toColor(ce>>16,ce>>8&255,255&ce),this._addStyle(W,`background-color:#${v((ce>>>0).toString(16),"0",6)}`);break;default:de?(fe=F.foreground,J.push(`xterm-bg-${y.INVERTED_DEFAULT_COLOR}`)):fe=F.background}switch(_e||te.isDim()&&(_e=x.color.multiplyOpacity(fe,.5)),he){case 16777216:case 33554432:te.isBold()&&ae<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(ae+=8),this._applyMinimumContrast(W,fe,F.ansi[ae],te,_e,void 0)||J.push(`xterm-fg-${ae}`);break;case 50331648:const u=x.channels.toColor(ae>>16&255,ae>>8&255,255&ae);this._applyMinimumContrast(W,fe,u,te,_e,ue)||this._addStyle(W,`color:#${v(ae.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(W,fe,F.foreground,te,_e,ue)||de&&J.push(`xterm-fg-${y.INVERTED_DEFAULT_COLOR}`)}J.length&&(W.className=J.join(" "),J.length=0),se||Q||ne?W.textContent=$:N++,X!==this.defaultSpacing&&(W.style.letterSpacing=`${X}px`),I.push(W),Z=ee}return W&&N&&(W.textContent=$),I}_applyMinimumContrast(u,f,g,m,C,b){if(1===this._optionsService.rawOptions.minimumContrastRatio||(0,T.treatGlyphAsBackgroundColor)(m.getCode()))return!1;const y=this._getContrastCache(m);let E;if(C||b||(E=y.getColor(f.rgba,g.rgba)),void 0===E){const u=this._optionsService.rawOptions.minimumContrastRatio/(m.isDim()?2:1);E=x.color.ensureContrastRatio(C||f,b||g,u),y.setColor((C||f).rgba,(b||g).rgba,E??null)}return!!E&&(this._addStyle(u,`color:${E.css}`),!0)}_getContrastCache(u){return u.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(u,f){u.setAttribute("style",`${u.getAttribute("style")||""}${f};`)}_isCellInSelection(u,f){const g=this._selectionStart,m=this._selectionEnd;return!(!g||!m)&&(this._columnSelectMode?g[0]<=m[0]?u>=g[0]&&f>=g[1]&&u<m[0]&&f<=m[1]:u<g[0]&&f>=g[1]&&u>=m[0]&&f<=m[1]:f>g[1]&&f<m[1]||g[1]===m[1]&&f===g[1]&&u>=g[0]&&u<m[0]||g[1]<m[1]&&f===m[1]&&u<m[0]||g[1]<m[1]&&f===g[1]&&u>=g[0])}};function v(u,f,g){for(;u.length<g;)u=f+u;return u}g.DomRendererRowFactory=O=C([b(1,A.ICharacterJoinerService),b(2,R.IOptionsService),b(3,A.ICoreBrowserService),b(4,R.ICoreService),b(5,R.IDecorationService),b(6,A.IThemeService)],O)},2550:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.WidthCache=void 0,f.WidthCache=class{constructor(u,f){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=u.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const g=u.createElement("span");g.classList.add("xterm-char-measure-element");const m=u.createElement("span");m.classList.add("xterm-char-measure-element"),m.style.fontWeight="bold";const C=u.createElement("span");C.classList.add("xterm-char-measure-element"),C.style.fontStyle="italic";const b=u.createElement("span");b.classList.add("xterm-char-measure-element"),b.style.fontWeight="bold",b.style.fontStyle="italic",this._measureElements=[g,m,C,b],this._container.appendChild(g),this._container.appendChild(m),this._container.appendChild(C),this._container.appendChild(b),f.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(u,f,g,m){u===this._font&&f===this._fontSize&&g===this._weight&&m===this._weightBold||(this._font=u,this._fontSize=f,this._weight=g,this._weightBold=m,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${g}`,this._measureElements[1].style.fontWeight=`${m}`,this._measureElements[2].style.fontWeight=`${g}`,this._measureElements[3].style.fontWeight=`${m}`,this.clear())}get(u,f,g){let m=0;if(!f&&!g&&1===u.length&&(m=u.charCodeAt(0))<256){if(-9999!==this._flat[m])return this._flat[m];const f=this._measure(u,0);return f>0&&(this._flat[m]=f),f}let C=u;f&&(C+="B"),g&&(C+="I");let b=this._holey.get(C);if(void 0===b){let m=0;f&&(m|=1),g&&(m|=2),b=this._measure(u,m),b>0&&this._holey.set(C,b)}return b}_measure(u,f){const g=this._measureElements[f];return g.textContent=u.repeat(32),g.offsetWidth/32}}},2223:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.TEXT_BASELINE=f.DIM_OPACITY=f.INVERTED_DEFAULT_COLOR=void 0;const m=g(6114);f.INVERTED_DEFAULT_COLOR=257,f.DIM_OPACITY=.5,f.TEXT_BASELINE=m.isFirefox||m.isLegacyEdge?"bottom":"ideographic"},6171:(u,f)=>{function i(u){return 57508<=u&&u<=57558}function s(u){return u>=128512&&u<=128591||u>=127744&&u<=128511||u>=128640&&u<=128767||u>=9728&&u<=9983||u>=9984&&u<=10175||u>=65024&&u<=65039||u>=129280&&u<=129535||u>=127462&&u<=127487}Object.defineProperty(f,"__esModule",{value:!0}),f.computeNextVariantOffset=f.createRenderDimensions=f.treatGlyphAsBackgroundColor=f.allowRescaling=f.isEmoji=f.isRestrictedPowerlineGlyph=f.isPowerlineGlyph=f.throwIfFalsy=void 0,f.throwIfFalsy=function(u){if(!u)throw new Error("value must not be falsy");return u},f.isPowerlineGlyph=i,f.isRestrictedPowerlineGlyph=function(u){return 57520<=u&&u<=57527},f.isEmoji=s,f.allowRescaling=function(u,f,g,m){return 1===f&&g>Math.ceil(1.5*m)&&void 0!==u&&u>255&&!s(u)&&!i(u)&&!function(u){return 57344<=u&&u<=63743}(u)},f.treatGlyphAsBackgroundColor=function(u){return i(u)||function(u){return 9472<=u&&u<=9631}(u)},f.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},f.computeNextVariantOffset=function(u,f,g=0){return(u-(2*Math.round(f)-g))%(2*Math.round(f))}},6052:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.createSelectionRenderModel=void 0;class i{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(u,f,g,m=!1){if(this.selectionStart=f,this.selectionEnd=g,!f||!g||f[0]===g[0]&&f[1]===g[1])return void this.clear();const C=u.buffers.active.ydisp,b=f[1]-C,y=g[1]-C,E=Math.max(b,0),L=Math.min(y,u.rows-1);E>=u.rows||L<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=m,this.viewportStartRow=b,this.viewportEndRow=y,this.viewportCappedStartRow=E,this.viewportCappedEndRow=L,this.startCol=f[0],this.endCol=g[0])}isCellSelected(u,f,g){return!!this.hasSelection&&(g-=u.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?f>=this.startCol&&g>=this.viewportCappedStartRow&&f<this.endCol&&g<=this.viewportCappedEndRow:f<this.startCol&&g>=this.viewportCappedStartRow&&f>=this.endCol&&g<=this.viewportCappedEndRow:g>this.viewportStartRow&&g<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&g===this.viewportStartRow&&f>=this.startCol&&f<this.endCol||this.viewportStartRow<this.viewportEndRow&&g===this.viewportEndRow&&f<this.endCol||this.viewportStartRow<this.viewportEndRow&&g===this.viewportStartRow&&f>=this.startCol)}}f.createSelectionRenderModel=function(){return new i}},456:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.SelectionModel=void 0,f.SelectionModel=class{constructor(u){this._bufferService=u,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const u=this.selectionStart[0]+this.selectionStartLength;return u>this._bufferService.cols?u%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(u/this._bufferService.cols)-1]:[u%this._bufferService.cols,this.selectionStart[1]+Math.floor(u/this._bufferService.cols)]:[u,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const u=this.selectionStart[0]+this.selectionStartLength;return u>this._bufferService.cols?[u%this._bufferService.cols,this.selectionStart[1]+Math.floor(u/this._bufferService.cols)]:[Math.max(u,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const u=this.selectionStart,f=this.selectionEnd;return!(!u||!f)&&(u[1]>f[1]||u[1]===f[1]&&u[0]>f[0])}handleTrim(u){return this.selectionStart&&(this.selectionStart[1]-=u),this.selectionEnd&&(this.selectionEnd[1]-=u),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.CharSizeService=void 0;const y=m(2585),E=m(8460),L=m(844);let R=g.CharSizeService=class extends L.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(u,f,g){super(),this._optionsService=g,this.width=0,this.height=0,this._onCharSizeChange=this.register(new E.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new d(this._optionsService))}catch{this._measureStrategy=this.register(new l(u,f,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}measure(){const u=this._measureStrategy.measure();u.width===this.width&&u.height===this.height||(this.width=u.width,this.height=u.height,this._onCharSizeChange.fire())}};g.CharSizeService=R=C([b(2,y.IOptionsService)],R);class c extends L.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(u,f){void 0!==u&&u>0&&void 0!==f&&f>0&&(this._result.width=u,this._result.height=f)}}class l extends c{constructor(u,f,g){super(),this._document=u,this._parentElement=f,this._optionsService=g,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class d extends c{constructor(u){super(),this._optionsService=u,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const f=this._ctx.measureText("W");if(!("width"in f&&"fontBoundingBoxAscent"in f&&"fontBoundingBoxDescent"in f))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const u=this._ctx.measureText("W");return this._validateAndSet(u.width,u.fontBoundingBoxAscent+u.fontBoundingBoxDescent),this._result}}},4269:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.CharacterJoinerService=g.JoinedCellData=void 0;const y=m(3734),E=m(643),L=m(511),R=m(2585);class c extends y.AttributeData{constructor(u,f,g){super(),this.content=0,this.combinedData="",this.fg=u.fg,this.bg=u.bg,this.combinedData=f,this._width=g}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(u){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}g.JoinedCellData=c;let x=g.CharacterJoinerService=class e{constructor(u){this._bufferService=u,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new L.CellData}register(u){const f={id:this._nextCharacterJoinerId++,handler:u};return this._characterJoiners.push(f),f.id}deregister(u){for(let f=0;f<this._characterJoiners.length;f++)if(this._characterJoiners[f].id===u)return this._characterJoiners.splice(f,1),!0;return!1}getJoinedCharacters(u){if(0===this._characterJoiners.length)return[];const f=this._bufferService.buffer.lines.get(u);if(!f||0===f.length)return[];const g=[],m=f.translateToString(!0);let C=0,b=0,y=0,L=f.getFg(0),R=f.getBg(0);for(let u=0;u<f.getTrimmedLength();u++)if(f.loadCell(u,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==L||this._workCell.bg!==R){if(u-C>1){const u=this._getJoinedRanges(m,y,b,f,C);for(let f=0;f<u.length;f++)g.push(u[f])}C=u,y=b,L=this._workCell.fg,R=this._workCell.bg}b+=this._workCell.getChars().length||E.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-C>1){const u=this._getJoinedRanges(m,y,b,f,C);for(let f=0;f<u.length;f++)g.push(u[f])}return g}_getJoinedRanges(u,f,g,m,C){const b=u.substring(f,g);let y=[];try{y=this._characterJoiners[0].handler(b)}catch(u){console.error(u)}for(let u=1;u<this._characterJoiners.length;u++)try{const f=this._characterJoiners[u].handler(b);for(let u=0;u<f.length;u++)e._mergeRanges(y,f[u])}catch(u){console.error(u)}return this._stringRangesToCellRanges(y,m,C),y}_stringRangesToCellRanges(u,f,g){let m=0,C=!1,b=0,y=u[m];if(y){for(let L=g;L<this._bufferService.cols;L++){const g=f.getWidth(L),R=f.getString(L).length||E.WHITESPACE_CELL_CHAR.length;if(0!==g){if(!C&&y[0]<=b&&(y[0]=L,C=!0),y[1]<=b){if(y[1]=L,y=u[++m],!y)break;y[0]<=b?(y[0]=L,C=!0):C=!1}b+=R}}y&&(y[1]=this._bufferService.cols)}}static _mergeRanges(u,f){let g=!1;for(let m=0;m<u.length;m++){const C=u[m];if(g){if(f[1]<=C[0])return u[m-1][1]=f[1],u;if(f[1]<=C[1])return u[m-1][1]=Math.max(f[1],C[1]),u.splice(m,1),u;u.splice(m,1),m--}else{if(f[1]<=C[0])return u.splice(m,0,f),u;if(f[1]<=C[1])return C[0]=Math.min(f[0],C[0]),u;f[0]<C[1]&&(C[0]=Math.min(f[0],C[0]),g=!0)}}return g?u[u.length-1][1]=f[1]:u.push(f),u}};g.CharacterJoinerService=x=C([b(0,R.IBufferService)],x)},5114:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.CoreBrowserService=void 0;const m=g(844),C=g(8460),b=g(3656);class o extends m.Disposable{constructor(u,f,g){super(),this._textarea=u,this._window=f,this.mainDocument=g,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new a(this._window),this._onDprChange=this.register(new C.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new C.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange((u=>this._screenDprMonitor.setWindow(u)))),this.register((0,C.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get window(){return this._window}set window(u){this._window!==u&&(this._window=u,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return void 0===this._cachedIsFocused&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}f.CoreBrowserService=o;class a extends m.Disposable{constructor(u){super(),this._parentWindow=u,this._windowResizeListener=this.register(new m.MutableDisposable),this._onDprChange=this.register(new C.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,m.toDisposable)((()=>this.clearListener())))}setWindow(u){this._parentWindow=u,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,b.addDisposableDomListener)(this._parentWindow,"resize",(()=>this._setDprAndFireIfDiffers()))}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.LinkProviderService=void 0;const m=g(844);class r extends m.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,m.toDisposable)((()=>this.linkProviders.length=0)))}registerLinkProvider(u){return this.linkProviders.push(u),{dispose:()=>{const f=this.linkProviders.indexOf(u);-1!==f&&this.linkProviders.splice(f,1)}}}}f.LinkProviderService=r},8934:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.MouseService=void 0;const y=m(4725),E=m(9806);let L=g.MouseService=class{constructor(u,f){this._renderService=u,this._charSizeService=f}getCoords(u,f,g,m,C){return(0,E.getCoords)(window,u,f,g,m,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,C)}getMouseReportCoords(u,f){const g=(0,E.getCoordsRelativeToElement)(window,u,f);if(this._charSizeService.hasValidSize)return g[0]=Math.min(Math.max(g[0],0),this._renderService.dimensions.css.canvas.width-1),g[1]=Math.min(Math.max(g[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(g[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(g[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(g[0]),y:Math.floor(g[1])}}};g.MouseService=L=C([b(0,y.IRenderService),b(1,y.ICharSizeService)],L)},3230:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.RenderService=void 0;const y=m(6193),E=m(4725),L=m(8460),R=m(844),x=m(7226),A=m(2585);let B=g.RenderService=class extends R.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(u,f,g,m,C,b,E,A){super(),this._rowCount=u,this._charSizeService=m,this._renderer=this.register(new R.MutableDisposable),this._pausedResizeTask=new x.DebouncedIdleTask,this._observerDisposable=this.register(new R.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new L.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new L.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new L.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new L.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new y.RenderDebouncer(((u,f)=>this._renderRows(u,f)),E),this.register(this._renderDebouncer),this.register(E.onDprChange((()=>this.handleDevicePixelRatioChange()))),this.register(b.onResize((()=>this._fullRefresh()))),this.register(b.buffers.onBufferActivate((()=>this._renderer.value?.clear()))),this.register(g.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(C.onDecorationRegistered((()=>this._fullRefresh()))),this.register(C.onDecorationRemoved((()=>this._fullRefresh()))),this.register(g.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],(()=>{this.clear(),this.handleResize(b.cols,b.rows),this._fullRefresh()}))),this.register(g.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(b.buffer.y,b.buffer.y,!0)))),this.register(A.onChangeColors((()=>this._fullRefresh()))),this._registerIntersectionObserver(E.window,f),this.register(E.onWindowChange((u=>this._registerIntersectionObserver(u,f))))}_registerIntersectionObserver(u,f){if("IntersectionObserver"in u){const g=new u.IntersectionObserver((u=>this._handleIntersectionChange(u[u.length-1])),{threshold:0});g.observe(f),this._observerDisposable.value=(0,R.toDisposable)((()=>g.disconnect()))}}_handleIntersectionChange(u){this._isPaused=void 0===u.isIntersecting?0===u.intersectionRatio:!u.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(u,f,g=!1){this._isPaused?this._needsFullRefresh=!0:(g||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(u,f,this._rowCount))}_renderRows(u,f){this._renderer.value&&(u=Math.min(u,this._rowCount-1),f=Math.min(f,this._rowCount-1),this._renderer.value.renderRows(u,f),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:u,end:f}),this._onRender.fire({start:u,end:f}),this._isNextRenderRedrawOnly=!0)}resize(u,f){this._rowCount=f,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(u){this._renderer.value=u,this._renderer.value&&(this._renderer.value.onRequestRedraw((u=>this.refreshRows(u.start,u.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(u){return this._renderDebouncer.addRefreshCallback(u)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(u,f){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set((()=>this._renderer.value?.handleResize(u,f))):this._renderer.value.handleResize(u,f),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(u,f,g){this._selectionState.start=u,this._selectionState.end=f,this._selectionState.columnSelectMode=g,this._renderer.value?.handleSelectionChanged(u,f,g)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};g.RenderService=B=C([b(2,A.IOptionsService),b(3,E.ICharSizeService),b(4,A.IDecorationService),b(5,A.IBufferService),b(6,E.ICoreBrowserService),b(7,E.IThemeService)],B)},9312:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.SelectionService=void 0;const y=m(9806),E=m(9504),L=m(456),R=m(4725),x=m(8460),A=m(844),B=m(6114),T=m(4841),M=m(511),O=m(2585),I=String.fromCharCode(160),H=new RegExp(I,"g");let F=g.SelectionService=class extends A.Disposable{constructor(u,f,g,m,C,b,y,E,R){super(),this._element=u,this._screenElement=f,this._linkifier=g,this._bufferService=m,this._coreService=C,this._mouseService=b,this._optionsService=y,this._renderService=E,this._coreBrowserService=R,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new M.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new x.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new x.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new x.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new x.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=u=>this._handleMouseMove(u),this._mouseUpListener=u=>this._handleMouseUp(u),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((u=>this._handleTrim(u))),this.register(this._bufferService.buffers.onBufferActivate((u=>this._handleBufferActivate(u)))),this.enable(),this._model=new L.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,A.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const u=this._model.finalSelectionStart,f=this._model.finalSelectionEnd;return!(!u||!f||u[0]===f[0]&&u[1]===f[1])}get selectionText(){const u=this._model.finalSelectionStart,f=this._model.finalSelectionEnd;if(!u||!f)return"";const g=this._bufferService.buffer,m=[];if(3===this._activeSelectionMode){if(u[0]===f[0])return"";const C=u[0]<f[0]?u[0]:f[0],b=u[0]<f[0]?f[0]:u[0];for(let y=u[1];y<=f[1];y++){const u=g.translateBufferLineToString(y,!0,C,b);m.push(u)}}else{const C=u[1]===f[1]?f[0]:void 0;m.push(g.translateBufferLineToString(u[1],!0,u[0],C));for(let C=u[1]+1;C<=f[1]-1;C++){const u=g.lines.get(C),f=g.translateBufferLineToString(C,!0);u?.isWrapped?m[m.length-1]+=f:m.push(f)}if(u[1]!==f[1]){const u=g.lines.get(f[1]),C=g.translateBufferLineToString(f[1],!0,0,f[0]);u&&u.isWrapped?m[m.length-1]+=C:m.push(C)}}return m.map((u=>u.replace(H," "))).join(B.isWindows?"\r\n":"\n")}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(u){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),B.isLinux&&u&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})}_isClickInSelection(u){const f=this._getMouseBufferCoords(u),g=this._model.finalSelectionStart,m=this._model.finalSelectionEnd;return!!(g&&m&&f)&&this._areCoordsInSelection(f,g,m)}isCellInSelection(u,f){const g=this._model.finalSelectionStart,m=this._model.finalSelectionEnd;return!(!g||!m)&&this._areCoordsInSelection([u,f],g,m)}_areCoordsInSelection(u,f,g){return u[1]>f[1]&&u[1]<g[1]||f[1]===g[1]&&u[1]===f[1]&&u[0]>=f[0]&&u[0]<g[0]||f[1]<g[1]&&u[1]===g[1]&&u[0]<g[0]||f[1]<g[1]&&u[1]===f[1]&&u[0]>=f[0]}_selectWordAtCursor(u,f){const g=this._linkifier.currentLink?.link?.range;if(g)return this._model.selectionStart=[g.start.x-1,g.start.y-1],this._model.selectionStartLength=(0,T.getRangeLength)(g,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const m=this._getMouseBufferCoords(u);return!!m&&(this._selectWordAt(m,f),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(u,f){this._model.clearSelection(),u=Math.max(u,0),f=Math.min(f,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,u],this._model.selectionEnd=[this._bufferService.cols,f],this.refresh(),this._onSelectionChange.fire()}_handleTrim(u){this._model.handleTrim(u)&&this.refresh()}_getMouseBufferCoords(u){const f=this._mouseService.getCoords(u,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(f)return f[0]--,f[1]--,f[1]+=this._bufferService.buffer.ydisp,f}_getMouseEventScrollAmount(u){let f=(0,y.getCoordsRelativeToElement)(this._coreBrowserService.window,u,this._screenElement)[1];const g=this._renderService.dimensions.css.canvas.height;return f>=0&&f<=g?0:(f>g&&(f-=g),f=Math.min(Math.max(f,-50),50),f/=50,f/Math.abs(f)+Math.round(14*f))}shouldForceSelection(u){return B.isMac?u.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:u.shiftKey}handleMouseDown(u){if(this._mouseDownTimeStamp=u.timeStamp,(2!==u.button||!this.hasSelection)&&0===u.button){if(!this._enabled){if(!this.shouldForceSelection(u))return;u.stopPropagation()}u.preventDefault(),this._dragScrollAmount=0,this._enabled&&u.shiftKey?this._handleIncrementalClick(u):1===u.detail?this._handleSingleClick(u):2===u.detail?this._handleDoubleClick(u):3===u.detail&&this._handleTripleClick(u),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(u){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(u))}_handleSingleClick(u){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(u)?3:0,this._model.selectionStart=this._getMouseBufferCoords(u),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const f=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);f&&f.length!==this._model.selectionStart[0]&&0===f.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++}_handleDoubleClick(u){this._selectWordAtCursor(u,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(u){const f=this._getMouseBufferCoords(u);f&&(this._activeSelectionMode=2,this._selectLineAt(f[1]))}shouldColumnSelect(u){return u.altKey&&!(B.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(u){if(u.stopImmediatePropagation(),!this._model.selectionStart)return;const f=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(u),!this._model.selectionEnd)return void this.refresh(!0);2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(u),3!==this._activeSelectionMode&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const g=this._bufferService.buffer;if(this._model.selectionEnd[1]<g.lines.length){const u=g.lines.get(this._model.selectionEnd[1]);u&&0===u.hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}f&&f[0]===this._model.selectionEnd[0]&&f[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const u=this._bufferService.buffer;this._dragScrollAmount>0?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(u.ydisp+this._bufferService.rows,u.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=u.ydisp),this.refresh()}}_handleMouseUp(u){const f=u.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&f<500&&u.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const f=this._mouseService.getCoords(u,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(f&&void 0!==f[0]&&void 0!==f[1]){const u=(0,E.moveToCellSequence)(f[0]-1,f[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(u,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const u=this._model.finalSelectionStart,f=this._model.finalSelectionEnd,g=!(!u||!f||u[0]===f[0]&&u[1]===f[1]);g?u&&f&&(this._oldSelectionStart&&this._oldSelectionEnd&&u[0]===this._oldSelectionStart[0]&&u[1]===this._oldSelectionStart[1]&&f[0]===this._oldSelectionEnd[0]&&f[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(u,f,g)):this._oldHasSelection&&this._fireOnSelectionChange(u,f,g)}_fireOnSelectionChange(u,f,g){this._oldSelectionStart=u,this._oldSelectionEnd=f,this._oldHasSelection=g,this._onSelectionChange.fire()}_handleBufferActivate(u){this.clearSelection(),this._trimListener.dispose(),this._trimListener=u.activeBuffer.lines.onTrim((u=>this._handleTrim(u)))}_convertViewportColToCharacterIndex(u,f){let g=f;for(let m=0;f>=m;m++){const C=u.loadCell(m,this._workCell).getChars().length;0===this._workCell.getWidth()?g--:C>1&&f!==m&&(g+=C-1)}return g}setSelection(u,f,g){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[u,f],this._model.selectionStartLength=g,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(u){this._isClickInSelection(u)||(this._selectWordAtCursor(u,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(u,f,g=!0,m=!0){if(u[0]>=this._bufferService.cols)return;const C=this._bufferService.buffer,b=C.lines.get(u[1]);if(!b)return;const y=C.translateBufferLineToString(u[1],!1);let E=this._convertViewportColToCharacterIndex(b,u[0]),L=E;const R=u[0]-E;let x=0,A=0,B=0,T=0;if(" "===y.charAt(E)){for(;E>0&&" "===y.charAt(E-1);)E--;for(;L<y.length&&" "===y.charAt(L+1);)L++}else{let f=u[0],g=u[0];0===b.getWidth(f)&&(x++,f--),2===b.getWidth(g)&&(A++,g++);const m=b.getString(g).length;for(m>1&&(T+=m-1,L+=m-1);f>0&&E>0&&!this._isCharWordSeparator(b.loadCell(f-1,this._workCell));){b.loadCell(f-1,this._workCell);const u=this._workCell.getChars().length;0===this._workCell.getWidth()?(x++,f--):u>1&&(B+=u-1,E-=u-1),E--,f--}for(;g<b.length&&L+1<y.length&&!this._isCharWordSeparator(b.loadCell(g+1,this._workCell));){b.loadCell(g+1,this._workCell);const u=this._workCell.getChars().length;2===this._workCell.getWidth()?(A++,g++):u>1&&(T+=u-1,L+=u-1),L++,g++}}L++;let M=E+R-x+B,O=Math.min(this._bufferService.cols,L-E+x+A-B-T);if(f||""!==y.slice(E,L).trim()){if(g&&0===M&&32!==b.getCodePoint(0)){const f=C.lines.get(u[1]-1);if(f&&b.isWrapped&&32!==f.getCodePoint(this._bufferService.cols-1)){const f=this._getWordAt([this._bufferService.cols-1,u[1]-1],!1,!0,!1);if(f){const u=this._bufferService.cols-f.start;M-=u,O+=u}}}if(m&&M+O===this._bufferService.cols&&32!==b.getCodePoint(this._bufferService.cols-1)){const f=C.lines.get(u[1]+1);if(f?.isWrapped&&32!==f.getCodePoint(0)){const f=this._getWordAt([0,u[1]+1],!1,!1,!0);f&&(O+=f.length)}}return{start:M,length:O}}}_selectWordAt(u,f){const g=this._getWordAt(u,f);if(g){for(;g.start<0;)g.start+=this._bufferService.cols,u[1]--;this._model.selectionStart=[g.start,u[1]],this._model.selectionStartLength=g.length}}_selectToWordAt(u){const f=this._getWordAt(u,!0);if(f){let g=u[1];for(;f.start<0;)f.start+=this._bufferService.cols,g--;if(!this._model.areSelectionValuesReversed())for(;f.start+f.length>this._bufferService.cols;)f.length-=this._bufferService.cols,g++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?f.start:f.start+f.length,g]}}_isCharWordSeparator(u){return 0!==u.getWidth()&&this._optionsService.rawOptions.wordSeparator.indexOf(u.getChars())>=0}_selectLineAt(u){const f=this._bufferService.buffer.getWrappedRangeForLine(u),g={start:{x:0,y:f.first},end:{x:this._bufferService.cols-1,y:f.last}};this._model.selectionStart=[0,f.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,T.getRangeLength)(g,this._bufferService.cols)}};g.SelectionService=F=C([b(3,O.IBufferService),b(4,O.ICoreService),b(5,R.IMouseService),b(6,O.IOptionsService),b(7,R.IRenderService),b(8,R.ICoreBrowserService)],F)},4725:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.ILinkProviderService=f.IThemeService=f.ICharacterJoinerService=f.ISelectionService=f.IRenderService=f.IMouseService=f.ICoreBrowserService=f.ICharSizeService=void 0;const m=g(8343);f.ICharSizeService=(0,m.createDecorator)("CharSizeService"),f.ICoreBrowserService=(0,m.createDecorator)("CoreBrowserService"),f.IMouseService=(0,m.createDecorator)("MouseService"),f.IRenderService=(0,m.createDecorator)("RenderService"),f.ISelectionService=(0,m.createDecorator)("SelectionService"),f.ICharacterJoinerService=(0,m.createDecorator)("CharacterJoinerService"),f.IThemeService=(0,m.createDecorator)("ThemeService"),f.ILinkProviderService=(0,m.createDecorator)("LinkProviderService")},6731:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.ThemeService=g.DEFAULT_ANSI_COLORS=void 0;const y=m(7239),E=m(8055),L=m(8460),R=m(844),x=m(2585),A=E.css.toColor("#ffffff"),B=E.css.toColor("#000000"),T=E.css.toColor("#ffffff"),M=E.css.toColor("#000000"),O={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};g.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const u=[E.css.toColor("#2e3436"),E.css.toColor("#cc0000"),E.css.toColor("#4e9a06"),E.css.toColor("#c4a000"),E.css.toColor("#3465a4"),E.css.toColor("#75507b"),E.css.toColor("#06989a"),E.css.toColor("#d3d7cf"),E.css.toColor("#555753"),E.css.toColor("#ef2929"),E.css.toColor("#8ae234"),E.css.toColor("#fce94f"),E.css.toColor("#729fcf"),E.css.toColor("#ad7fa8"),E.css.toColor("#34e2e2"),E.css.toColor("#eeeeec")],f=[0,95,135,175,215,255];for(let g=0;g<216;g++){const m=f[g/36%6|0],C=f[g/6%6|0],b=f[g%6];u.push({css:E.channels.toCss(m,C,b),rgba:E.channels.toRgba(m,C,b)})}for(let f=0;f<24;f++){const g=8+10*f;u.push({css:E.channels.toCss(g,g,g),rgba:E.channels.toRgba(g,g,g)})}return u})());let I=g.ThemeService=class extends R.Disposable{get colors(){return this._colors}constructor(u){super(),this._optionsService=u,this._contrastCache=new y.ColorContrastCache,this._halfContrastCache=new y.ColorContrastCache,this._onChangeColors=this.register(new L.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:A,background:B,cursor:T,cursorAccent:M,selectionForeground:void 0,selectionBackgroundTransparent:O,selectionBackgroundOpaque:E.color.blend(B,O),selectionInactiveBackgroundTransparent:O,selectionInactiveBackgroundOpaque:E.color.blend(B,O),ansi:g.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(u={}){const f=this._colors;if(f.foreground=p(u.foreground,A),f.background=p(u.background,B),f.cursor=p(u.cursor,T),f.cursorAccent=p(u.cursorAccent,M),f.selectionBackgroundTransparent=p(u.selectionBackground,O),f.selectionBackgroundOpaque=E.color.blend(f.background,f.selectionBackgroundTransparent),f.selectionInactiveBackgroundTransparent=p(u.selectionInactiveBackground,f.selectionBackgroundTransparent),f.selectionInactiveBackgroundOpaque=E.color.blend(f.background,f.selectionInactiveBackgroundTransparent),f.selectionForeground=u.selectionForeground?p(u.selectionForeground,E.NULL_COLOR):void 0,f.selectionForeground===E.NULL_COLOR&&(f.selectionForeground=void 0),E.color.isOpaque(f.selectionBackgroundTransparent)){const u=.3;f.selectionBackgroundTransparent=E.color.opacity(f.selectionBackgroundTransparent,u)}if(E.color.isOpaque(f.selectionInactiveBackgroundTransparent)){const u=.3;f.selectionInactiveBackgroundTransparent=E.color.opacity(f.selectionInactiveBackgroundTransparent,u)}if(f.ansi=g.DEFAULT_ANSI_COLORS.slice(),f.ansi[0]=p(u.black,g.DEFAULT_ANSI_COLORS[0]),f.ansi[1]=p(u.red,g.DEFAULT_ANSI_COLORS[1]),f.ansi[2]=p(u.green,g.DEFAULT_ANSI_COLORS[2]),f.ansi[3]=p(u.yellow,g.DEFAULT_ANSI_COLORS[3]),f.ansi[4]=p(u.blue,g.DEFAULT_ANSI_COLORS[4]),f.ansi[5]=p(u.magenta,g.DEFAULT_ANSI_COLORS[5]),f.ansi[6]=p(u.cyan,g.DEFAULT_ANSI_COLORS[6]),f.ansi[7]=p(u.white,g.DEFAULT_ANSI_COLORS[7]),f.ansi[8]=p(u.brightBlack,g.DEFAULT_ANSI_COLORS[8]),f.ansi[9]=p(u.brightRed,g.DEFAULT_ANSI_COLORS[9]),f.ansi[10]=p(u.brightGreen,g.DEFAULT_ANSI_COLORS[10]),f.ansi[11]=p(u.brightYellow,g.DEFAULT_ANSI_COLORS[11]),f.ansi[12]=p(u.brightBlue,g.DEFAULT_ANSI_COLORS[12]),f.ansi[13]=p(u.brightMagenta,g.DEFAULT_ANSI_COLORS[13]),f.ansi[14]=p(u.brightCyan,g.DEFAULT_ANSI_COLORS[14]),f.ansi[15]=p(u.brightWhite,g.DEFAULT_ANSI_COLORS[15]),u.extendedAnsi){const m=Math.min(f.ansi.length-16,u.extendedAnsi.length);for(let C=0;C<m;C++)f.ansi[C+16]=p(u.extendedAnsi[C],g.DEFAULT_ANSI_COLORS[C+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(u){this._restoreColor(u),this._onChangeColors.fire(this.colors)}_restoreColor(u){if(void 0!==u)switch(u){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[u]=this._restoreColors.ansi[u]}else for(let u=0;u<this._restoreColors.ansi.length;++u)this._colors.ansi[u]=this._restoreColors.ansi[u]}modifyColors(u){u(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function p(u,f){if(void 0!==u)try{return E.css.toColor(u)}catch{}return f}g.ThemeService=I=C([b(0,x.IOptionsService)],I)},6349:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.CircularList=void 0;const m=g(8460),C=g(844);class n extends C.Disposable{constructor(u){super(),this._maxLength=u,this.onDeleteEmitter=this.register(new m.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new m.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new m.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(u){if(this._maxLength===u)return;const f=new Array(u);for(let g=0;g<Math.min(u,this.length);g++)f[g]=this._array[this._getCyclicIndex(g)];this._array=f,this._maxLength=u,this._startIndex=0}get length(){return this._length}set length(u){if(u>this._length)for(let f=this._length;f<u;f++)this._array[f]=void 0;this._length=u}get(u){return this._array[this._getCyclicIndex(u)]}set(u,f){this._array[this._getCyclicIndex(u)]=f}push(u){this._array[this._getCyclicIndex(this._length)]=u,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(u,f,...g){if(f){for(let g=u;g<this._length-f;g++)this._array[this._getCyclicIndex(g)]=this._array[this._getCyclicIndex(g+f)];this._length-=f,this.onDeleteEmitter.fire({index:u,amount:f})}for(let f=this._length-1;f>=u;f--)this._array[this._getCyclicIndex(f+g.length)]=this._array[this._getCyclicIndex(f)];for(let f=0;f<g.length;f++)this._array[this._getCyclicIndex(u+f)]=g[f];if(g.length&&this.onInsertEmitter.fire({index:u,amount:g.length}),this._length+g.length>this._maxLength){const u=this._length+g.length-this._maxLength;this._startIndex+=u,this._length=this._maxLength,this.onTrimEmitter.fire(u)}else this._length+=g.length}trimStart(u){u>this._length&&(u=this._length),this._startIndex+=u,this._length-=u,this.onTrimEmitter.fire(u)}shiftElements(u,f,g){if(!(f<=0)){if(u<0||u>=this._length)throw new Error("start argument out of range");if(u+g<0)throw new Error("Cannot shift elements in list beyond index 0");if(g>0){for(let m=f-1;m>=0;m--)this.set(u+m+g,this.get(u+m));const m=u+f+g-this._length;if(m>0)for(this._length+=m;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let m=0;m<f;m++)this.set(u+m+g,this.get(u+m))}}_getCyclicIndex(u){return(this._startIndex+u)%this._maxLength}}f.CircularList=n},1439:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.clone=void 0,f.clone=function e(u,f=5){if("object"!=typeof u)return u;const g=Array.isArray(u)?[]:{};for(const m in u)g[m]=f<=1?u[m]:u[m]&&e(u[m],f-1);return g}},8055:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.contrastRatio=f.toPaddedHex=f.rgba=f.rgb=f.css=f.color=f.channels=f.NULL_COLOR=void 0;let g=0,m=0,C=0,b=0;var y,E,L,R,x;function d(u){const f=u.toString(16);return f.length<2?"0"+f:f}function _(u,f){return u<f?(f+.05)/(u+.05):(u+.05)/(f+.05)}f.NULL_COLOR={css:"#00000000",rgba:0},function(u){u.toCss=function(u,f,g,m){return void 0!==m?`#${d(u)}${d(f)}${d(g)}${d(m)}`:`#${d(u)}${d(f)}${d(g)}`},u.toRgba=function(u,f,g,m=255){return(u<<24|f<<16|g<<8|m)>>>0},u.toColor=function(f,g,m,C){return{css:u.toCss(f,g,m,C),rgba:u.toRgba(f,g,m,C)}}}(y||(f.channels=y={})),function(u){function t(u,f){return b=Math.round(255*f),[g,m,C]=x.toChannels(u.rgba),{css:y.toCss(g,m,C,b),rgba:y.toRgba(g,m,C,b)}}u.blend=function(u,f){if(b=(255&f.rgba)/255,1===b)return{css:f.css,rgba:f.rgba};const E=f.rgba>>24&255,L=f.rgba>>16&255,R=f.rgba>>8&255,x=u.rgba>>24&255,A=u.rgba>>16&255,B=u.rgba>>8&255;return g=x+Math.round((E-x)*b),m=A+Math.round((L-A)*b),C=B+Math.round((R-B)*b),{css:y.toCss(g,m,C),rgba:y.toRgba(g,m,C)}},u.isOpaque=function(u){return 255==(255&u.rgba)},u.ensureContrastRatio=function(u,f,g){const m=x.ensureContrastRatio(u.rgba,f.rgba,g);if(m)return y.toColor(m>>24&255,m>>16&255,m>>8&255)},u.opaque=function(u){const f=(255|u.rgba)>>>0;return[g,m,C]=x.toChannels(f),{css:y.toCss(g,m,C),rgba:f}},u.opacity=t,u.multiplyOpacity=function(u,f){return b=255&u.rgba,t(u,b*f/255)},u.toColorRGB=function(u){return[u.rgba>>24&255,u.rgba>>16&255,u.rgba>>8&255]}}(E||(f.color=E={})),function(u){let f,E;try{const u=document.createElement("canvas");u.width=1,u.height=1;const g=u.getContext("2d",{willReadFrequently:!0});g&&(f=g,f.globalCompositeOperation="copy",E=f.createLinearGradient(0,0,1,1))}catch{}u.toColor=function(u){if(u.match(/#[\da-f]{3,8}/i))switch(u.length){case 4:return g=parseInt(u.slice(1,2).repeat(2),16),m=parseInt(u.slice(2,3).repeat(2),16),C=parseInt(u.slice(3,4).repeat(2),16),y.toColor(g,m,C);case 5:return g=parseInt(u.slice(1,2).repeat(2),16),m=parseInt(u.slice(2,3).repeat(2),16),C=parseInt(u.slice(3,4).repeat(2),16),b=parseInt(u.slice(4,5).repeat(2),16),y.toColor(g,m,C,b);case 7:return{css:u,rgba:(parseInt(u.slice(1),16)<<8|255)>>>0};case 9:return{css:u,rgba:parseInt(u.slice(1),16)>>>0}}const L=u.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(L)return g=parseInt(L[1]),m=parseInt(L[2]),C=parseInt(L[3]),b=Math.round(255*(void 0===L[5]?1:parseFloat(L[5]))),y.toColor(g,m,C,b);if(!f||!E)throw new Error("css.toColor: Unsupported css format");if(f.fillStyle=E,f.fillStyle=u,"string"!=typeof f.fillStyle)throw new Error("css.toColor: Unsupported css format");if(f.fillRect(0,0,1,1),[g,m,C,b]=f.getImageData(0,0,1,1).data,255!==b)throw new Error("css.toColor: Unsupported css format");return{rgba:y.toRgba(g,m,C,b),css:u}}}(L||(f.css=L={})),function(u){function t(u,f,g){const m=u/255,C=f/255,b=g/255;return.2126*(m<=.03928?m/12.92:Math.pow((m+.055)/1.055,2.4))+.7152*(C<=.03928?C/12.92:Math.pow((C+.055)/1.055,2.4))+.0722*(b<=.03928?b/12.92:Math.pow((b+.055)/1.055,2.4))}u.relativeLuminance=function(u){return t(u>>16&255,u>>8&255,255&u)},u.relativeLuminance2=t}(R||(f.rgb=R={})),function(u){function t(u,f,g){const m=u>>24&255,C=u>>16&255,b=u>>8&255;let y=f>>24&255,E=f>>16&255,L=f>>8&255,x=_(R.relativeLuminance2(y,E,L),R.relativeLuminance2(m,C,b));for(;x<g&&(y>0||E>0||L>0);)y-=Math.max(0,Math.ceil(.1*y)),E-=Math.max(0,Math.ceil(.1*E)),L-=Math.max(0,Math.ceil(.1*L)),x=_(R.relativeLuminance2(y,E,L),R.relativeLuminance2(m,C,b));return(y<<24|E<<16|L<<8|255)>>>0}function a(u,f,g){const m=u>>24&255,C=u>>16&255,b=u>>8&255;let y=f>>24&255,E=f>>16&255,L=f>>8&255,x=_(R.relativeLuminance2(y,E,L),R.relativeLuminance2(m,C,b));for(;x<g&&(y<255||E<255||L<255);)y=Math.min(255,y+Math.ceil(.1*(255-y))),E=Math.min(255,E+Math.ceil(.1*(255-E))),L=Math.min(255,L+Math.ceil(.1*(255-L))),x=_(R.relativeLuminance2(y,E,L),R.relativeLuminance2(m,C,b));return(y<<24|E<<16|L<<8|255)>>>0}u.blend=function(u,f){if(b=(255&f)/255,1===b)return f;const E=f>>24&255,L=f>>16&255,R=f>>8&255,x=u>>24&255,A=u>>16&255,B=u>>8&255;return g=x+Math.round((E-x)*b),m=A+Math.round((L-A)*b),C=B+Math.round((R-B)*b),y.toRgba(g,m,C)},u.ensureContrastRatio=function(u,f,g){const m=R.relativeLuminance(u>>8),C=R.relativeLuminance(f>>8);if(_(m,C)<g){if(C<m){const C=t(u,f,g),b=_(m,R.relativeLuminance(C>>8));if(b<g){const y=a(u,f,g);return b>_(m,R.relativeLuminance(y>>8))?C:y}return C}const b=a(u,f,g),y=_(m,R.relativeLuminance(b>>8));if(y<g){const C=t(u,f,g);return y>_(m,R.relativeLuminance(C>>8))?b:C}return b}},u.reduceLuminance=t,u.increaseLuminance=a,u.toChannels=function(u){return[u>>24&255,u>>16&255,u>>8&255,255&u]}}(x||(f.rgba=x={})),f.toPaddedHex=d,f.contrastRatio=_},8969:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.CoreTerminal=void 0;const m=g(844),C=g(2585),b=g(4348),y=g(7866),E=g(744),L=g(7302),R=g(6975),x=g(8460),A=g(1753),B=g(1480),T=g(7994),M=g(9282),O=g(5435),I=g(5981),H=g(2660);let F=!1;class S extends m.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new x.EventEmitter),this._onScroll.event((u=>{this._onScrollApi?.fire(u.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(u){for(const f in u)this.optionsService.options[f]=u[f]}constructor(u){super(),this._windowsWrappingHeuristics=this.register(new m.MutableDisposable),this._onBinary=this.register(new x.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new x.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new x.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new x.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new x.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new x.EventEmitter),this._instantiationService=new b.InstantiationService,this.optionsService=this.register(new L.OptionsService(u)),this._instantiationService.setService(C.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(E.BufferService)),this._instantiationService.setService(C.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(y.LogService)),this._instantiationService.setService(C.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(R.CoreService)),this._instantiationService.setService(C.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(A.CoreMouseService)),this._instantiationService.setService(C.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(B.UnicodeService)),this._instantiationService.setService(C.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(T.CharsetService),this._instantiationService.setService(C.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(H.OscLinkService),this._instantiationService.setService(C.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new O.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,x.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,x.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,x.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,x.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],(()=>this._handleWindowsPtyOptionChange()))),this.register(this._bufferService.onScroll((u=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((u=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new I.WriteBuffer(((u,f)=>this._inputHandler.parse(u,f)))),this.register((0,x.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(u,f){this._writeBuffer.write(u,f)}writeSync(u,f){this._logService.logLevel<=C.LogLevelEnum.WARN&&!F&&(this._logService.warn("writeSync is unreliable and will be removed soon."),F=!0),this._writeBuffer.writeSync(u,f)}input(u,f=!0){this.coreService.triggerDataEvent(u,f)}resize(u,f){isNaN(u)||isNaN(f)||(u=Math.max(u,E.MINIMUM_COLS),f=Math.max(f,E.MINIMUM_ROWS),this._bufferService.resize(u,f))}scroll(u,f=!1){this._bufferService.scroll(u,f)}scrollLines(u,f,g){this._bufferService.scrollLines(u,f,g)}scrollPages(u){this.scrollLines(u*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(u){const f=u-this._bufferService.buffer.ydisp;0!==f&&this.scrollLines(f)}registerEscHandler(u,f){return this._inputHandler.registerEscHandler(u,f)}registerDcsHandler(u,f){return this._inputHandler.registerDcsHandler(u,f)}registerCsiHandler(u,f){return this._inputHandler.registerCsiHandler(u,f)}registerOscHandler(u,f){return this._inputHandler.registerOscHandler(u,f)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let u=!1;const f=this.optionsService.rawOptions.windowsPty;f&&void 0!==f.buildNumber&&void 0!==f.buildNumber?u=!!("conpty"===f.backend&&f.buildNumber<21376):this.optionsService.rawOptions.windowsMode&&(u=!0),u?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const u=[];u.push(this.onLineFeed(M.updateWindowsModeWrappedState.bind(null,this._bufferService))),u.push(this.registerCsiHandler({final:"H"},(()=>((0,M.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsWrappingHeuristics.value=(0,m.toDisposable)((()=>{for(const f of u)f.dispose()}))}}}f.CoreTerminal=S},8460:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.runAndSubscribe=f.forwardEvent=f.EventEmitter=void 0,f.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=u=>(this._listeners.push(u),{dispose:()=>{if(!this._disposed)for(let f=0;f<this._listeners.length;f++)if(this._listeners[f]===u)return void this._listeners.splice(f,1)}})),this._event}fire(u,f){const g=[];for(let u=0;u<this._listeners.length;u++)g.push(this._listeners[u]);for(let m=0;m<g.length;m++)g[m].call(void 0,u,f)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},f.forwardEvent=function(u,f){return u((u=>f.fire(u)))},f.runAndSubscribe=function(u,f){return f(void 0),u((u=>f(u)))}},5435:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.InputHandler=g.WindowsOptionsReportType=void 0;const y=m(2584),E=m(7116),L=m(2015),R=m(844),x=m(482),A=m(8437),B=m(8460),T=m(643),M=m(511),O=m(3734),I=m(2585),H=m(1480),F=m(6242),W=m(6351),U=m(5941),N={"(":0,")":1,"*":2,"+":3,"-":1,".":2},$=131072;function w(u,f){if(u>24)return f.setWinLines||!1;switch(u){case 1:return!!f.restoreWin;case 2:return!!f.minimizeWin;case 3:return!!f.setWinPosition;case 4:return!!f.setWinSizePixels;case 5:return!!f.raiseWin;case 6:return!!f.lowerWin;case 7:return!!f.refreshWin;case 8:return!!f.setWinSizeChars;case 9:return!!f.maximizeWin;case 10:return!!f.fullscreenWin;case 11:return!!f.getWinState;case 13:return!!f.getWinPosition;case 14:return!!f.getWinSizePixels;case 15:return!!f.getScreenSizePixels;case 16:return!!f.getCellSizePixels;case 18:return!!f.getWinSizeChars;case 19:return!!f.getScreenSizeChars;case 20:return!!f.getIconTitle;case 21:return!!f.getWinTitle;case 22:return!!f.pushTitle;case 23:return!!f.popTitle;case 24:return!!f.setWinLines}return!1}var j;!function(u){u[u.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",u[u.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"}(j||(g.WindowsOptionsReportType=j={}));let z=0;class k extends R.Disposable{getAttrData(){return this._curAttrData}constructor(u,f,g,m,C,b,R,T,O=new L.EscapeSequenceParser){super(),this._bufferService=u,this._charsetService=f,this._coreService=g,this._logService=m,this._optionsService=C,this._oscLinkService=b,this._coreMouseService=R,this._unicodeService=T,this._parser=O,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new x.StringToUtf32,this._utf8Decoder=new x.Utf8ToUtf32,this._workCell=new M.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=A.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=A.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new B.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new B.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new B.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new B.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new B.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new B.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new B.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new B.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new B.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new B.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new B.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new B.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new B.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new K(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((u=>this._activeBuffer=u.activeBuffer))),this._parser.setCsiHandlerFallback(((u,f)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(u),params:f.toArray()})})),this._parser.setEscHandlerFallback((u=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(u)})})),this._parser.setExecuteHandlerFallback((u=>{this._logService.debug("Unknown EXECUTE code: ",{code:u})})),this._parser.setOscHandlerFallback(((u,f,g)=>{this._logService.debug("Unknown OSC code: ",{identifier:u,action:f,data:g})})),this._parser.setDcsHandlerFallback(((u,f,g)=>{"HOOK"===f&&(g=g.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(u),action:f,payload:g})})),this._parser.setPrintHandler(((u,f,g)=>this.print(u,f,g))),this._parser.registerCsiHandler({final:"@"},(u=>this.insertChars(u))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(u=>this.scrollLeft(u))),this._parser.registerCsiHandler({final:"A"},(u=>this.cursorUp(u))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(u=>this.scrollRight(u))),this._parser.registerCsiHandler({final:"B"},(u=>this.cursorDown(u))),this._parser.registerCsiHandler({final:"C"},(u=>this.cursorForward(u))),this._parser.registerCsiHandler({final:"D"},(u=>this.cursorBackward(u))),this._parser.registerCsiHandler({final:"E"},(u=>this.cursorNextLine(u))),this._parser.registerCsiHandler({final:"F"},(u=>this.cursorPrecedingLine(u))),this._parser.registerCsiHandler({final:"G"},(u=>this.cursorCharAbsolute(u))),this._parser.registerCsiHandler({final:"H"},(u=>this.cursorPosition(u))),this._parser.registerCsiHandler({final:"I"},(u=>this.cursorForwardTab(u))),this._parser.registerCsiHandler({final:"J"},(u=>this.eraseInDisplay(u,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(u=>this.eraseInDisplay(u,!0))),this._parser.registerCsiHandler({final:"K"},(u=>this.eraseInLine(u,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(u=>this.eraseInLine(u,!0))),this._parser.registerCsiHandler({final:"L"},(u=>this.insertLines(u))),this._parser.registerCsiHandler({final:"M"},(u=>this.deleteLines(u))),this._parser.registerCsiHandler({final:"P"},(u=>this.deleteChars(u))),this._parser.registerCsiHandler({final:"S"},(u=>this.scrollUp(u))),this._parser.registerCsiHandler({final:"T"},(u=>this.scrollDown(u))),this._parser.registerCsiHandler({final:"X"},(u=>this.eraseChars(u))),this._parser.registerCsiHandler({final:"Z"},(u=>this.cursorBackwardTab(u))),this._parser.registerCsiHandler({final:"`"},(u=>this.charPosAbsolute(u))),this._parser.registerCsiHandler({final:"a"},(u=>this.hPositionRelative(u))),this._parser.registerCsiHandler({final:"b"},(u=>this.repeatPrecedingCharacter(u))),this._parser.registerCsiHandler({final:"c"},(u=>this.sendDeviceAttributesPrimary(u))),this._parser.registerCsiHandler({prefix:">",final:"c"},(u=>this.sendDeviceAttributesSecondary(u))),this._parser.registerCsiHandler({final:"d"},(u=>this.linePosAbsolute(u))),this._parser.registerCsiHandler({final:"e"},(u=>this.vPositionRelative(u))),this._parser.registerCsiHandler({final:"f"},(u=>this.hVPosition(u))),this._parser.registerCsiHandler({final:"g"},(u=>this.tabClear(u))),this._parser.registerCsiHandler({final:"h"},(u=>this.setMode(u))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(u=>this.setModePrivate(u))),this._parser.registerCsiHandler({final:"l"},(u=>this.resetMode(u))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(u=>this.resetModePrivate(u))),this._parser.registerCsiHandler({final:"m"},(u=>this.charAttributes(u))),this._parser.registerCsiHandler({final:"n"},(u=>this.deviceStatus(u))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(u=>this.deviceStatusPrivate(u))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(u=>this.softReset(u))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(u=>this.setCursorStyle(u))),this._parser.registerCsiHandler({final:"r"},(u=>this.setScrollRegion(u))),this._parser.registerCsiHandler({final:"s"},(u=>this.saveCursor(u))),this._parser.registerCsiHandler({final:"t"},(u=>this.windowOptions(u))),this._parser.registerCsiHandler({final:"u"},(u=>this.restoreCursor(u))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(u=>this.insertColumns(u))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(u=>this.deleteColumns(u))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(u=>this.selectProtected(u))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(u=>this.requestMode(u,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(u=>this.requestMode(u,!1))),this._parser.setExecuteHandler(y.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(y.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(y.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(y.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(y.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(y.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(y.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(y.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(y.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(y.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(y.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(y.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new F.OscHandler((u=>(this.setTitle(u),this.setIconName(u),!0)))),this._parser.registerOscHandler(1,new F.OscHandler((u=>this.setIconName(u)))),this._parser.registerOscHandler(2,new F.OscHandler((u=>this.setTitle(u)))),this._parser.registerOscHandler(4,new F.OscHandler((u=>this.setOrReportIndexedColor(u)))),this._parser.registerOscHandler(8,new F.OscHandler((u=>this.setHyperlink(u)))),this._parser.registerOscHandler(10,new F.OscHandler((u=>this.setOrReportFgColor(u)))),this._parser.registerOscHandler(11,new F.OscHandler((u=>this.setOrReportBgColor(u)))),this._parser.registerOscHandler(12,new F.OscHandler((u=>this.setOrReportCursorColor(u)))),this._parser.registerOscHandler(104,new F.OscHandler((u=>this.restoreIndexedColor(u)))),this._parser.registerOscHandler(110,new F.OscHandler((u=>this.restoreFgColor(u)))),this._parser.registerOscHandler(111,new F.OscHandler((u=>this.restoreBgColor(u)))),this._parser.registerOscHandler(112,new F.OscHandler((u=>this.restoreCursorColor(u)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const u in E.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:u},(()=>this.selectCharset("("+u))),this._parser.registerEscHandler({intermediates:")",final:u},(()=>this.selectCharset(")"+u))),this._parser.registerEscHandler({intermediates:"*",final:u},(()=>this.selectCharset("*"+u))),this._parser.registerEscHandler({intermediates:"+",final:u},(()=>this.selectCharset("+"+u))),this._parser.registerEscHandler({intermediates:"-",final:u},(()=>this.selectCharset("-"+u))),this._parser.registerEscHandler({intermediates:".",final:u},(()=>this.selectCharset("."+u))),this._parser.registerEscHandler({intermediates:"/",final:u},(()=>this.selectCharset("/"+u)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((u=>(this._logService.error("Parsing error: ",u),u))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new W.DcsHandler(((u,f)=>this.requestStatusString(u,f))))}_preserveStack(u,f,g,m){this._parseStack.paused=!0,this._parseStack.cursorStartX=u,this._parseStack.cursorStartY=f,this._parseStack.decodedLength=g,this._parseStack.position=m}_logSlowResolvingAsync(u){this._logService.logLevel<=I.LogLevelEnum.WARN&&Promise.race([u,new Promise(((u,f)=>setTimeout((()=>f("#SLOW_TIMEOUT")),5e3)))]).catch((u=>{if("#SLOW_TIMEOUT"!==u)throw u;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(u,f){let g,m=this._activeBuffer.x,C=this._activeBuffer.y,b=0;const y=this._parseStack.paused;if(y){if(g=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,f))return this._logSlowResolvingAsync(g),g;m=this._parseStack.cursorStartX,C=this._parseStack.cursorStartY,this._parseStack.paused=!1,u.length>$&&(b=this._parseStack.position+$)}if(this._logService.logLevel<=I.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+("string"==typeof u?` "${u}"`:` "${Array.prototype.map.call(u,(u=>String.fromCharCode(u))).join("")}"`),"string"==typeof u?u.split("").map((u=>u.charCodeAt(0))):u),this._parseBuffer.length<u.length&&this._parseBuffer.length<$&&(this._parseBuffer=new Uint32Array(Math.min(u.length,$))),y||this._dirtyRowTracker.clearRange(),u.length>$)for(let f=b;f<u.length;f+=$){const b=f+$<u.length?f+$:u.length,y="string"==typeof u?this._stringDecoder.decode(u.substring(f,b),this._parseBuffer):this._utf8Decoder.decode(u.subarray(f,b),this._parseBuffer);if(g=this._parser.parse(this._parseBuffer,y))return this._preserveStack(m,C,y,f),this._logSlowResolvingAsync(g),g}else if(!y){const f="string"==typeof u?this._stringDecoder.decode(u,this._parseBuffer):this._utf8Decoder.decode(u,this._parseBuffer);if(g=this._parser.parse(this._parseBuffer,f))return this._preserveStack(m,C,f,0),this._logSlowResolvingAsync(g),g}this._activeBuffer.x===m&&this._activeBuffer.y===C||this._onCursorMove.fire();const E=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),L=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);L<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(L,this._bufferService.rows-1),Math.min(E,this._bufferService.rows-1))}print(u,f,g){let m,C;const b=this._charsetService.charset,y=this._optionsService.rawOptions.screenReaderMode,E=this._bufferService.cols,L=this._coreService.decPrivateModes.wraparound,R=this._coreService.modes.insertMode,B=this._curAttrData;let M=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&g-f>0&&2===M.getWidth(this._activeBuffer.x-1)&&M.setCellFromCodepoint(this._activeBuffer.x-1,0,1,B);let O=this._parser.precedingJoinState;for(let I=f;I<g;++I){if(m=u[I],m<127&&b){const u=b[String.fromCharCode(m)];u&&(m=u.charCodeAt(0))}const f=this._unicodeService.charProperties(m,O);C=H.UnicodeService.extractWidth(f);const g=H.UnicodeService.extractShouldJoin(f),F=g?H.UnicodeService.extractWidth(O):0;if(O=f,y&&this._onA11yChar.fire((0,x.stringFromCodePoint)(m)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+C-F>E)if(L){const u=M;let f=this._activeBuffer.x-F;for(this._activeBuffer.x=F,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),M=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),F>0&&M instanceof A.BufferLine&&M.copyCellsFrom(u,f,0,F,!1);f<E;)u.setCellFromCodepoint(f++,0,1,B)}else if(this._activeBuffer.x=E-1,2===C)continue;if(g&&this._activeBuffer.x){const u=M.getWidth(this._activeBuffer.x-1)?1:2;M.addCodepointToCell(this._activeBuffer.x-u,m,C);for(let u=C-F;--u>=0;)M.setCellFromCodepoint(this._activeBuffer.x++,0,0,B)}else if(R&&(M.insertCells(this._activeBuffer.x,C-F,this._activeBuffer.getNullCell(B)),2===M.getWidth(E-1)&&M.setCellFromCodepoint(E-1,T.NULL_CELL_CODE,T.NULL_CELL_WIDTH,B)),M.setCellFromCodepoint(this._activeBuffer.x++,m,C,B),C>0)for(;--C;)M.setCellFromCodepoint(this._activeBuffer.x++,0,0,B)}this._parser.precedingJoinState=O,this._activeBuffer.x<E&&g-f>0&&0===M.getWidth(this._activeBuffer.x)&&!M.hasContent(this._activeBuffer.x)&&M.setCellFromCodepoint(this._activeBuffer.x,0,1,B),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(u,f){return"t"!==u.final||u.prefix||u.intermediates?this._parser.registerCsiHandler(u,f):this._parser.registerCsiHandler(u,(u=>!w(u.params[0],this._optionsService.rawOptions.windowOptions)||f(u)))}registerDcsHandler(u,f){return this._parser.registerDcsHandler(u,new W.DcsHandler(f))}registerEscHandler(u,f){return this._parser.registerEscHandler(u,f)}registerOscHandler(u,f){return this._parser.registerOscHandler(u,new F.OscHandler(f))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(0===this._activeBuffer.x&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);u.hasWidth(this._activeBuffer.x)&&!u.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const u=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-u),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(u=this._bufferService.cols-1){this._activeBuffer.x=Math.min(u,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(u,f){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=u,this._activeBuffer.y=this._activeBuffer.scrollTop+f):(this._activeBuffer.x=u,this._activeBuffer.y=f),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(u,f){this._restrictCursor(),this._setCursor(this._activeBuffer.x+u,this._activeBuffer.y+f)}cursorUp(u){const f=this._activeBuffer.y-this._activeBuffer.scrollTop;return f>=0?this._moveCursor(0,-Math.min(f,u.params[0]||1)):this._moveCursor(0,-(u.params[0]||1)),!0}cursorDown(u){const f=this._activeBuffer.scrollBottom-this._activeBuffer.y;return f>=0?this._moveCursor(0,Math.min(f,u.params[0]||1)):this._moveCursor(0,u.params[0]||1),!0}cursorForward(u){return this._moveCursor(u.params[0]||1,0),!0}cursorBackward(u){return this._moveCursor(-(u.params[0]||1),0),!0}cursorNextLine(u){return this.cursorDown(u),this._activeBuffer.x=0,!0}cursorPrecedingLine(u){return this.cursorUp(u),this._activeBuffer.x=0,!0}cursorCharAbsolute(u){return this._setCursor((u.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(u){return this._setCursor(u.length>=2?(u.params[1]||1)-1:0,(u.params[0]||1)-1),!0}charPosAbsolute(u){return this._setCursor((u.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(u){return this._moveCursor(u.params[0]||1,0),!0}linePosAbsolute(u){return this._setCursor(this._activeBuffer.x,(u.params[0]||1)-1),!0}vPositionRelative(u){return this._moveCursor(0,u.params[0]||1),!0}hVPosition(u){return this.cursorPosition(u),!0}tabClear(u){const f=u.params[0];return 0===f?delete this._activeBuffer.tabs[this._activeBuffer.x]:3===f&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(u){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let f=u.params[0]||1;for(;f--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(u){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let f=u.params[0]||1;for(;f--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(u){const f=u.params[0];return 1===f&&(this._curAttrData.bg|=536870912),2!==f&&0!==f||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(u,f,g,m=!1,C=!1){const b=this._activeBuffer.lines.get(this._activeBuffer.ybase+u);b.replaceCells(f,g,this._activeBuffer.getNullCell(this._eraseAttrData()),C),m&&(b.isWrapped=!1)}_resetBufferLine(u,f=!1){const g=this._activeBuffer.lines.get(this._activeBuffer.ybase+u);g&&(g.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),f),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+u),g.isWrapped=!1)}eraseInDisplay(u,f=!1){let g;switch(this._restrictCursor(this._bufferService.cols),u.params[0]){case 0:for(g=this._activeBuffer.y,this._dirtyRowTracker.markDirty(g),this._eraseInBufferLine(g++,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,f);g<this._bufferService.rows;g++)this._resetBufferLine(g,f);this._dirtyRowTracker.markDirty(g);break;case 1:for(g=this._activeBuffer.y,this._dirtyRowTracker.markDirty(g),this._eraseInBufferLine(g,0,this._activeBuffer.x+1,!0,f),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(g+1).isWrapped=!1);g--;)this._resetBufferLine(g,f);this._dirtyRowTracker.markDirty(0);break;case 2:for(g=this._bufferService.rows,this._dirtyRowTracker.markDirty(g-1);g--;)this._resetBufferLine(g,f);this._dirtyRowTracker.markDirty(0);break;case 3:const u=this._activeBuffer.lines.length-this._bufferService.rows;u>0&&(this._activeBuffer.lines.trimStart(u),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-u,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-u,0),this._onScroll.fire(0))}return!0}eraseInLine(u,f=!1){switch(this._restrictCursor(this._bufferService.cols),u.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,f);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,f);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,f)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(u){this._restrictCursor();let f=u.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const g=this._activeBuffer.ybase+this._activeBuffer.y,m=this._bufferService.rows-1-this._activeBuffer.scrollBottom,C=this._bufferService.rows-1+this._activeBuffer.ybase-m+1;for(;f--;)this._activeBuffer.lines.splice(C-1,1),this._activeBuffer.lines.splice(g,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(u){this._restrictCursor();let f=u.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const g=this._activeBuffer.ybase+this._activeBuffer.y;let m;for(m=this._bufferService.rows-1-this._activeBuffer.scrollBottom,m=this._bufferService.rows-1+this._activeBuffer.ybase-m;f--;)this._activeBuffer.lines.splice(g,1),this._activeBuffer.lines.splice(m,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(u){this._restrictCursor();const f=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return f&&(f.insertCells(this._activeBuffer.x,u.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(u){this._restrictCursor();const f=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return f&&(f.deleteCells(this._activeBuffer.x,u.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(u){let f=u.params[0]||1;for(;f--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(u){let f=u.params[0]||1;for(;f--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(A.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(u){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const f=u.params[0]||1;for(let u=this._activeBuffer.scrollTop;u<=this._activeBuffer.scrollBottom;++u){const g=this._activeBuffer.lines.get(this._activeBuffer.ybase+u);g.deleteCells(0,f,this._activeBuffer.getNullCell(this._eraseAttrData())),g.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(u){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const f=u.params[0]||1;for(let u=this._activeBuffer.scrollTop;u<=this._activeBuffer.scrollBottom;++u){const g=this._activeBuffer.lines.get(this._activeBuffer.ybase+u);g.insertCells(0,f,this._activeBuffer.getNullCell(this._eraseAttrData())),g.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(u){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const f=u.params[0]||1;for(let u=this._activeBuffer.scrollTop;u<=this._activeBuffer.scrollBottom;++u){const g=this._activeBuffer.lines.get(this._activeBuffer.ybase+u);g.insertCells(this._activeBuffer.x,f,this._activeBuffer.getNullCell(this._eraseAttrData())),g.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(u){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const f=u.params[0]||1;for(let u=this._activeBuffer.scrollTop;u<=this._activeBuffer.scrollBottom;++u){const g=this._activeBuffer.lines.get(this._activeBuffer.ybase+u);g.deleteCells(this._activeBuffer.x,f,this._activeBuffer.getNullCell(this._eraseAttrData())),g.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(u){this._restrictCursor();const f=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return f&&(f.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(u.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(u){const f=this._parser.precedingJoinState;if(!f)return!0;const g=u.params[0]||1,m=H.UnicodeService.extractWidth(f),C=this._activeBuffer.x-m,b=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(C),y=new Uint32Array(b.length*g);let E=0;for(let u=0;u<b.length;){const f=b.codePointAt(u)||0;y[E++]=f,u+=f>65535?2:1}let L=E;for(let u=1;u<g;++u)y.copyWithin(L,0,E),L+=E;return this.print(y,0,L),!0}sendDeviceAttributesPrimary(u){return u.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(y.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(y.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(u){return u.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(y.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(y.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(u.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(y.C0.ESC+"[>83;40003;0c")),!0}_is(u){return 0===(this._optionsService.rawOptions.termName+"").indexOf(u)}setMode(u){for(let f=0;f<u.length;f++)switch(u.params[f]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(u){for(let f=0;f<u.length;f++)switch(u.params[f]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,E.DEFAULT_CHARSET),this._charsetService.setgCharset(1,E.DEFAULT_CHARSET),this._charsetService.setgCharset(2,E.DEFAULT_CHARSET),this._charsetService.setgCharset(3,E.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(u){for(let f=0;f<u.length;f++)switch(u.params[f]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(u){for(let f=0;f<u.length;f++)switch(u.params[f]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),1049===u.params[f]&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(u,f){const g=this._coreService.decPrivateModes,{activeProtocol:m,activeEncoding:C}=this._coreMouseService,b=this._coreService,{buffers:E,cols:L}=this._bufferService,{active:R,alt:x}=E,A=this._optionsService.rawOptions,_=u=>u?1:2,B=u.params[0];return T=B,M=f?2===B?4:4===B?_(b.modes.insertMode):12===B?3:20===B?_(A.convertEol):0:1===B?_(g.applicationCursorKeys):3===B?A.windowOptions.setWinLines?80===L?2:132===L?1:0:0:6===B?_(g.origin):7===B?_(g.wraparound):8===B?3:9===B?_("X10"===m):12===B?_(A.cursorBlink):25===B?_(!b.isCursorHidden):45===B?_(g.reverseWraparound):66===B?_(g.applicationKeypad):67===B?4:1e3===B?_("VT200"===m):1002===B?_("DRAG"===m):1003===B?_("ANY"===m):1004===B?_(g.sendFocus):1005===B?4:1006===B?_("SGR"===C):1015===B?4:1016===B?_("SGR_PIXELS"===C):1048===B?1:47===B||1047===B||1049===B?_(R===x):2004===B?_(g.bracketedPasteMode):0,b.triggerDataEvent(`${y.C0.ESC}[${f?"":"?"}${T};${M}$y`),!0;var T,M}_updateAttrColor(u,f,g,m,C){return 2===f?(u|=50331648,u&=-16777216,u|=O.AttributeData.fromColorRGB([g,m,C])):5===f&&(u&=-50331904,u|=33554432|255&g),u}_extractColor(u,f,g){const m=[0,0,-1,0,0,0];let C=0,b=0;do{if(m[b+C]=u.params[f+b],u.hasSubParams(f+b)){const g=u.getSubParams(f+b);let y=0;do{5===m[1]&&(C=1),m[b+y+1+C]=g[y]}while(++y<g.length&&y+b+1+C<m.length);break}if(5===m[1]&&b+C>=2||2===m[1]&&b+C>=5)break;m[1]&&(C=1)}while(++b+f<u.length&&b+C<m.length);for(let u=2;u<m.length;++u)-1===m[u]&&(m[u]=0);switch(m[0]){case 38:g.fg=this._updateAttrColor(g.fg,m[1],m[3],m[4],m[5]);break;case 48:g.bg=this._updateAttrColor(g.bg,m[1],m[3],m[4],m[5]);break;case 58:g.extended=g.extended.clone(),g.extended.underlineColor=this._updateAttrColor(g.extended.underlineColor,m[1],m[3],m[4],m[5])}return b}_processUnderline(u,f){f.extended=f.extended.clone(),(!~u||u>5)&&(u=1),f.extended.underlineStyle=u,f.fg|=268435456,0===u&&(f.fg&=-268435457),f.updateExtended()}_processSGR0(u){u.fg=A.DEFAULT_ATTR_DATA.fg,u.bg=A.DEFAULT_ATTR_DATA.bg,u.extended=u.extended.clone(),u.extended.underlineStyle=0,u.extended.underlineColor&=-67108864,u.updateExtended()}charAttributes(u){if(1===u.length&&0===u.params[0])return this._processSGR0(this._curAttrData),!0;const f=u.length;let g;const m=this._curAttrData;for(let C=0;C<f;C++)g=u.params[C],g>=30&&g<=37?(m.fg&=-50331904,m.fg|=16777216|g-30):g>=40&&g<=47?(m.bg&=-50331904,m.bg|=16777216|g-40):g>=90&&g<=97?(m.fg&=-50331904,m.fg|=16777224|g-90):g>=100&&g<=107?(m.bg&=-50331904,m.bg|=16777224|g-100):0===g?this._processSGR0(m):1===g?m.fg|=134217728:3===g?m.bg|=67108864:4===g?(m.fg|=268435456,this._processUnderline(u.hasSubParams(C)?u.getSubParams(C)[0]:1,m)):5===g?m.fg|=536870912:7===g?m.fg|=67108864:8===g?m.fg|=1073741824:9===g?m.fg|=2147483648:2===g?m.bg|=134217728:21===g?this._processUnderline(2,m):22===g?(m.fg&=-134217729,m.bg&=-134217729):23===g?m.bg&=-67108865:24===g?(m.fg&=-268435457,this._processUnderline(0,m)):25===g?m.fg&=-536870913:27===g?m.fg&=-67108865:28===g?m.fg&=-1073741825:29===g?m.fg&=2147483647:39===g?(m.fg&=-67108864,m.fg|=16777215&A.DEFAULT_ATTR_DATA.fg):49===g?(m.bg&=-67108864,m.bg|=16777215&A.DEFAULT_ATTR_DATA.bg):38===g||48===g||58===g?C+=this._extractColor(u,C,m):53===g?m.bg|=1073741824:55===g?m.bg&=-1073741825:59===g?(m.extended=m.extended.clone(),m.extended.underlineColor=-1,m.updateExtended()):100===g?(m.fg&=-67108864,m.fg|=16777215&A.DEFAULT_ATTR_DATA.fg,m.bg&=-67108864,m.bg|=16777215&A.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",g);return!0}deviceStatus(u){switch(u.params[0]){case 5:this._coreService.triggerDataEvent(`${y.C0.ESC}[0n`);break;case 6:const u=this._activeBuffer.y+1,f=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${y.C0.ESC}[${u};${f}R`)}return!0}deviceStatusPrivate(u){if(6===u.params[0]){const u=this._activeBuffer.y+1,f=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${y.C0.ESC}[?${u};${f}R`)}return!0}softReset(u){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=A.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(u){const f=u.params[0]||1;switch(f){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const g=f%2==1;return this._optionsService.options.cursorBlink=g,!0}setScrollRegion(u){const f=u.params[0]||1;let g;return(u.length<2||(g=u.params[1])>this._bufferService.rows||0===g)&&(g=this._bufferService.rows),g>f&&(this._activeBuffer.scrollTop=f-1,this._activeBuffer.scrollBottom=g-1,this._setCursor(0,0)),!0}windowOptions(u){if(!w(u.params[0],this._optionsService.rawOptions.windowOptions))return!0;const f=u.length>1?u.params[1]:0;switch(u.params[0]){case 14:2!==f&&this._onRequestWindowsOptionsReport.fire(j.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(j.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${y.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:0!==f&&2!==f||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),0!==f&&1!==f||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:0!==f&&2!==f||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),0!==f&&1!==f||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(u){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(u){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(u){return this._windowTitle=u,this._onTitleChange.fire(u),!0}setIconName(u){return this._iconName=u,!0}setOrReportIndexedColor(u){const f=[],g=u.split(";");for(;g.length>1;){const u=g.shift(),m=g.shift();if(/^\d+$/.exec(u)){const g=parseInt(u);if(D(g))if("?"===m)f.push({type:0,index:g});else{const u=(0,U.parseColor)(m);u&&f.push({type:1,index:g,color:u})}}}return f.length&&this._onColor.fire(f),!0}setHyperlink(u){const f=u.split(";");return!(f.length<2)&&(f[1]?this._createHyperlink(f[0],f[1]):!f[0]&&this._finishHyperlink())}_createHyperlink(u,f){this._getCurrentLinkId()&&this._finishHyperlink();const g=u.split(":");let m;const C=g.findIndex((u=>u.startsWith("id=")));return-1!==C&&(m=g[C].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:m,uri:f}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(u,f){const g=u.split(";");for(let u=0;u<g.length&&!(f>=this._specialColors.length);++u,++f)if("?"===g[u])this._onColor.fire([{type:0,index:this._specialColors[f]}]);else{const m=(0,U.parseColor)(g[u]);m&&this._onColor.fire([{type:1,index:this._specialColors[f],color:m}])}return!0}setOrReportFgColor(u){return this._setOrReportSpecialColor(u,0)}setOrReportBgColor(u){return this._setOrReportSpecialColor(u,1)}setOrReportCursorColor(u){return this._setOrReportSpecialColor(u,2)}restoreIndexedColor(u){if(!u)return this._onColor.fire([{type:2}]),!0;const f=[],g=u.split(";");for(let u=0;u<g.length;++u)if(/^\d+$/.exec(g[u])){const m=parseInt(g[u]);D(m)&&f.push({type:2,index:m})}return f.length&&this._onColor.fire(f),!0}restoreFgColor(u){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(u){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(u){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,E.DEFAULT_CHARSET),!0}selectCharset(u){return 2!==u.length?(this.selectDefaultCharset(),!0):("/"===u[0]||this._charsetService.setgCharset(N[u[0]],E.CHARSETS[u[1]]||E.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const u=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,u,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=A.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=A.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(u){return this._charsetService.setgLevel(u),!0}screenAlignmentPattern(){const u=new M.CellData;u.content=1<<22|"E".charCodeAt(0),u.fg=this._curAttrData.fg,u.bg=this._curAttrData.bg,this._setCursor(0,0);for(let f=0;f<this._bufferService.rows;++f){const g=this._activeBuffer.ybase+this._activeBuffer.y+f,m=this._activeBuffer.lines.get(g);m&&(m.fill(u),m.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(u,f){const g=this._bufferService.buffer,m=this._optionsService.rawOptions;return(u=>(this._coreService.triggerDataEvent(`${y.C0.ESC}${u}${y.C0.ESC}\\`),!0))('"q'===u?`P1$r${this._curAttrData.isProtected()?1:0}"q`:'"p'===u?'P1$r61;1"p':"r"===u?`P1$r${g.scrollTop+1};${g.scrollBottom+1}r`:"m"===u?"P1$r0m":" q"===u?`P1$r${{block:2,underline:4,bar:6}[m.cursorStyle]-(m.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(u,f){this._dirtyRowTracker.markRangeDirty(u,f)}}g.InputHandler=k;let K=class{constructor(u){this._bufferService=u,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(u){u<this.start?this.start=u:u>this.end&&(this.end=u)}markRangeDirty(u,f){u>f&&(z=u,u=f,f=z),u<this.start&&(this.start=u),f>this.end&&(this.end=f)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function D(u){return 0<=u&&u<256}K=C([b(0,I.IBufferService)],K)},844:(u,f)=>{function i(u){for(const f of u)f.dispose();u.length=0}Object.defineProperty(f,"__esModule",{value:!0}),f.getDisposeArrayDisposable=f.disposeArray=f.toDisposable=f.MutableDisposable=f.Disposable=void 0,f.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const u of this._disposables)u.dispose();this._disposables.length=0}register(u){return this._disposables.push(u),u}unregister(u){const f=this._disposables.indexOf(u);-1!==f&&this._disposables.splice(f,1)}},f.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(u){this._isDisposed||u===this._value||(this._value?.dispose(),this._value=u)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},f.toDisposable=function(u){return{dispose:u}},f.disposeArray=i,f.getDisposeArrayDisposable=function(u){return{dispose:()=>i(u)}}},1505:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.FourKeyMap=f.TwoKeyMap=void 0;class i{constructor(){this._data={}}set(u,f,g){this._data[u]||(this._data[u]={}),this._data[u][f]=g}get(u,f){return this._data[u]?this._data[u][f]:void 0}clear(){this._data={}}}f.TwoKeyMap=i,f.FourKeyMap=class{constructor(){this._data=new i}set(u,f,g,m,C){this._data.get(u,f)||this._data.set(u,f,new i),this._data.get(u,f).set(g,m,C)}get(u,f,g,m){return this._data.get(u,f)?.get(g,m)}clear(){this._data.clear()}}},6114:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.isChromeOS=f.isLinux=f.isWindows=f.isIphone=f.isIpad=f.isMac=f.getSafariVersion=f.isSafari=f.isLegacyEdge=f.isFirefox=f.isNode=void 0,f.isNode="undefined"!=typeof process&&"title"in process;const g=f.isNode?"node":navigator.userAgent,m=f.isNode?"node":navigator.platform;f.isFirefox=g.includes("Firefox"),f.isLegacyEdge=g.includes("Edge"),f.isSafari=/^((?!chrome|android).)*safari/i.test(g),f.getSafariVersion=function(){if(!f.isSafari)return 0;const u=g.match(/Version\/(\d+)/);return null===u||u.length<2?0:parseInt(u[1])},f.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(m),f.isIpad="iPad"===m,f.isIphone="iPhone"===m,f.isWindows=["Windows","Win16","Win32","WinCE"].includes(m),f.isLinux=m.indexOf("Linux")>=0,f.isChromeOS=/\bCrOS\b/.test(g)},6106:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.SortedList=void 0;let g=0;f.SortedList=class{constructor(u){this._getKey=u,this._array=[]}clear(){this._array.length=0}insert(u){0!==this._array.length?(g=this._search(this._getKey(u)),this._array.splice(g,0,u)):this._array.push(u)}delete(u){if(0===this._array.length)return!1;const f=this._getKey(u);if(void 0===f)return!1;if(g=this._search(f),-1===g)return!1;if(this._getKey(this._array[g])!==f)return!1;do{if(this._array[g]===u)return this._array.splice(g,1),!0}while(++g<this._array.length&&this._getKey(this._array[g])===f);return!1}*getKeyIterator(u){if(0!==this._array.length&&(g=this._search(u),!(g<0||g>=this._array.length)&&this._getKey(this._array[g])===u))do{yield this._array[g]}while(++g<this._array.length&&this._getKey(this._array[g])===u)}forEachByKey(u,f){if(0!==this._array.length&&(g=this._search(u),!(g<0||g>=this._array.length)&&this._getKey(this._array[g])===u))do{f(this._array[g])}while(++g<this._array.length&&this._getKey(this._array[g])===u)}values(){return[...this._array].values()}_search(u){let f=0,g=this._array.length-1;for(;g>=f;){let m=f+g>>1;const C=this._getKey(this._array[m]);if(C>u)g=m-1;else{if(!(C<u)){for(;m>0&&this._getKey(this._array[m-1])===u;)m--;return m}f=m+1}}return f}}},7226:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DebouncedIdleTask=f.IdleTaskQueue=f.PriorityTaskQueue=void 0;const m=g(6114);class r{constructor(){this._tasks=[],this._i=0}enqueue(u){this._tasks.push(u),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(u){this._idleCallback=void 0;let f=0,g=0,m=u.timeRemaining(),C=0;for(;this._i<this._tasks.length;){if(f=Date.now(),this._tasks[this._i]()||this._i++,f=Math.max(1,Date.now()-f),g=Math.max(f,g),C=u.timeRemaining(),1.5*g>C)return m-f<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(m-f))}ms`),void this._start();m=C}this.clear()}}class n extends r{_requestCallback(u){return setTimeout((()=>u(this._createDeadline(16))))}_cancelCallback(u){clearTimeout(u)}_createDeadline(u){const f=Date.now()+u;return{timeRemaining:()=>Math.max(0,f-Date.now())}}}f.PriorityTaskQueue=n,f.IdleTaskQueue=!m.isNode&&"requestIdleCallback"in window?class extends r{_requestCallback(u){return requestIdleCallback(u)}_cancelCallback(u){cancelIdleCallback(u)}}:n,f.DebouncedIdleTask=class{constructor(){this._queue=new f.IdleTaskQueue}set(u){this._queue.clear(),this._queue.enqueue(u)}flush(){this._queue.flush()}}},9282:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.updateWindowsModeWrappedState=void 0;const m=g(643);f.updateWindowsModeWrappedState=function(u){const f=u.buffer.lines.get(u.buffer.ybase+u.buffer.y-1),g=f?.get(u.cols-1),C=u.buffer.lines.get(u.buffer.ybase+u.buffer.y);C&&g&&(C.isWrapped=g[m.CHAR_DATA_CODE_INDEX]!==m.NULL_CELL_CODE&&g[m.CHAR_DATA_CODE_INDEX]!==m.WHITESPACE_CELL_CODE)}},3734:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.ExtendedAttrs=f.AttributeData=void 0;class i{constructor(){this.fg=0,this.bg=0,this.extended=new s}static toColorRGB(u){return[u>>>16&255,u>>>8&255,255&u]}static fromColorRGB(u){return(255&u[0])<<16|(255&u[1])<<8|255&u[2]}clone(){const u=new i;return u.fg=this.fg,u.bg=this.bg,u.extended=this.extended.clone(),u}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return 50331648==(50331648&this.fg)}isBgRGB(){return 50331648==(50331648&this.bg)}isFgPalette(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)}isBgPalette(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)}isFgDefault(){return 0==(50331648&this.fg)}isBgDefault(){return 0==(50331648&this.bg)}isAttributeDefault(){return 0===this.fg&&0===this.bg}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?50331648==(50331648&this.extended.underlineColor):this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?16777216==(50331648&this.extended.underlineColor)||33554432==(50331648&this.extended.underlineColor):this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?0==(50331648&this.extended.underlineColor):this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}f.AttributeData=i;class s{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(u){this._ext=u}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(u){this._ext&=-469762049,this._ext|=u<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(u){this._ext&=-67108864,this._ext|=67108863&u}get urlId(){return this._urlId}set urlId(u){this._urlId=u}get underlineVariantOffset(){const u=(3758096384&this._ext)>>29;return u<0?4294967288^u:u}set underlineVariantOffset(u){this._ext&=536870911,this._ext|=u<<29&3758096384}constructor(u=0,f=0){this._ext=0,this._urlId=0,this._ext=u,this._urlId=f}clone(){return new s(this._ext,this._urlId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId}}f.ExtendedAttrs=s},9092:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Buffer=f.MAX_BUFFER_SIZE=void 0;const m=g(6349),C=g(7226),b=g(3734),y=g(8437),E=g(4634),L=g(511),R=g(643),x=g(4863),A=g(7116);f.MAX_BUFFER_SIZE=4294967295,f.Buffer=class{constructor(u,f,g){this._hasScrollback=u,this._optionsService=f,this._bufferService=g,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=y.DEFAULT_ATTR_DATA.clone(),this.savedCharset=A.DEFAULT_CHARSET,this.markers=[],this._nullCell=L.CellData.fromCharData([0,R.NULL_CELL_CHAR,R.NULL_CELL_WIDTH,R.NULL_CELL_CODE]),this._whitespaceCell=L.CellData.fromCharData([0,R.WHITESPACE_CELL_CHAR,R.WHITESPACE_CELL_WIDTH,R.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new C.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new m.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(u){return u?(this._nullCell.fg=u.fg,this._nullCell.bg=u.bg,this._nullCell.extended=u.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new b.ExtendedAttrs),this._nullCell}getWhitespaceCell(u){return u?(this._whitespaceCell.fg=u.fg,this._whitespaceCell.bg=u.bg,this._whitespaceCell.extended=u.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new b.ExtendedAttrs),this._whitespaceCell}getBlankLine(u,f){return new y.BufferLine(this._bufferService.cols,this.getNullCell(u),f)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const u=this.ybase+this.y-this.ydisp;return u>=0&&u<this._rows}_getCorrectBufferLength(u){if(!this._hasScrollback)return u;const g=u+this._optionsService.rawOptions.scrollback;return g>f.MAX_BUFFER_SIZE?f.MAX_BUFFER_SIZE:g}fillViewportRows(u){if(0===this.lines.length){void 0===u&&(u=y.DEFAULT_ATTR_DATA);let f=this._rows;for(;f--;)this.lines.push(this.getBlankLine(u))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new m.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(u,f){const g=this.getNullCell(y.DEFAULT_ATTR_DATA);let m=0;const C=this._getCorrectBufferLength(f);if(C>this.lines.maxLength&&(this.lines.maxLength=C),this.lines.length>0){if(this._cols<u)for(let f=0;f<this.lines.length;f++)m+=+this.lines.get(f).resize(u,g);let b=0;if(this._rows<f)for(let m=this._rows;m<f;m++)this.lines.length<f+this.ybase&&(this._optionsService.rawOptions.windowsMode||void 0!==this._optionsService.rawOptions.windowsPty.backend||void 0!==this._optionsService.rawOptions.windowsPty.buildNumber?this.lines.push(new y.BufferLine(u,g)):this.ybase>0&&this.lines.length<=this.ybase+this.y+b+1?(this.ybase--,b++,this.ydisp>0&&this.ydisp--):this.lines.push(new y.BufferLine(u,g)));else for(let u=this._rows;u>f;u--)this.lines.length>f+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(C<this.lines.maxLength){const u=this.lines.length-C;u>0&&(this.lines.trimStart(u),this.ybase=Math.max(this.ybase-u,0),this.ydisp=Math.max(this.ydisp-u,0),this.savedY=Math.max(this.savedY-u,0)),this.lines.maxLength=C}this.x=Math.min(this.x,u-1),this.y=Math.min(this.y,f-1),b&&(this.y+=b),this.savedX=Math.min(this.savedX,u-1),this.scrollTop=0}if(this.scrollBottom=f-1,this._isReflowEnabled&&(this._reflow(u,f),this._cols>u))for(let f=0;f<this.lines.length;f++)m+=+this.lines.get(f).resize(u,g);this._cols=u,this._rows=f,this._memoryCleanupQueue.clear(),m>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let u=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,u=!1);let f=0;for(;this._memoryCleanupPosition<this.lines.length;)if(f+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),f>100)return!0;return u}get _isReflowEnabled(){const u=this._optionsService.rawOptions.windowsPty;return u&&u.buildNumber?this._hasScrollback&&"conpty"===u.backend&&u.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(u,f){this._cols!==u&&(u>this._cols?this._reflowLarger(u,f):this._reflowSmaller(u,f))}_reflowLarger(u,f){const g=(0,E.reflowLargerGetLinesToRemove)(this.lines,this._cols,u,this.ybase+this.y,this.getNullCell(y.DEFAULT_ATTR_DATA));if(g.length>0){const m=(0,E.reflowLargerCreateNewLayout)(this.lines,g);(0,E.reflowLargerApplyNewLayout)(this.lines,m.layout),this._reflowLargerAdjustViewport(u,f,m.countRemoved)}}_reflowLargerAdjustViewport(u,f,g){const m=this.getNullCell(y.DEFAULT_ATTR_DATA);let C=g;for(;C-- >0;)0===this.ybase?(this.y>0&&this.y--,this.lines.length<f&&this.lines.push(new y.BufferLine(u,m))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-g,0)}_reflowSmaller(u,f){const g=this.getNullCell(y.DEFAULT_ATTR_DATA),m=[];let C=0;for(let b=this.lines.length-1;b>=0;b--){let L=this.lines.get(b);if(!L||!L.isWrapped&&L.getTrimmedLength()<=u)continue;const R=[L];for(;L.isWrapped&&b>0;)L=this.lines.get(--b),R.unshift(L);const x=this.ybase+this.y;if(x>=b&&x<b+R.length)continue;const A=R[R.length-1].getTrimmedLength(),B=(0,E.reflowSmallerGetNewLineLengths)(R,this._cols,u),T=B.length-R.length;let M;M=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+T):Math.max(0,this.lines.length-this.lines.maxLength+T);const O=[];for(let u=0;u<T;u++){const u=this.getBlankLine(y.DEFAULT_ATTR_DATA,!0);O.push(u)}O.length>0&&(m.push({start:b+R.length+C,newLines:O}),C+=O.length),R.push(...O);let I=B.length-1,H=B[I];0===H&&(I--,H=B[I]);let F=R.length-T-1,W=A;for(;F>=0;){const u=Math.min(W,H);if(void 0===R[I])break;if(R[I].copyCellsFrom(R[F],W-u,H-u,u,!0),H-=u,0===H&&(I--,H=B[I]),W-=u,0===W){F--;const u=Math.max(F,0);W=(0,E.getWrappedLineTrimmedLength)(R,u,this._cols)}}for(let f=0;f<R.length;f++)B[f]<u&&R[f].setCell(B[f],g);let U=T-M;for(;U-- >0;)0===this.ybase?this.y<f-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+C)-f&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+T,this.ybase+f-1)}if(m.length>0){const u=[],f=[];for(let u=0;u<this.lines.length;u++)f.push(this.lines.get(u));const g=this.lines.length;let b=g-1,y=0,E=m[y];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+C);let L=0;for(let R=Math.min(this.lines.maxLength-1,g+C-1);R>=0;R--)if(E&&E.start>b+L){for(let u=E.newLines.length-1;u>=0;u--)this.lines.set(R--,E.newLines[u]);R++,u.push({index:b+1,amount:E.newLines.length}),L+=E.newLines.length,E=m[++y]}else this.lines.set(R,f[b--]);let R=0;for(let f=u.length-1;f>=0;f--)u[f].index+=R,this.lines.onInsertEmitter.fire(u[f]),R+=u[f].amount;const x=Math.max(0,g+C-this.lines.maxLength);x>0&&this.lines.onTrimEmitter.fire(x)}}translateBufferLineToString(u,f,g=0,m){const C=this.lines.get(u);return C?C.translateToString(f,g,m):""}getWrappedRangeForLine(u){let f=u,g=u;for(;f>0&&this.lines.get(f).isWrapped;)f--;for(;g+1<this.lines.length&&this.lines.get(g+1).isWrapped;)g++;return{first:f,last:g}}setupTabStops(u){for(null!=u?this.tabs[u]||(u=this.prevStop(u)):(this.tabs={},u=0);u<this._cols;u+=this._optionsService.rawOptions.tabStopWidth)this.tabs[u]=!0}prevStop(u){for(null==u&&(u=this.x);!this.tabs[--u]&&u>0;);return u>=this._cols?this._cols-1:u<0?0:u}nextStop(u){for(null==u&&(u=this.x);!this.tabs[++u]&&u<this._cols;);return u>=this._cols?this._cols-1:u<0?0:u}clearMarkers(u){this._isClearing=!0;for(let f=0;f<this.markers.length;f++)this.markers[f].line===u&&(this.markers[f].dispose(),this.markers.splice(f--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let u=0;u<this.markers.length;u++)this.markers[u].dispose(),this.markers.splice(u--,1);this._isClearing=!1}addMarker(u){const f=new x.Marker(u);return this.markers.push(f),f.register(this.lines.onTrim((u=>{f.line-=u,f.line<0&&f.dispose()}))),f.register(this.lines.onInsert((u=>{f.line>=u.index&&(f.line+=u.amount)}))),f.register(this.lines.onDelete((u=>{f.line>=u.index&&f.line<u.index+u.amount&&f.dispose(),f.line>u.index&&(f.line-=u.amount)}))),f.register(f.onDispose((()=>this._removeMarker(f)))),f}_removeMarker(u){this._isClearing||this.markers.splice(this.markers.indexOf(u),1)}}},8437:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.BufferLine=f.DEFAULT_ATTR_DATA=void 0;const m=g(3734),C=g(511),b=g(643),y=g(482);f.DEFAULT_ATTR_DATA=Object.freeze(new m.AttributeData);let E=0;class h{constructor(u,f,g=!1){this.isWrapped=g,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*u);const m=f||C.CellData.fromCharData([0,b.NULL_CELL_CHAR,b.NULL_CELL_WIDTH,b.NULL_CELL_CODE]);for(let f=0;f<u;++f)this.setCell(f,m);this.length=u}get(u){const f=this._data[3*u+0],g=2097151&f;return[this._data[3*u+1],2097152&f?this._combined[u]:g?(0,y.stringFromCodePoint)(g):"",f>>22,2097152&f?this._combined[u].charCodeAt(this._combined[u].length-1):g]}set(u,f){this._data[3*u+1]=f[b.CHAR_DATA_ATTR_INDEX],f[b.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[u]=f[1],this._data[3*u+0]=2097152|u|f[b.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*u+0]=f[b.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|f[b.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(u){return this._data[3*u+0]>>22}hasWidth(u){return 12582912&this._data[3*u+0]}getFg(u){return this._data[3*u+1]}getBg(u){return this._data[3*u+2]}hasContent(u){return 4194303&this._data[3*u+0]}getCodePoint(u){const f=this._data[3*u+0];return 2097152&f?this._combined[u].charCodeAt(this._combined[u].length-1):2097151&f}isCombined(u){return 2097152&this._data[3*u+0]}getString(u){const f=this._data[3*u+0];return 2097152&f?this._combined[u]:2097151&f?(0,y.stringFromCodePoint)(2097151&f):""}isProtected(u){return 536870912&this._data[3*u+2]}loadCell(u,f){return E=3*u,f.content=this._data[E+0],f.fg=this._data[E+1],f.bg=this._data[E+2],2097152&f.content&&(f.combinedData=this._combined[u]),268435456&f.bg&&(f.extended=this._extendedAttrs[u]),f}setCell(u,f){2097152&f.content&&(this._combined[u]=f.combinedData),268435456&f.bg&&(this._extendedAttrs[u]=f.extended),this._data[3*u+0]=f.content,this._data[3*u+1]=f.fg,this._data[3*u+2]=f.bg}setCellFromCodepoint(u,f,g,m){268435456&m.bg&&(this._extendedAttrs[u]=m.extended),this._data[3*u+0]=f|g<<22,this._data[3*u+1]=m.fg,this._data[3*u+2]=m.bg}addCodepointToCell(u,f,g){let m=this._data[3*u+0];2097152&m?this._combined[u]+=(0,y.stringFromCodePoint)(f):2097151&m?(this._combined[u]=(0,y.stringFromCodePoint)(2097151&m)+(0,y.stringFromCodePoint)(f),m&=-2097152,m|=2097152):m=f|1<<22,g&&(m&=-12582913,m|=g<<22),this._data[3*u+0]=m}insertCells(u,f,g){if((u%=this.length)&&2===this.getWidth(u-1)&&this.setCellFromCodepoint(u-1,0,1,g),f<this.length-u){const m=new C.CellData;for(let g=this.length-u-f-1;g>=0;--g)this.setCell(u+f+g,this.loadCell(u+g,m));for(let m=0;m<f;++m)this.setCell(u+m,g)}else for(let f=u;f<this.length;++f)this.setCell(f,g);2===this.getWidth(this.length-1)&&this.setCellFromCodepoint(this.length-1,0,1,g)}deleteCells(u,f,g){if(u%=this.length,f<this.length-u){const m=new C.CellData;for(let g=0;g<this.length-u-f;++g)this.setCell(u+g,this.loadCell(u+f+g,m));for(let u=this.length-f;u<this.length;++u)this.setCell(u,g)}else for(let f=u;f<this.length;++f)this.setCell(f,g);u&&2===this.getWidth(u-1)&&this.setCellFromCodepoint(u-1,0,1,g),0!==this.getWidth(u)||this.hasContent(u)||this.setCellFromCodepoint(u,0,1,g)}replaceCells(u,f,g,m=!1){if(m)for(u&&2===this.getWidth(u-1)&&!this.isProtected(u-1)&&this.setCellFromCodepoint(u-1,0,1,g),f<this.length&&2===this.getWidth(f-1)&&!this.isProtected(f)&&this.setCellFromCodepoint(f,0,1,g);u<f&&u<this.length;)this.isProtected(u)||this.setCell(u,g),u++;else for(u&&2===this.getWidth(u-1)&&this.setCellFromCodepoint(u-1,0,1,g),f<this.length&&2===this.getWidth(f-1)&&this.setCellFromCodepoint(f,0,1,g);u<f&&u<this.length;)this.setCell(u++,g)}resize(u,f){if(u===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const g=3*u;if(u>this.length){if(this._data.buffer.byteLength>=4*g)this._data=new Uint32Array(this._data.buffer,0,g);else{const u=new Uint32Array(g);u.set(this._data),this._data=u}for(let g=this.length;g<u;++g)this.setCell(g,f)}else{this._data=this._data.subarray(0,g);const f=Object.keys(this._combined);for(let g=0;g<f.length;g++){const m=parseInt(f[g],10);m>=u&&delete this._combined[m]}const m=Object.keys(this._extendedAttrs);for(let f=0;f<m.length;f++){const g=parseInt(m[f],10);g>=u&&delete this._extendedAttrs[g]}}return this.length=u,4*g*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const u=new Uint32Array(this._data.length);return u.set(this._data),this._data=u,1}return 0}fill(u,f=!1){if(f)for(let f=0;f<this.length;++f)this.isProtected(f)||this.setCell(f,u);else{this._combined={},this._extendedAttrs={};for(let f=0;f<this.length;++f)this.setCell(f,u)}}copyFrom(u){this.length!==u.length?this._data=new Uint32Array(u._data):this._data.set(u._data),this.length=u.length,this._combined={};for(const f in u._combined)this._combined[f]=u._combined[f];this._extendedAttrs={};for(const f in u._extendedAttrs)this._extendedAttrs[f]=u._extendedAttrs[f];this.isWrapped=u.isWrapped}clone(){const u=new h(0);u._data=new Uint32Array(this._data),u.length=this.length;for(const f in this._combined)u._combined[f]=this._combined[f];for(const f in this._extendedAttrs)u._extendedAttrs[f]=this._extendedAttrs[f];return u.isWrapped=this.isWrapped,u}getTrimmedLength(){for(let u=this.length-1;u>=0;--u)if(4194303&this._data[3*u+0])return u+(this._data[3*u+0]>>22);return 0}getNoBgTrimmedLength(){for(let u=this.length-1;u>=0;--u)if(4194303&this._data[3*u+0]||50331648&this._data[3*u+2])return u+(this._data[3*u+0]>>22);return 0}copyCellsFrom(u,f,g,m,C){const b=u._data;if(C)for(let C=m-1;C>=0;C--){for(let u=0;u<3;u++)this._data[3*(g+C)+u]=b[3*(f+C)+u];268435456&b[3*(f+C)+2]&&(this._extendedAttrs[g+C]=u._extendedAttrs[f+C])}else for(let C=0;C<m;C++){for(let u=0;u<3;u++)this._data[3*(g+C)+u]=b[3*(f+C)+u];268435456&b[3*(f+C)+2]&&(this._extendedAttrs[g+C]=u._extendedAttrs[f+C])}const y=Object.keys(u._combined);for(let m=0;m<y.length;m++){const C=parseInt(y[m],10);C>=f&&(this._combined[C-f+g]=u._combined[C])}}translateToString(u,f,g,m){f=f??0,g=g??this.length,u&&(g=Math.min(g,this.getTrimmedLength())),m&&(m.length=0);let C="";for(;f<g;){const u=this._data[3*f+0],g=2097151&u,E=2097152&u?this._combined[f]:g?(0,y.stringFromCodePoint)(g):b.WHITESPACE_CELL_CHAR;if(C+=E,m)for(let u=0;u<E.length;++u)m.push(f);f+=u>>22||1}return m&&m.push(f),C}}f.BufferLine=h},4841:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.getRangeLength=void 0,f.getRangeLength=function(u,f){if(u.start.y>u.end.y)throw new Error(`Buffer range end (${u.end.x}, ${u.end.y}) cannot be before start (${u.start.x}, ${u.start.y})`);return f*(u.end.y-u.start.y)+(u.end.x-u.start.x+1)}},4634:(u,f)=>{function i(u,f,g){if(f===u.length-1)return u[f].getTrimmedLength();const m=!u[f].hasContent(g-1)&&1===u[f].getWidth(g-1),C=2===u[f+1].getWidth(0);return m&&C?g-1:g}Object.defineProperty(f,"__esModule",{value:!0}),f.getWrappedLineTrimmedLength=f.reflowSmallerGetNewLineLengths=f.reflowLargerApplyNewLayout=f.reflowLargerCreateNewLayout=f.reflowLargerGetLinesToRemove=void 0,f.reflowLargerGetLinesToRemove=function(u,f,g,m,C){const b=[];for(let y=0;y<u.length-1;y++){let E=y,L=u.get(++E);if(!L.isWrapped)continue;const R=[u.get(y)];for(;E<u.length&&L.isWrapped;)R.push(L),L=u.get(++E);if(m>=y&&m<E){y+=R.length-1;continue}let x=0,A=i(R,x,f),B=1,T=0;for(;B<R.length;){const u=i(R,B,f),m=u-T,b=g-A,y=Math.min(m,b);R[x].copyCellsFrom(R[B],T,A,y,!1),A+=y,A===g&&(x++,A=0),T+=y,T===u&&(B++,T=0),0===A&&0!==x&&2===R[x-1].getWidth(g-1)&&(R[x].copyCellsFrom(R[x-1],g-1,A++,1,!1),R[x-1].setCell(g-1,C))}R[x].replaceCells(A,g,C);let M=0;for(let u=R.length-1;u>0&&(u>x||0===R[u].getTrimmedLength());u--)M++;M>0&&(b.push(y+R.length-M),b.push(M)),y+=R.length-1}return b},f.reflowLargerCreateNewLayout=function(u,f){const g=[];let m=0,C=f[m],b=0;for(let y=0;y<u.length;y++)if(C===y){const g=f[++m];u.onDeleteEmitter.fire({index:y-b,amount:g}),y+=g-1,b+=g,C=f[++m]}else g.push(y);return{layout:g,countRemoved:b}},f.reflowLargerApplyNewLayout=function(u,f){const g=[];for(let m=0;m<f.length;m++)g.push(u.get(f[m]));for(let f=0;f<g.length;f++)u.set(f,g[f]);u.length=f.length},f.reflowSmallerGetNewLineLengths=function(u,f,g){const m=[],C=u.map(((g,m)=>i(u,m,f))).reduce(((u,f)=>u+f));let b=0,y=0,E=0;for(;E<C;){if(C-E<g){m.push(C-E);break}b+=g;const L=i(u,y,f);b>L&&(b-=L,y++);const R=2===u[y].getWidth(b-1);R&&b--;const x=R?g-1:g;m.push(x),E+=x}return m},f.getWrappedLineTrimmedLength=i},5295:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.BufferSet=void 0;const m=g(8460),C=g(844),b=g(9092);class o extends C.Disposable{constructor(u,f){super(),this._optionsService=u,this._bufferService=f,this._onBufferActivate=this.register(new m.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new b.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new b.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(u){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(u),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(u,f){this._normal.resize(u,f),this._alt.resize(u,f),this.setupTabStops(u)}setupTabStops(u){this._normal.setupTabStops(u),this._alt.setupTabStops(u)}}f.BufferSet=o},511:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.CellData=void 0;const m=g(482),C=g(643),b=g(3734);class o extends b.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new b.ExtendedAttrs,this.combinedData=""}static fromCharData(u){const f=new o;return f.setFromCharData(u),f}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,m.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(u){this.fg=u[C.CHAR_DATA_ATTR_INDEX],this.bg=0;let f=!1;if(u[C.CHAR_DATA_CHAR_INDEX].length>2)f=!0;else if(2===u[C.CHAR_DATA_CHAR_INDEX].length){const g=u[C.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=g&&g<=56319){const m=u[C.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=m&&m<=57343?this.content=1024*(g-55296)+m-56320+65536|u[C.CHAR_DATA_WIDTH_INDEX]<<22:f=!0}else f=!0}else this.content=u[C.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|u[C.CHAR_DATA_WIDTH_INDEX]<<22;f&&(this.combinedData=u[C.CHAR_DATA_CHAR_INDEX],this.content=2097152|u[C.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}f.CellData=o},643:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.WHITESPACE_CELL_CODE=f.WHITESPACE_CELL_WIDTH=f.WHITESPACE_CELL_CHAR=f.NULL_CELL_CODE=f.NULL_CELL_WIDTH=f.NULL_CELL_CHAR=f.CHAR_DATA_CODE_INDEX=f.CHAR_DATA_WIDTH_INDEX=f.CHAR_DATA_CHAR_INDEX=f.CHAR_DATA_ATTR_INDEX=f.DEFAULT_EXT=f.DEFAULT_ATTR=f.DEFAULT_COLOR=void 0,f.DEFAULT_COLOR=0,f.DEFAULT_ATTR=256|f.DEFAULT_COLOR<<9,f.DEFAULT_EXT=0,f.CHAR_DATA_ATTR_INDEX=0,f.CHAR_DATA_CHAR_INDEX=1,f.CHAR_DATA_WIDTH_INDEX=2,f.CHAR_DATA_CODE_INDEX=3,f.NULL_CELL_CHAR="",f.NULL_CELL_WIDTH=1,f.NULL_CELL_CODE=0,f.WHITESPACE_CELL_CHAR=" ",f.WHITESPACE_CELL_WIDTH=1,f.WHITESPACE_CELL_CODE=32},4863:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Marker=void 0;const m=g(8460),C=g(844);class n{get id(){return this._id}constructor(u){this.line=u,this.isDisposed=!1,this._disposables=[],this._id=n._nextId++,this._onDispose=this.register(new m.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,C.disposeArray)(this._disposables),this._disposables.length=0)}register(u){return this._disposables.push(u),u}}f.Marker=n,n._nextId=1},7116:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DEFAULT_CHARSET=f.CHARSETS=void 0,f.CHARSETS={},f.DEFAULT_CHARSET=f.CHARSETS.B,f.CHARSETS[0]={"`":"â",a:"â",b:"â",c:"â",d:"â",e:"â",f:"Â°",g:"Â±",h:"â¤",i:"â",j:"â",k:"â",l:"â",m:"â",n:"â¼",o:"âº",p:"â»",q:"â",r:"â¼",s:"â½",t:"â",u:"â¤",v:"â´",w:"â¬",x:"â",y:"â¤",z:"â¥","{":"Ï","|":"â ","}":"Â£","~":"Â·"},f.CHARSETS.A={"#":"Â£"},f.CHARSETS.B=void 0,f.CHARSETS[4]={"#":"Â£","@":"Â¾","[":"ij","\\":"Â½","]":"|","{":"Â¨","|":"f","}":"Â¼","~":"Â´"},f.CHARSETS.C=f.CHARSETS[5]={"[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã©","{":"Ã¤","|":"Ã¶","}":"Ã¥","~":"Ã¼"},f.CHARSETS.R={"#":"Â£","@":"Ã ","[":"Â°","\\":"Ã§","]":"Â§","{":"Ã©","|":"Ã¹","}":"Ã¨","~":"Â¨"},f.CHARSETS.Q={"@":"Ã ","[":"Ã¢","\\":"Ã§","]":"Ãª","^":"Ã®","`":"Ã´","{":"Ã©","|":"Ã¹","}":"Ã¨","~":"Ã»"},f.CHARSETS.K={"@":"Â§","[":"Ã","\\":"Ã","]":"Ã","{":"Ã¤","|":"Ã¶","}":"Ã¼","~":"Ã"},f.CHARSETS.Y={"#":"Â£","@":"Â§","[":"Â°","\\":"Ã§","]":"Ã©","`":"Ã¹","{":"Ã ","|":"Ã²","}":"Ã¨","~":"Ã¬"},f.CHARSETS.E=f.CHARSETS[6]={"@":"Ã","[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã¤","{":"Ã¦","|":"Ã¸","}":"Ã¥","~":"Ã¼"},f.CHARSETS.Z={"#":"Â£","@":"Â§","[":"Â¡","\\":"Ã","]":"Â¿","{":"Â°","|":"Ã±","}":"Ã§"},f.CHARSETS.H=f.CHARSETS[7]={"@":"Ã","[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã©","{":"Ã¤","|":"Ã¶","}":"Ã¥","~":"Ã¼"},f.CHARSETS["="]={"#":"Ã¹","@":"Ã ","[":"Ã©","\\":"Ã§","]":"Ãª","^":"Ã®",_:"Ã¨","`":"Ã´","{":"Ã¤","|":"Ã¶","}":"Ã¼","~":"Ã»"}},2584:(u,f)=>{var g,m,C;Object.defineProperty(f,"__esModule",{value:!0}),f.C1_ESCAPED=f.C1=f.C0=void 0,function(u){u.NUL="\0",u.SOH="",u.STX="",u.ETX="",u.EOT="",u.ENQ="",u.ACK="",u.BEL="",u.BS="\b",u.HT="\t",u.LF="\n",u.VT="\v",u.FF="\f",u.CR="\r",u.SO="",u.SI="",u.DLE="",u.DC1="",u.DC2="",u.DC3="",u.DC4="",u.NAK="",u.SYN="",u.ETB="",u.CAN="",u.EM="",u.SUB="",u.ESC="",u.FS="",u.GS="",u.RS="",u.US="",u.SP=" ",u.DEL=""}(g||(f.C0=g={})),function(u){u.PAD="Â",u.HOP="Â",u.BPH="Â",u.NBH="Â",u.IND="Â",u.NEL="Â",u.SSA="Â",u.ESA="Â",u.HTS="Â",u.HTJ="Â",u.VTS="Â",u.PLD="Â",u.PLU="Â",u.RI="Â",u.SS2="Â",u.SS3="Â",u.DCS="Â",u.PU1="Â",u.PU2="Â",u.STS="Â",u.CCH="Â",u.MW="Â",u.SPA="Â",u.EPA="Â",u.SOS="Â",u.SGCI="Â",u.SCI="Â",u.CSI="Â",u.ST="Â",u.OSC="Â",u.PM="Â",u.APC="Â"}(m||(f.C1=m={})),function(u){u.ST=`${g.ESC}\\`}(C||(f.C1_ESCAPED=C={}))},7399:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.evaluateKeyboardEvent=void 0;const m=g(2584),C={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};f.evaluateKeyboardEvent=function(u,f,g,b){const y={type:0,cancel:!1,key:void 0},E=(u.shiftKey?1:0)|(u.altKey?2:0)|(u.ctrlKey?4:0)|(u.metaKey?8:0);switch(u.keyCode){case 0:"UIKeyInputUpArrow"===u.key?y.key=f?m.C0.ESC+"OA":m.C0.ESC+"[A":"UIKeyInputLeftArrow"===u.key?y.key=f?m.C0.ESC+"OD":m.C0.ESC+"[D":"UIKeyInputRightArrow"===u.key?y.key=f?m.C0.ESC+"OC":m.C0.ESC+"[C":"UIKeyInputDownArrow"===u.key&&(y.key=f?m.C0.ESC+"OB":m.C0.ESC+"[B");break;case 8:y.key=u.ctrlKey?"\b":m.C0.DEL,u.altKey&&(y.key=m.C0.ESC+y.key);break;case 9:if(u.shiftKey){y.key=m.C0.ESC+"[Z";break}y.key=m.C0.HT,y.cancel=!0;break;case 13:y.key=u.altKey?m.C0.ESC+m.C0.CR:m.C0.CR,y.cancel=!0;break;case 27:y.key=m.C0.ESC,u.altKey&&(y.key=m.C0.ESC+m.C0.ESC),y.cancel=!0;break;case 37:if(u.metaKey)break;E?(y.key=m.C0.ESC+"[1;"+(E+1)+"D",y.key===m.C0.ESC+"[1;3D"&&(y.key=m.C0.ESC+(g?"b":"[1;5D"))):y.key=f?m.C0.ESC+"OD":m.C0.ESC+"[D";break;case 39:if(u.metaKey)break;E?(y.key=m.C0.ESC+"[1;"+(E+1)+"C",y.key===m.C0.ESC+"[1;3C"&&(y.key=m.C0.ESC+(g?"f":"[1;5C"))):y.key=f?m.C0.ESC+"OC":m.C0.ESC+"[C";break;case 38:if(u.metaKey)break;E?(y.key=m.C0.ESC+"[1;"+(E+1)+"A",g||y.key!==m.C0.ESC+"[1;3A"||(y.key=m.C0.ESC+"[1;5A")):y.key=f?m.C0.ESC+"OA":m.C0.ESC+"[A";break;case 40:if(u.metaKey)break;E?(y.key=m.C0.ESC+"[1;"+(E+1)+"B",g||y.key!==m.C0.ESC+"[1;3B"||(y.key=m.C0.ESC+"[1;5B")):y.key=f?m.C0.ESC+"OB":m.C0.ESC+"[B";break;case 45:u.shiftKey||u.ctrlKey||(y.key=m.C0.ESC+"[2~");break;case 46:y.key=E?m.C0.ESC+"[3;"+(E+1)+"~":m.C0.ESC+"[3~";break;case 36:y.key=E?m.C0.ESC+"[1;"+(E+1)+"H":f?m.C0.ESC+"OH":m.C0.ESC+"[H";break;case 35:y.key=E?m.C0.ESC+"[1;"+(E+1)+"F":f?m.C0.ESC+"OF":m.C0.ESC+"[F";break;case 33:u.shiftKey?y.type=2:u.ctrlKey?y.key=m.C0.ESC+"[5;"+(E+1)+"~":y.key=m.C0.ESC+"[5~";break;case 34:u.shiftKey?y.type=3:u.ctrlKey?y.key=m.C0.ESC+"[6;"+(E+1)+"~":y.key=m.C0.ESC+"[6~";break;case 112:y.key=E?m.C0.ESC+"[1;"+(E+1)+"P":m.C0.ESC+"OP";break;case 113:y.key=E?m.C0.ESC+"[1;"+(E+1)+"Q":m.C0.ESC+"OQ";break;case 114:y.key=E?m.C0.ESC+"[1;"+(E+1)+"R":m.C0.ESC+"OR";break;case 115:y.key=E?m.C0.ESC+"[1;"+(E+1)+"S":m.C0.ESC+"OS";break;case 116:y.key=E?m.C0.ESC+"[15;"+(E+1)+"~":m.C0.ESC+"[15~";break;case 117:y.key=E?m.C0.ESC+"[17;"+(E+1)+"~":m.C0.ESC+"[17~";break;case 118:y.key=E?m.C0.ESC+"[18;"+(E+1)+"~":m.C0.ESC+"[18~";break;case 119:y.key=E?m.C0.ESC+"[19;"+(E+1)+"~":m.C0.ESC+"[19~";break;case 120:y.key=E?m.C0.ESC+"[20;"+(E+1)+"~":m.C0.ESC+"[20~";break;case 121:y.key=E?m.C0.ESC+"[21;"+(E+1)+"~":m.C0.ESC+"[21~";break;case 122:y.key=E?m.C0.ESC+"[23;"+(E+1)+"~":m.C0.ESC+"[23~";break;case 123:y.key=E?m.C0.ESC+"[24;"+(E+1)+"~":m.C0.ESC+"[24~";break;default:if(!u.ctrlKey||u.shiftKey||u.altKey||u.metaKey)if(g&&!b||!u.altKey||u.metaKey)!g||u.altKey||u.ctrlKey||u.shiftKey||!u.metaKey?u.key&&!u.ctrlKey&&!u.altKey&&!u.metaKey&&u.keyCode>=48&&1===u.key.length?y.key=u.key:u.key&&u.ctrlKey&&("_"===u.key&&(y.key=m.C0.US),"@"===u.key&&(y.key=m.C0.NUL)):65===u.keyCode&&(y.type=1);else{const f=C[u.keyCode],g=f?.[u.shiftKey?1:0];if(g)y.key=m.C0.ESC+g;else if(u.keyCode>=65&&u.keyCode<=90){const f=u.ctrlKey?u.keyCode-64:u.keyCode+32;let g=String.fromCharCode(f);u.shiftKey&&(g=g.toUpperCase()),y.key=m.C0.ESC+g}else if(32===u.keyCode)y.key=m.C0.ESC+(u.ctrlKey?m.C0.NUL:" ");else if("Dead"===u.key&&u.code.startsWith("Key")){let f=u.code.slice(3,4);u.shiftKey||(f=f.toLowerCase()),y.key=m.C0.ESC+f,y.cancel=!0}}else u.keyCode>=65&&u.keyCode<=90?y.key=String.fromCharCode(u.keyCode-64):32===u.keyCode?y.key=m.C0.NUL:u.keyCode>=51&&u.keyCode<=55?y.key=String.fromCharCode(u.keyCode-51+27):56===u.keyCode?y.key=m.C0.DEL:219===u.keyCode?y.key=m.C0.ESC:220===u.keyCode?y.key=m.C0.FS:221===u.keyCode&&(y.key=m.C0.GS)}return y}},482:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Utf8ToUtf32=f.StringToUtf32=f.utf32ToString=f.stringFromCodePoint=void 0,f.stringFromCodePoint=function(u){return u>65535?(u-=65536,String.fromCharCode(55296+(u>>10))+String.fromCharCode(u%1024+56320)):String.fromCharCode(u)},f.utf32ToString=function(u,f=0,g=u.length){let m="";for(let C=f;C<g;++C){let f=u[C];f>65535?(f-=65536,m+=String.fromCharCode(55296+(f>>10))+String.fromCharCode(f%1024+56320)):m+=String.fromCharCode(f)}return m},f.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(u,f){const g=u.length;if(!g)return 0;let m=0,C=0;if(this._interim){const g=u.charCodeAt(C++);56320<=g&&g<=57343?f[m++]=1024*(this._interim-55296)+g-56320+65536:(f[m++]=this._interim,f[m++]=g),this._interim=0}for(let b=C;b<g;++b){const C=u.charCodeAt(b);if(55296<=C&&C<=56319){if(++b>=g)return this._interim=C,m;const y=u.charCodeAt(b);56320<=y&&y<=57343?f[m++]=1024*(C-55296)+y-56320+65536:(f[m++]=C,f[m++]=y)}else 65279!==C&&(f[m++]=C)}return m}},f.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(u,f){const g=u.length;if(!g)return 0;let m,C,b,y,E=0,L=0,R=0;if(this.interim[0]){let m=!1,C=this.interim[0];C&=192==(224&C)?31:224==(240&C)?15:7;let b,y=0;for(;(b=63&this.interim[++y])&&y<4;)C<<=6,C|=b;const L=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,x=L-y;for(;R<x;){if(R>=g)return 0;if(b=u[R++],128!=(192&b)){R--,m=!0;break}this.interim[y++]=b,C<<=6,C|=63&b}m||(2===L?C<128?R--:f[E++]=C:3===L?C<2048||C>=55296&&C<=57343||65279===C||(f[E++]=C):C<65536||C>1114111||(f[E++]=C)),this.interim.fill(0)}const x=g-4;let A=R;for(;A<g;){for(;!(!(A<x)||128&(m=u[A])||128&(C=u[A+1])||128&(b=u[A+2])||128&(y=u[A+3]));)f[E++]=m,f[E++]=C,f[E++]=b,f[E++]=y,A+=4;if(m=u[A++],m<128)f[E++]=m;else if(192==(224&m)){if(A>=g)return this.interim[0]=m,E;if(C=u[A++],128!=(192&C)){A--;continue}if(L=(31&m)<<6|63&C,L<128){A--;continue}f[E++]=L}else if(224==(240&m)){if(A>=g)return this.interim[0]=m,E;if(C=u[A++],128!=(192&C)){A--;continue}if(A>=g)return this.interim[0]=m,this.interim[1]=C,E;if(b=u[A++],128!=(192&b)){A--;continue}if(L=(15&m)<<12|(63&C)<<6|63&b,L<2048||L>=55296&&L<=57343||65279===L)continue;f[E++]=L}else if(240==(248&m)){if(A>=g)return this.interim[0]=m,E;if(C=u[A++],128!=(192&C)){A--;continue}if(A>=g)return this.interim[0]=m,this.interim[1]=C,E;if(b=u[A++],128!=(192&b)){A--;continue}if(A>=g)return this.interim[0]=m,this.interim[1]=C,this.interim[2]=b,E;if(y=u[A++],128!=(192&y)){A--;continue}if(L=(7&m)<<18|(63&C)<<12|(63&b)<<6|63&y,L<65536||L>1114111)continue;f[E++]=L}}return E}}},225:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.UnicodeV6=void 0;const m=g(1480),C=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],b=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let y;f.UnicodeV6=class{constructor(){if(this.version="6",!y){y=new Uint8Array(65536),y.fill(1),y[0]=0,y.fill(0,1,32),y.fill(0,127,160),y.fill(2,4352,4448),y[9001]=2,y[9002]=2,y.fill(2,11904,42192),y[12351]=1,y.fill(2,44032,55204),y.fill(2,63744,64256),y.fill(2,65040,65050),y.fill(2,65072,65136),y.fill(2,65280,65377),y.fill(2,65504,65511);for(let u=0;u<C.length;++u)y.fill(0,C[u][0],C[u][1]+1)}}wcwidth(u){return u<32?0:u<127?1:u<65536?y[u]:function(u,f){let g,m=0,C=f.length-1;if(u<f[0][0]||u>f[C][1])return!1;for(;C>=m;)if(g=m+C>>1,u>f[g][1])m=g+1;else{if(!(u<f[g][0]))return!0;C=g-1}return!1}(u,b)?0:u>=131072&&u<=196605||u>=196608&&u<=262141?2:1}charProperties(u,f){let g=this.wcwidth(u),C=0===g&&0!==f;if(C){const u=m.UnicodeService.extractWidth(f);0===u?C=!1:u>g&&(g=u)}return m.UnicodeService.createPropertyValue(0,g,C)}}},5981:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.WriteBuffer=void 0;const m=g(8460),C=g(844);class n extends C.Disposable{constructor(u){super(),this._action=u,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new m.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(u,f){if(void 0!==f&&this._syncCalls>f)return void(this._syncCalls=0);if(this._pendingData+=u.length,this._writeBuffer.push(u),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let g;for(this._isSyncWriting=!0;g=this._writeBuffer.shift();){this._action(g);const u=this._callbacks.shift();u&&u()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(u,f){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=u.length,this._writeBuffer.push(u),this._callbacks.push(f),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=u.length,this._writeBuffer.push(u),this._callbacks.push(f)}_innerWrite(u=0,f=!0){const g=u||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const u=this._writeBuffer[this._bufferOffset],m=this._action(u,f);if(m){const e=u=>Date.now()-g>=12?setTimeout((()=>this._innerWrite(0,u))):this._innerWrite(g,u);return void m.catch((u=>(queueMicrotask((()=>{throw u})),Promise.resolve(!1)))).then(e)}const C=this._callbacks[this._bufferOffset];if(C&&C(),this._bufferOffset++,this._pendingData-=u.length,Date.now()-g>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}f.WriteBuffer=n},5941:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.toRgbString=f.parseColor=void 0;const g=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,m=/^[\da-f]+$/;function r(u,f){const g=u.toString(16),m=g.length<2?"0"+g:g;switch(f){case 4:return g[0];case 8:return m;case 12:return(m+m).slice(0,3);default:return m+m}}f.parseColor=function(u){if(!u)return;let f=u.toLowerCase();if(0===f.indexOf("rgb:")){f=f.slice(4);const u=g.exec(f);if(u){const f=u[1]?15:u[4]?255:u[7]?4095:65535;return[Math.round(parseInt(u[1]||u[4]||u[7]||u[10],16)/f*255),Math.round(parseInt(u[2]||u[5]||u[8]||u[11],16)/f*255),Math.round(parseInt(u[3]||u[6]||u[9]||u[12],16)/f*255)]}}else if(0===f.indexOf("#")&&(f=f.slice(1),m.exec(f)&&[3,6,9,12].includes(f.length))){const u=f.length/3,g=[0,0,0];for(let m=0;m<3;++m){const C=parseInt(f.slice(u*m,u*m+u),16);g[m]=1===u?C<<4:2===u?C:3===u?C>>4:C>>8}return g}},f.toRgbString=function(u,f=16){const[g,m,C]=u;return`rgb:${r(g,f)}/${r(m,f)}/${r(C,f)}`}},5770:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PAYLOAD_LIMIT=void 0,f.PAYLOAD_LIMIT=1e7},6351:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DcsHandler=f.DcsParser=void 0;const m=g(482),C=g(8742),b=g(5770),y=[];f.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=y,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=y}registerHandler(u,f){void 0===this._handlers[u]&&(this._handlers[u]=[]);const g=this._handlers[u];return g.push(f),{dispose:()=>{const u=g.indexOf(f);-1!==u&&g.splice(u,1)}}}clearHandler(u){this._handlers[u]&&delete this._handlers[u]}setHandlerFallback(u){this._handlerFb=u}reset(){if(this._active.length)for(let u=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;u>=0;--u)this._active[u].unhook(!1);this._stack.paused=!1,this._active=y,this._ident=0}hook(u,f){if(this.reset(),this._ident=u,this._active=this._handlers[u]||y,this._active.length)for(let u=this._active.length-1;u>=0;u--)this._active[u].hook(f);else this._handlerFb(this._ident,"HOOK",f)}put(u,f,g){if(this._active.length)for(let m=this._active.length-1;m>=0;m--)this._active[m].put(u,f,g);else this._handlerFb(this._ident,"PUT",(0,m.utf32ToString)(u,f,g))}unhook(u,f=!0){if(this._active.length){let g=!1,m=this._active.length-1,C=!1;if(this._stack.paused&&(m=this._stack.loopPosition-1,g=f,C=this._stack.fallThrough,this._stack.paused=!1),!C&&!1===g){for(;m>=0&&(g=this._active[m].unhook(u),!0!==g);m--)if(g instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=m,this._stack.fallThrough=!1,g;m--}for(;m>=0;m--)if(g=this._active[m].unhook(!1),g instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=m,this._stack.fallThrough=!0,g}else this._handlerFb(this._ident,"UNHOOK",u);this._active=y,this._ident=0}};const E=new C.Params;E.addParam(0),f.DcsHandler=class{constructor(u){this._handler=u,this._data="",this._params=E,this._hitLimit=!1}hook(u){this._params=u.length>1||u.params[0]?u.clone():E,this._data="",this._hitLimit=!1}put(u,f,g){this._hitLimit||(this._data+=(0,m.utf32ToString)(u,f,g),this._data.length>b.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(u){let f=!1;if(this._hitLimit)f=!1;else if(u&&(f=this._handler(this._data,this._params),f instanceof Promise))return f.then((u=>(this._params=E,this._data="",this._hitLimit=!1,u)));return this._params=E,this._data="",this._hitLimit=!1,f}}},2015:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.EscapeSequenceParser=f.VT500_TRANSITION_TABLE=f.TransitionTable=void 0;const m=g(844),C=g(8742),b=g(6242),y=g(6351);class a{constructor(u){this.table=new Uint8Array(u)}setDefault(u,f){this.table.fill(u<<4|f)}add(u,f,g,m){this.table[f<<8|u]=g<<4|m}addMany(u,f,g,m){for(let C=0;C<u.length;C++)this.table[f<<8|u[C]]=g<<4|m}}f.TransitionTable=a;const E=160;f.VT500_TRANSITION_TABLE=function(){const u=new a(4095),f=Array.apply(null,Array(256)).map(((u,f)=>f)),i=(u,g)=>f.slice(u,g),g=i(32,127),m=i(0,24);m.push(25),m.push.apply(m,i(28,32));const C=i(0,14);let b;for(b in u.setDefault(1,0),u.addMany(g,0,2,0),C)u.addMany([24,26,153,154],b,3,0),u.addMany(i(128,144),b,3,0),u.addMany(i(144,152),b,3,0),u.add(156,b,0,0),u.add(27,b,11,1),u.add(157,b,4,8),u.addMany([152,158,159],b,0,7),u.add(155,b,11,3),u.add(144,b,11,9);return u.addMany(m,0,3,0),u.addMany(m,1,3,1),u.add(127,1,0,1),u.addMany(m,8,0,8),u.addMany(m,3,3,3),u.add(127,3,0,3),u.addMany(m,4,3,4),u.add(127,4,0,4),u.addMany(m,6,3,6),u.addMany(m,5,3,5),u.add(127,5,0,5),u.addMany(m,2,3,2),u.add(127,2,0,2),u.add(93,1,4,8),u.addMany(g,8,5,8),u.add(127,8,5,8),u.addMany([156,27,24,26,7],8,6,0),u.addMany(i(28,32),8,0,8),u.addMany([88,94,95],1,0,7),u.addMany(g,7,0,7),u.addMany(m,7,0,7),u.add(156,7,0,0),u.add(127,7,0,7),u.add(91,1,11,3),u.addMany(i(64,127),3,7,0),u.addMany(i(48,60),3,8,4),u.addMany([60,61,62,63],3,9,4),u.addMany(i(48,60),4,8,4),u.addMany(i(64,127),4,7,0),u.addMany([60,61,62,63],4,0,6),u.addMany(i(32,64),6,0,6),u.add(127,6,0,6),u.addMany(i(64,127),6,0,0),u.addMany(i(32,48),3,9,5),u.addMany(i(32,48),5,9,5),u.addMany(i(48,64),5,0,6),u.addMany(i(64,127),5,7,0),u.addMany(i(32,48),4,9,5),u.addMany(i(32,48),1,9,2),u.addMany(i(32,48),2,9,2),u.addMany(i(48,127),2,10,0),u.addMany(i(48,80),1,10,0),u.addMany(i(81,88),1,10,0),u.addMany([89,90,92],1,10,0),u.addMany(i(96,127),1,10,0),u.add(80,1,11,9),u.addMany(m,9,0,9),u.add(127,9,0,9),u.addMany(i(28,32),9,0,9),u.addMany(i(32,48),9,9,12),u.addMany(i(48,60),9,8,10),u.addMany([60,61,62,63],9,9,10),u.addMany(m,11,0,11),u.addMany(i(32,128),11,0,11),u.addMany(i(28,32),11,0,11),u.addMany(m,10,0,10),u.add(127,10,0,10),u.addMany(i(28,32),10,0,10),u.addMany(i(48,60),10,8,10),u.addMany([60,61,62,63],10,0,11),u.addMany(i(32,48),10,9,12),u.addMany(m,12,0,12),u.add(127,12,0,12),u.addMany(i(28,32),12,0,12),u.addMany(i(32,48),12,9,12),u.addMany(i(48,64),12,0,11),u.addMany(i(64,127),12,12,13),u.addMany(i(64,127),10,12,13),u.addMany(i(64,127),9,12,13),u.addMany(m,13,13,13),u.addMany(g,13,13,13),u.add(127,13,0,13),u.addMany([27,156,24,26],13,14,0),u.add(E,0,2,0),u.add(E,8,5,8),u.add(E,6,0,6),u.add(E,11,0,11),u.add(E,13,13,13),u}();class c extends m.Disposable{constructor(u=f.VT500_TRANSITION_TABLE){super(),this._transitions=u,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new C.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(u,f,g)=>{},this._executeHandlerFb=u=>{},this._csiHandlerFb=(u,f)=>{},this._escHandlerFb=u=>{},this._errorHandlerFb=u=>u,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,m.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new b.OscParser),this._dcsParser=this.register(new y.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(u,f=[64,126]){let g=0;if(u.prefix){if(u.prefix.length>1)throw new Error("only one byte as prefix supported");if(g=u.prefix.charCodeAt(0),g&&60>g||g>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(u.intermediates){if(u.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let f=0;f<u.intermediates.length;++f){const m=u.intermediates.charCodeAt(f);if(32>m||m>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");g<<=8,g|=m}}if(1!==u.final.length)throw new Error("final must be a single byte");const m=u.final.charCodeAt(0);if(f[0]>m||m>f[1])throw new Error(`final must be in range ${f[0]} .. ${f[1]}`);return g<<=8,g|=m,g}identToString(u){const f=[];for(;u;)f.push(String.fromCharCode(255&u)),u>>=8;return f.reverse().join("")}setPrintHandler(u){this._printHandler=u}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(u,f){const g=this._identifier(u,[48,126]);void 0===this._escHandlers[g]&&(this._escHandlers[g]=[]);const m=this._escHandlers[g];return m.push(f),{dispose:()=>{const u=m.indexOf(f);-1!==u&&m.splice(u,1)}}}clearEscHandler(u){this._escHandlers[this._identifier(u,[48,126])]&&delete this._escHandlers[this._identifier(u,[48,126])]}setEscHandlerFallback(u){this._escHandlerFb=u}setExecuteHandler(u,f){this._executeHandlers[u.charCodeAt(0)]=f}clearExecuteHandler(u){this._executeHandlers[u.charCodeAt(0)]&&delete this._executeHandlers[u.charCodeAt(0)]}setExecuteHandlerFallback(u){this._executeHandlerFb=u}registerCsiHandler(u,f){const g=this._identifier(u);void 0===this._csiHandlers[g]&&(this._csiHandlers[g]=[]);const m=this._csiHandlers[g];return m.push(f),{dispose:()=>{const u=m.indexOf(f);-1!==u&&m.splice(u,1)}}}clearCsiHandler(u){this._csiHandlers[this._identifier(u)]&&delete this._csiHandlers[this._identifier(u)]}setCsiHandlerFallback(u){this._csiHandlerFb=u}registerDcsHandler(u,f){return this._dcsParser.registerHandler(this._identifier(u),f)}clearDcsHandler(u){this._dcsParser.clearHandler(this._identifier(u))}setDcsHandlerFallback(u){this._dcsParser.setHandlerFallback(u)}registerOscHandler(u,f){return this._oscParser.registerHandler(u,f)}clearOscHandler(u){this._oscParser.clearHandler(u)}setOscHandlerFallback(u){this._oscParser.setHandlerFallback(u)}setErrorHandler(u){this._errorHandler=u}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,0!==this._parseStack.state&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(u,f,g,m,C){this._parseStack.state=u,this._parseStack.handlers=f,this._parseStack.handlerPos=g,this._parseStack.transition=m,this._parseStack.chunkPos=C}parse(u,f,g){let m,C=0,b=0,y=0;if(this._parseStack.state)if(2===this._parseStack.state)this._parseStack.state=0,y=this._parseStack.chunkPos+1;else{if(void 0===g||1===this._parseStack.state)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const f=this._parseStack.handlers;let b=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(!1===g&&b>-1)for(;b>=0&&(m=f[b](this._params),!0!==m);b--)if(m instanceof Promise)return this._parseStack.handlerPos=b,m;this._parseStack.handlers=[];break;case 4:if(!1===g&&b>-1)for(;b>=0&&(m=f[b](),!0!==m);b--)if(m instanceof Promise)return this._parseStack.handlerPos=b,m;this._parseStack.handlers=[];break;case 6:if(C=u[this._parseStack.chunkPos],m=this._dcsParser.unhook(24!==C&&26!==C,g),m)return m;27===C&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(C=u[this._parseStack.chunkPos],m=this._oscParser.end(24!==C&&26!==C,g),m)return m;27===C&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,y=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let g=y;g<f;++g){switch(C=u[g],b=this._transitions.table[this.currentState<<8|(C<160?C:E)],b>>4){case 2:for(let m=g+1;;++m){if(m>=f||(C=u[m])<32||C>126&&C<E){this._printHandler(u,g,m),g=m-1;break}if(++m>=f||(C=u[m])<32||C>126&&C<E){this._printHandler(u,g,m),g=m-1;break}if(++m>=f||(C=u[m])<32||C>126&&C<E){this._printHandler(u,g,m),g=m-1;break}if(++m>=f||(C=u[m])<32||C>126&&C<E){this._printHandler(u,g,m),g=m-1;break}}break;case 3:this._executeHandlers[C]?this._executeHandlers[C]():this._executeHandlerFb(C),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:g,code:C,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const y=this._csiHandlers[this._collect<<8|C];let L=y?y.length-1:-1;for(;L>=0&&(m=y[L](this._params),!0!==m);L--)if(m instanceof Promise)return this._preserveStack(3,y,L,b,g),m;L<0&&this._csiHandlerFb(this._collect<<8|C,this._params),this.precedingJoinState=0;break;case 8:do{switch(C){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(C-48)}}while(++g<f&&(C=u[g])>47&&C<60);g--;break;case 9:this._collect<<=8,this._collect|=C;break;case 10:const R=this._escHandlers[this._collect<<8|C];let x=R?R.length-1:-1;for(;x>=0&&(m=R[x](),!0!==m);x--)if(m instanceof Promise)return this._preserveStack(4,R,x,b,g),m;x<0&&this._escHandlerFb(this._collect<<8|C),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|C,this._params);break;case 13:for(let m=g+1;;++m)if(m>=f||24===(C=u[m])||26===C||27===C||C>127&&C<E){this._dcsParser.put(u,g,m),g=m-1;break}break;case 14:if(m=this._dcsParser.unhook(24!==C&&26!==C),m)return this._preserveStack(6,[],0,b,g),m;27===C&&(b|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let m=g+1;;m++)if(m>=f||(C=u[m])<32||C>127&&C<E){this._oscParser.put(u,g,m),g=m-1;break}break;case 6:if(m=this._oscParser.end(24!==C&&26!==C),m)return this._preserveStack(5,[],0,b,g),m;27===C&&(b|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&b}}}f.EscapeSequenceParser=c},6242:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.OscHandler=f.OscParser=void 0;const m=g(5770),C=g(482),b=[];f.OscParser=class{constructor(){this._state=0,this._active=b,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(u,f){void 0===this._handlers[u]&&(this._handlers[u]=[]);const g=this._handlers[u];return g.push(f),{dispose:()=>{const u=g.indexOf(f);-1!==u&&g.splice(u,1)}}}clearHandler(u){this._handlers[u]&&delete this._handlers[u]}setHandlerFallback(u){this._handlerFb=u}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=b}reset(){if(2===this._state)for(let u=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;u>=0;--u)this._active[u].end(!1);this._stack.paused=!1,this._active=b,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||b,this._active.length)for(let u=this._active.length-1;u>=0;u--)this._active[u].start();else this._handlerFb(this._id,"START")}_put(u,f,g){if(this._active.length)for(let m=this._active.length-1;m>=0;m--)this._active[m].put(u,f,g);else this._handlerFb(this._id,"PUT",(0,C.utf32ToString)(u,f,g))}start(){this.reset(),this._state=1}put(u,f,g){if(3!==this._state){if(1===this._state)for(;f<g;){const g=u[f++];if(59===g){this._state=2,this._start();break}if(g<48||57<g)return void(this._state=3);-1===this._id&&(this._id=0),this._id=10*this._id+g-48}2===this._state&&g-f>0&&this._put(u,f,g)}}end(u,f=!0){if(0!==this._state){if(3!==this._state)if(1===this._state&&this._start(),this._active.length){let g=!1,m=this._active.length-1,C=!1;if(this._stack.paused&&(m=this._stack.loopPosition-1,g=f,C=this._stack.fallThrough,this._stack.paused=!1),!C&&!1===g){for(;m>=0&&(g=this._active[m].end(u),!0!==g);m--)if(g instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=m,this._stack.fallThrough=!1,g;m--}for(;m>=0;m--)if(g=this._active[m].end(!1),g instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=m,this._stack.fallThrough=!0,g}else this._handlerFb(this._id,"END",u);this._active=b,this._id=-1,this._state=0}}},f.OscHandler=class{constructor(u){this._handler=u,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(u,f,g){this._hitLimit||(this._data+=(0,C.utf32ToString)(u,f,g),this._data.length>m.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(u){let f=!1;if(this._hitLimit)f=!1;else if(u&&(f=this._handler(this._data),f instanceof Promise))return f.then((u=>(this._data="",this._hitLimit=!1,u)));return this._data="",this._hitLimit=!1,f}}},8742:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Params=void 0;const g=2147483647;class s{static fromArray(u){const f=new s;if(!u.length)return f;for(let g=Array.isArray(u[0])?1:0;g<u.length;++g){const m=u[g];if(Array.isArray(m))for(let u=0;u<m.length;++u)f.addSubParam(m[u]);else f.addParam(m)}return f}constructor(u=32,f=32){if(this.maxLength=u,this.maxSubParamsLength=f,f>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(u),this.length=0,this._subParams=new Int32Array(f),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(u),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const u=new s(this.maxLength,this.maxSubParamsLength);return u.params.set(this.params),u.length=this.length,u._subParams.set(this._subParams),u._subParamsLength=this._subParamsLength,u._subParamsIdx.set(this._subParamsIdx),u._rejectDigits=this._rejectDigits,u._rejectSubDigits=this._rejectSubDigits,u._digitIsSub=this._digitIsSub,u}toArray(){const u=[];for(let f=0;f<this.length;++f){u.push(this.params[f]);const g=this._subParamsIdx[f]>>8,m=255&this._subParamsIdx[f];m-g>0&&u.push(Array.prototype.slice.call(this._subParams,g,m))}return u}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(u){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(u<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=u>g?g:u}}addSubParam(u){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(u<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=u>g?g:u,this._subParamsIdx[this.length-1]++}}hasSubParams(u){return(255&this._subParamsIdx[u])-(this._subParamsIdx[u]>>8)>0}getSubParams(u){const f=this._subParamsIdx[u]>>8,g=255&this._subParamsIdx[u];return g-f>0?this._subParams.subarray(f,g):null}getSubParamsAll(){const u={};for(let f=0;f<this.length;++f){const g=this._subParamsIdx[f]>>8,m=255&this._subParamsIdx[f];m-g>0&&(u[f]=this._subParams.slice(g,m))}return u}addDigit(u){let f;if(this._rejectDigits||!(f=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const m=this._digitIsSub?this._subParams:this.params,C=m[f-1];m[f-1]=~C?Math.min(10*C+u,g):u}}f.Params=s},5741:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.AddonManager=void 0,f.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let u=this._addons.length-1;u>=0;u--)this._addons[u].instance.dispose()}loadAddon(u,f){const g={instance:f,dispose:f.dispose,isDisposed:!1};this._addons.push(g),f.dispose=()=>this._wrappedAddonDispose(g),f.activate(u)}_wrappedAddonDispose(u){if(u.isDisposed)return;let f=-1;for(let g=0;g<this._addons.length;g++)if(this._addons[g]===u){f=g;break}if(-1===f)throw new Error("Could not dispose an addon that has not been loaded");u.isDisposed=!0,u.dispose.apply(u.instance),this._addons.splice(f,1)}}},8771:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.BufferApiView=void 0;const m=g(3785),C=g(511);f.BufferApiView=class{constructor(u,f){this._buffer=u,this.type=f}init(u){return this._buffer=u,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(u){const f=this._buffer.lines.get(u);if(f)return new m.BufferLineApiView(f)}getNullCell(){return new C.CellData}}},3785:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.BufferLineApiView=void 0;const m=g(511);f.BufferLineApiView=class{constructor(u){this._line=u}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(u,f){if(!(u<0||u>=this._line.length))return f?(this._line.loadCell(u,f),f):this._line.loadCell(u,new m.CellData)}translateToString(u,f,g){return this._line.translateToString(u,f,g)}}},8285:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.BufferNamespaceApi=void 0;const m=g(8771),C=g(8460),b=g(844);class o extends b.Disposable{constructor(u){super(),this._core=u,this._onBufferChange=this.register(new C.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new m.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new m.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}f.BufferNamespaceApi=o},7975:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.ParserApi=void 0,f.ParserApi=class{constructor(u){this._core=u}registerCsiHandler(u,f){return this._core.registerCsiHandler(u,(u=>f(u.toArray())))}addCsiHandler(u,f){return this.registerCsiHandler(u,f)}registerDcsHandler(u,f){return this._core.registerDcsHandler(u,((u,g)=>f(u,g.toArray())))}addDcsHandler(u,f){return this.registerDcsHandler(u,f)}registerEscHandler(u,f){return this._core.registerEscHandler(u,f)}addEscHandler(u,f){return this.registerEscHandler(u,f)}registerOscHandler(u,f){return this._core.registerOscHandler(u,f)}addOscHandler(u,f){return this.registerOscHandler(u,f)}}},7090:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.UnicodeApi=void 0,f.UnicodeApi=class{constructor(u){this._core=u}register(u){this._core.unicodeService.register(u)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(u){this._core.unicodeService.activeVersion=u}}},744:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.BufferService=g.MINIMUM_ROWS=g.MINIMUM_COLS=void 0;const y=m(8460),E=m(844),L=m(5295),R=m(2585);g.MINIMUM_COLS=2,g.MINIMUM_ROWS=1;let x=g.BufferService=class extends E.Disposable{get buffer(){return this.buffers.active}constructor(u){super(),this.isUserScrolling=!1,this._onResize=this.register(new y.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new y.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(u.rawOptions.cols||0,g.MINIMUM_COLS),this.rows=Math.max(u.rawOptions.rows||0,g.MINIMUM_ROWS),this.buffers=this.register(new L.BufferSet(u,this))}resize(u,f){this.cols=u,this.rows=f,this.buffers.resize(u,f),this._onResize.fire({cols:u,rows:f})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(u,f=!1){const g=this.buffer;let m;m=this._cachedBlankLine,m&&m.length===this.cols&&m.getFg(0)===u.fg&&m.getBg(0)===u.bg||(m=g.getBlankLine(u,f),this._cachedBlankLine=m),m.isWrapped=f;const C=g.ybase+g.scrollTop,b=g.ybase+g.scrollBottom;if(0===g.scrollTop){const u=g.lines.isFull;b===g.lines.length-1?u?g.lines.recycle().copyFrom(m):g.lines.push(m.clone()):g.lines.splice(b+1,0,m.clone()),u?this.isUserScrolling&&(g.ydisp=Math.max(g.ydisp-1,0)):(g.ybase++,this.isUserScrolling||g.ydisp++)}else{const u=b-C+1;g.lines.shiftElements(C+1,u-1,-1),g.lines.set(b,m.clone())}this.isUserScrolling||(g.ydisp=g.ybase),this._onScroll.fire(g.ydisp)}scrollLines(u,f,g){const m=this.buffer;if(u<0){if(0===m.ydisp)return;this.isUserScrolling=!0}else u+m.ydisp>=m.ybase&&(this.isUserScrolling=!1);const C=m.ydisp;m.ydisp=Math.max(Math.min(m.ydisp+u,m.ybase),0),C!==m.ydisp&&(f||this._onScroll.fire(m.ydisp))}};g.BufferService=x=C([b(0,R.IOptionsService)],x)},7994:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.CharsetService=void 0,f.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(u){this.glevel=u,this.charset=this._charsets[u]}setgCharset(u,f){this._charsets[u]=f,this.glevel===u&&(this.charset=f)}}},1753:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.CoreMouseService=void 0;const y=m(2585),E=m(8460),L=m(844),R={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:u=>4!==u.button&&1===u.action&&(u.ctrl=!1,u.alt=!1,u.shift=!1,!0)},VT200:{events:19,restrict:u=>32!==u.action},DRAG:{events:23,restrict:u=>32!==u.action||3!==u.button},ANY:{events:31,restrict:u=>!0}};function c(u,f){let g=(u.ctrl?16:0)|(u.shift?4:0)|(u.alt?8:0);return 4===u.button?(g|=64,g|=u.action):(g|=3&u.button,4&u.button&&(g|=64),8&u.button&&(g|=128),32===u.action?g|=32:0!==u.action||f||(g|=3)),g}const x=String.fromCharCode,A={DEFAULT:u=>{const f=[c(u,!1)+32,u.col+32,u.row+32];return f[0]>255||f[1]>255||f[2]>255?"":`[M${x(f[0])}${x(f[1])}${x(f[2])}`},SGR:u=>{const f=0===u.action&&4!==u.button?"m":"M";return`[<${c(u,!0)};${u.col};${u.row}${f}`},SGR_PIXELS:u=>{const f=0===u.action&&4!==u.button?"m":"M";return`[<${c(u,!0)};${u.x};${u.y}${f}`}};let B=g.CoreMouseService=class extends L.Disposable{constructor(u,f){super(),this._bufferService=u,this._coreService=f,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new E.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const u of Object.keys(R))this.addProtocol(u,R[u]);for(const u of Object.keys(A))this.addEncoding(u,A[u]);this.reset()}addProtocol(u,f){this._protocols[u]=f}addEncoding(u,f){this._encodings[u]=f}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return 0!==this._protocols[this._activeProtocol].events}set activeProtocol(u){if(!this._protocols[u])throw new Error(`unknown protocol "${u}"`);this._activeProtocol=u,this._onProtocolChange.fire(this._protocols[u].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(u){if(!this._encodings[u])throw new Error(`unknown encoding "${u}"`);this._activeEncoding=u}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(u){if(u.col<0||u.col>=this._bufferService.cols||u.row<0||u.row>=this._bufferService.rows)return!1;if(4===u.button&&32===u.action)return!1;if(3===u.button&&32!==u.action)return!1;if(4!==u.button&&(2===u.action||3===u.action))return!1;if(u.col++,u.row++,32===u.action&&this._lastEvent&&this._equalEvents(this._lastEvent,u,"SGR_PIXELS"===this._activeEncoding))return!1;if(!this._protocols[this._activeProtocol].restrict(u))return!1;const f=this._encodings[this._activeEncoding](u);return f&&("DEFAULT"===this._activeEncoding?this._coreService.triggerBinaryEvent(f):this._coreService.triggerDataEvent(f,!0)),this._lastEvent=u,!0}explainEvents(u){return{down:!!(1&u),up:!!(2&u),drag:!!(4&u),move:!!(8&u),wheel:!!(16&u)}}_equalEvents(u,f,g){if(g){if(u.x!==f.x)return!1;if(u.y!==f.y)return!1}else{if(u.col!==f.col)return!1;if(u.row!==f.row)return!1}return u.button===f.button&&u.action===f.action&&u.ctrl===f.ctrl&&u.alt===f.alt&&u.shift===f.shift}};g.CoreMouseService=B=C([b(0,y.IBufferService),b(1,y.ICoreService)],B)},6975:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.CoreService=void 0;const y=m(1439),E=m(8460),L=m(844),R=m(2585),x=Object.freeze({insertMode:!1}),A=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let B=g.CoreService=class extends L.Disposable{constructor(u,f,g){super(),this._bufferService=u,this._logService=f,this._optionsService=g,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new E.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new E.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new E.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new E.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,y.clone)(x),this.decPrivateModes=(0,y.clone)(A)}reset(){this.modes=(0,y.clone)(x),this.decPrivateModes=(0,y.clone)(A)}triggerDataEvent(u,f=!1){if(this._optionsService.rawOptions.disableStdin)return;const g=this._bufferService.buffer;f&&this._optionsService.rawOptions.scrollOnUserInput&&g.ybase!==g.ydisp&&this._onRequestScrollToBottom.fire(),f&&this._onUserInput.fire(),this._logService.debug(`sending data "${u}"`,(()=>u.split("").map((u=>u.charCodeAt(0))))),this._onData.fire(u)}triggerBinaryEvent(u){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${u}"`,(()=>u.split("").map((u=>u.charCodeAt(0))))),this._onBinary.fire(u))}};g.CoreService=B=C([b(0,R.IBufferService),b(1,R.ILogService),b(2,R.IOptionsService)],B)},9074:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DecorationService=void 0;const m=g(8055),C=g(8460),b=g(844),y=g(6106);let E=0,L=0;class c extends b.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new y.SortedList((u=>u?.marker.line)),this._onDecorationRegistered=this.register(new C.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new C.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,b.toDisposable)((()=>this.reset())))}registerDecoration(u){if(u.marker.isDisposed)return;const f=new l(u);if(f){const u=f.marker.onDispose((()=>f.dispose()));f.onDispose((()=>{f&&(this._decorations.delete(f)&&this._onDecorationRemoved.fire(f),u.dispose())})),this._decorations.insert(f),this._onDecorationRegistered.fire(f)}return f}reset(){for(const u of this._decorations.values())u.dispose();this._decorations.clear()}*getDecorationsAtCell(u,f,g){let m=0,C=0;for(const b of this._decorations.getKeyIterator(f))m=b.options.x??0,C=m+(b.options.width??1),u>=m&&u<C&&(!g||(b.options.layer??"bottom")===g)&&(yield b)}forEachDecorationAtCell(u,f,g,m){this._decorations.forEachByKey(f,(f=>{E=f.options.x??0,L=E+(f.options.width??1),u>=E&&u<L&&(!g||(f.options.layer??"bottom")===g)&&m(f)}))}}f.DecorationService=c;class l extends b.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return null===this._cachedBg&&(this.options.backgroundColor?this._cachedBg=m.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return null===this._cachedFg&&(this.options.foregroundColor?this._cachedFg=m.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(u){super(),this.options=u,this.onRenderEmitter=this.register(new C.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new C.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=u.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.InstantiationService=f.ServiceCollection=void 0;const m=g(2585),C=g(8343);class n{constructor(...u){this._entries=new Map;for(const[f,g]of u)this.set(f,g)}set(u,f){const g=this._entries.get(u);return this._entries.set(u,f),g}forEach(u){for(const[f,g]of this._entries.entries())u(f,g)}has(u){return this._entries.has(u)}get(u){return this._entries.get(u)}}f.ServiceCollection=n,f.InstantiationService=class{constructor(){this._services=new n,this._services.set(m.IInstantiationService,this)}setService(u,f){this._services.set(u,f)}getService(u){return this._services.get(u)}createInstance(u,...f){const g=(0,C.getServiceDependencies)(u).sort(((u,f)=>u.index-f.index)),m=[];for(const f of g){const g=this._services.get(f.id);if(!g)throw new Error(`[createInstance] ${u.name} depends on UNKNOWN service ${f.id}.`);m.push(g)}const b=g.length>0?g[0].index:f.length;if(f.length!==b)throw new Error(`[createInstance] First service dependency of ${u.name} at position ${b+1} conflicts with ${f.length} static arguments`);return new u(...[...f,...m])}}},7866:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.traceCall=g.setTraceLogger=g.LogService=void 0;const y=m(844),E=m(2585),L={trace:E.LogLevelEnum.TRACE,debug:E.LogLevelEnum.DEBUG,info:E.LogLevelEnum.INFO,warn:E.LogLevelEnum.WARN,error:E.LogLevelEnum.ERROR,off:E.LogLevelEnum.OFF};let R,x=g.LogService=class extends y.Disposable{get logLevel(){return this._logLevel}constructor(u){super(),this._optionsService=u,this._logLevel=E.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),R=this}_updateLogLevel(){this._logLevel=L[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(u){for(let f=0;f<u.length;f++)"function"==typeof u[f]&&(u[f]=u[f]())}_log(u,f,g){this._evalLazyOptionalParams(g),u.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+f,...g)}trace(u,...f){this._logLevel<=E.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,u,f)}debug(u,...f){this._logLevel<=E.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,u,f)}info(u,...f){this._logLevel<=E.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,u,f)}warn(u,...f){this._logLevel<=E.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,u,f)}error(u,...f){this._logLevel<=E.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,u,f)}};g.LogService=x=C([b(0,E.IOptionsService)],x),g.setTraceLogger=function(u){R=u},g.traceCall=function(f,g,m){if("function"!=typeof m.value)throw new Error("not supported");const C=m.value;m.value=function(...f){if(R.logLevel!==E.LogLevelEnum.TRACE)return C.apply(this||u,f);R.trace(`GlyphRenderer#${C.name}(${f.map((u=>JSON.stringify(u))).join(", ")})`);const g=C.apply(this||u,f);return R.trace(`GlyphRenderer#${C.name} return`,g),g}}},7302:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.OptionsService=f.DEFAULT_OPTIONS=void 0;const m=g(8460),C=g(844),b=g(6114);f.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:b.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const y=["normal","bold","100","200","300","400","500","600","700","800","900"];class a extends C.Disposable{constructor(u){super(),this._onOptionChange=this.register(new m.EventEmitter),this.onOptionChange=this._onOptionChange.event;const g={...f.DEFAULT_OPTIONS};for(const f in u)if(f in g)try{const m=u[f];g[f]=this._sanitizeAndValidateOption(f,m)}catch(u){console.error(u)}this.rawOptions=g,this.options={...g},this._setupOptions(),this.register((0,C.toDisposable)((()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null})))}onSpecificOptionChange(u,f){return this.onOptionChange((g=>{g===u&&f(this.rawOptions[u])}))}onMultipleOptionChange(u,f){return this.onOptionChange((g=>{-1!==u.indexOf(g)&&f()}))}_setupOptions(){const e=u=>{if(!(u in f.DEFAULT_OPTIONS))throw new Error(`No option with key "${u}"`);return this.rawOptions[u]},i=(u,g)=>{if(!(u in f.DEFAULT_OPTIONS))throw new Error(`No option with key "${u}"`);g=this._sanitizeAndValidateOption(u,g),this.rawOptions[u]!==g&&(this.rawOptions[u]=g,this._onOptionChange.fire(u))};for(const u in this.rawOptions){const f={get:e.bind(this,u),set:i.bind(this,u)};Object.defineProperty(this.options,u,f)}}_sanitizeAndValidateOption(u,g){switch(u){case"cursorStyle":if(g||(g=f.DEFAULT_OPTIONS[u]),!function(u){return"block"===u||"underline"===u||"bar"===u}(g))throw new Error(`"${g}" is not a valid value for ${u}`);break;case"wordSeparator":g||(g=f.DEFAULT_OPTIONS[u]);break;case"fontWeight":case"fontWeightBold":if("number"==typeof g&&1<=g&&g<=1e3)break;g=y.includes(g)?g:f.DEFAULT_OPTIONS[u];break;case"cursorWidth":g=Math.floor(g);case"lineHeight":case"tabStopWidth":if(g<1)throw new Error(`${u} cannot be less than 1, value: ${g}`);break;case"minimumContrastRatio":g=Math.max(1,Math.min(21,Math.round(10*g)/10));break;case"scrollback":if((g=Math.min(g,4294967295))<0)throw new Error(`${u} cannot be less than 0, value: ${g}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(g<=0)throw new Error(`${u} cannot be less than or equal to 0, value: ${g}`);break;case"rows":case"cols":if(!g&&0!==g)throw new Error(`${u} must be numeric, value: ${g}`);break;case"windowsPty":g=g??{}}return g}}f.OptionsService=a},2660:function(f,g,m){var C=(this||u)&&(this||u).__decorate||function(u,f,g,m){var C,b=arguments.length,y=b<3?f:null===m?m=Object.getOwnPropertyDescriptor(f,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)y=Reflect.decorate(u,f,g,m);else for(var E=u.length-1;E>=0;E--)(C=u[E])&&(y=(b<3?C(y):b>3?C(f,g,y):C(f,g))||y);return b>3&&y&&Object.defineProperty(f,g,y),y},b=(this||u)&&(this||u).__param||function(u,f){return function(g,m){f(g,m,u)}};Object.defineProperty(g,"__esModule",{value:!0}),g.OscLinkService=void 0;const y=m(2585);let E=g.OscLinkService=class{constructor(u){this._bufferService=u,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(u){const f=this._bufferService.buffer;if(void 0===u.id){const g=f.addMarker(f.ybase+f.y),m={data:u,id:this._nextId++,lines:[g]};return g.onDispose((()=>this._removeMarkerFromLink(m,g))),this._dataByLinkId.set(m.id,m),m.id}const g=u,m=this._getEntryIdKey(g),C=this._entriesWithId.get(m);if(C)return this.addLineToLink(C.id,f.ybase+f.y),C.id;const b=f.addMarker(f.ybase+f.y),y={id:this._nextId++,key:this._getEntryIdKey(g),data:g,lines:[b]};return b.onDispose((()=>this._removeMarkerFromLink(y,b))),this._entriesWithId.set(y.key,y),this._dataByLinkId.set(y.id,y),y.id}addLineToLink(u,f){const g=this._dataByLinkId.get(u);if(g&&g.lines.every((u=>u.line!==f))){const u=this._bufferService.buffer.addMarker(f);g.lines.push(u),u.onDispose((()=>this._removeMarkerFromLink(g,u)))}}getLinkData(u){return this._dataByLinkId.get(u)?.data}_getEntryIdKey(u){return`${u.id};;${u.uri}`}_removeMarkerFromLink(u,f){const g=u.lines.indexOf(f);-1!==g&&(u.lines.splice(g,1),0===u.lines.length&&(void 0!==u.data.id&&this._entriesWithId.delete(u.key),this._dataByLinkId.delete(u.id)))}};g.OscLinkService=E=C([b(0,y.IBufferService)],E)},8343:(u,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.createDecorator=f.getServiceDependencies=f.serviceRegistry=void 0;const g="di$target",m="di$dependencies";f.serviceRegistry=new Map,f.getServiceDependencies=function(u){return u[m]||[]},f.createDecorator=function(u){if(f.serviceRegistry.has(u))return f.serviceRegistry.get(u);const r=function(u,f,C){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");!function(u,f,C){f[g]===f?f[m].push({id:u,index:C}):(f[m]=[{id:u,index:C}],f[g]=f)}(r,u,C)};return r.toString=()=>u,f.serviceRegistry.set(u,r),r}},2585:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.IDecorationService=f.IUnicodeService=f.IOscLinkService=f.IOptionsService=f.ILogService=f.LogLevelEnum=f.IInstantiationService=f.ICharsetService=f.ICoreService=f.ICoreMouseService=f.IBufferService=void 0;const m=g(8343);var C;f.IBufferService=(0,m.createDecorator)("BufferService"),f.ICoreMouseService=(0,m.createDecorator)("CoreMouseService"),f.ICoreService=(0,m.createDecorator)("CoreService"),f.ICharsetService=(0,m.createDecorator)("CharsetService"),f.IInstantiationService=(0,m.createDecorator)("InstantiationService"),function(u){u[u.TRACE=0]="TRACE",u[u.DEBUG=1]="DEBUG",u[u.INFO=2]="INFO",u[u.WARN=3]="WARN",u[u.ERROR=4]="ERROR",u[u.OFF=5]="OFF"}(C||(f.LogLevelEnum=C={})),f.ILogService=(0,m.createDecorator)("LogService"),f.IOptionsService=(0,m.createDecorator)("OptionsService"),f.IOscLinkService=(0,m.createDecorator)("OscLinkService"),f.IUnicodeService=(0,m.createDecorator)("UnicodeService"),f.IDecorationService=(0,m.createDecorator)("DecorationService")},1480:(u,f,g)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.UnicodeService=void 0;const m=g(8460),C=g(225);class n{static extractShouldJoin(u){return 0!=(1&u)}static extractWidth(u){return u>>1&3}static extractCharKind(u){return u>>3}static createPropertyValue(u,f,g=!1){return(16777215&u)<<3|(3&f)<<1|(g?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new m.EventEmitter,this.onChange=this._onChange.event;const u=new C.UnicodeV6;this.register(u),this._active=u.version,this._activeProvider=u}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(u){if(!this._providers[u])throw new Error(`unknown Unicode version "${u}"`);this._active=u,this._activeProvider=this._providers[u],this._onChange.fire(u)}register(u){this._providers[u.version]=u}wcwidth(u){return this._activeProvider.wcwidth(u)}getStringCellWidth(u){let f=0,g=0;const m=u.length;for(let C=0;C<m;++C){let b=u.charCodeAt(C);if(55296<=b&&b<=56319){if(++C>=m)return f+this.wcwidth(b);const g=u.charCodeAt(C);56320<=g&&g<=57343?b=1024*(b-55296)+g-56320+65536:f+=this.wcwidth(g)}const y=this.charProperties(b,g);let E=n.extractWidth(y);n.extractShouldJoin(y)&&(E-=n.extractWidth(g)),f+=E,g=y}return f}charProperties(u,f){return this._activeProvider.charProperties(u,f)}}f.UnicodeService=n}},g={};function i(u){var m=g[u];if(void 0!==m)return m.exports;var C=g[u]={exports:{}};return f[u].call(C.exports,C,C.exports,i),C.exports}var m={};return(()=>{var u=m;Object.defineProperty(u,"__esModule",{value:!0}),u.Terminal=void 0;const f=i(9042),g=i(3236),C=i(844),b=i(5741),y=i(8285),E=i(7975),L=i(7090),R=["cols","rows"];class d extends C.Disposable{constructor(u){super(),this._core=this.register(new g.Terminal(u)),this._addonManager=this.register(new b.AddonManager),this._publicOptions={...this._core.options};const t=u=>this._core.options[u],i=(u,f)=>{this._checkReadonlyOptions(u),this._core.options[u]=f};for(const u in this._core.options){const f={get:t.bind(this,u),set:i.bind(this,u)};Object.defineProperty(this._publicOptions,u,f)}}_checkReadonlyOptions(u){if(R.includes(u))throw new Error(`Option "${u}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new E.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new L.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new y.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const u=this._core.coreService.decPrivateModes;let f="none";switch(this._core.coreMouseService.activeProtocol){case"X10":f="x10";break;case"VT200":f="vt200";break;case"DRAG":f="drag";break;case"ANY":f="any"}return{applicationCursorKeysMode:u.applicationCursorKeys,applicationKeypadMode:u.applicationKeypad,bracketedPasteMode:u.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:f,originMode:u.origin,reverseWraparoundMode:u.reverseWraparound,sendFocusMode:u.sendFocus,wraparoundMode:u.wraparound}}get options(){return this._publicOptions}set options(u){for(const f in u)this._publicOptions[f]=u[f]}blur(){this._core.blur()}focus(){this._core.focus()}input(u,f=!0){this._core.input(u,f)}resize(u,f){this._verifyIntegers(u,f),this._core.resize(u,f)}open(u){this._core.open(u)}attachCustomKeyEventHandler(u){this._core.attachCustomKeyEventHandler(u)}attachCustomWheelEventHandler(u){this._core.attachCustomWheelEventHandler(u)}registerLinkProvider(u){return this._core.registerLinkProvider(u)}registerCharacterJoiner(u){return this._checkProposedApi(),this._core.registerCharacterJoiner(u)}deregisterCharacterJoiner(u){this._checkProposedApi(),this._core.deregisterCharacterJoiner(u)}registerMarker(u=0){return this._verifyIntegers(u),this._core.registerMarker(u)}registerDecoration(u){return this._checkProposedApi(),this._verifyPositiveIntegers(u.x??0,u.width??0,u.height??0),this._core.registerDecoration(u)}hasSelection(){return this._core.hasSelection()}select(u,f,g){this._verifyIntegers(u,f,g),this._core.select(u,f,g)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(u,f){this._verifyIntegers(u,f),this._core.selectLines(u,f)}dispose(){super.dispose()}scrollLines(u){this._verifyIntegers(u),this._core.scrollLines(u)}scrollPages(u){this._verifyIntegers(u),this._core.scrollPages(u)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(u){this._verifyIntegers(u),this._core.scrollToLine(u)}clear(){this._core.clear()}write(u,f){this._core.write(u,f)}writeln(u,f){this._core.write(u),this._core.write("\r\n",f)}paste(u){this._core.paste(u)}refresh(u,f){this._verifyIntegers(u,f),this._core.refresh(u,f)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(u){this._addonManager.loadAddon(this,u)}static get strings(){return f}_verifyIntegers(...u){for(const f of u)if(f===1/0||isNaN(f)||f%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...u){for(const f of u)if(f&&(f===1/0||isNaN(f)||f%1!=0||f<0))throw new Error("This API only accepts positive integers")}}u.Terminal=d})(),m})()));var g=f;export{g as default};

