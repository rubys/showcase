<div class="my-5" id="questions-section">
  <% applicable_questions = @person.applicable_questions %>
  <% if applicable_questions.any? %>
    <h3 class="font-bold text-xl mb-4">Questions</h3>

    <% applicable_questions.each do |question| %>
      <% existing_answer = @person.answers.find_by(question_id: question.id) %>
      <% answer_index = existing_answer&.id || "new_#{question.id}" %>

      <div class="my-4">
        <%= form.fields_for :answers, existing_answer || @person.answers.build(question: question) do |answer_form| %>
          <%= answer_form.hidden_field :question_id, value: question.id %>

          <label class="block font-medium mb-2"><%= question.question_text %></label>

          <% if question.question_type == 'radio' %>
            <div class="space-y-2">
              <% question.choices.each do |choice| %>
                <label class="flex items-center">
                  <%= answer_form.radio_button :answer_value, choice,
                    checked: existing_answer&.answer_value == choice,
                    class: "mr-2" %>
                  <%= choice %>
                </label>
              <% end %>
            </div>
          <% else %>
            <%= answer_form.text_area :answer_value,
              rows: 3,
              placeholder: "Enter your answer...",
              class: "block shadow rounded-md border border-gray-200 outline-none px-3 py-2 mt-2 w-full" %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>
