<div class="w-full mx-auto">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-lg inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div data-controller="info-box">
    <div class="info-button">&#x24D8;</div>
    <ul class="info-box">
      <li>This page summarizes all responses to custom questions associated with optional packages and add-ons.
      <li>Questions are organized by the option they're associated with (meals, social events, special packages, etc.).
      <li>Each question shows a table with person name, studio, and their answer.
      <li><strong>Gray italicized text</strong>: "No answer provided" means the person selected the option but didn't answer the question.
      <li>Click on a person's name to view their full profile and edit their information.
      <li>Questions can be added or edited from the <%= link_to 'Billables/Options page', billables_path, class: "text-blue-600 underline" %> in Settings â†’ Prices.
      <li>Use "Download PDF Report" to generate a printable version for event planning (e.g., meal counts, T-shirt sizes, dietary restrictions).
      <li>This helps track participant preferences and logistical needs for your event.
    </ul>
  </div>

  <h1 class="text-center font-bold text-4xl mb-4">Question Answers Summary</h1>

  <% if @options_with_questions.empty? %>
    <p class="text-center mt-8">No questions have been defined yet.</p>
    <p class="text-center mt-4">
      To add questions, edit an <%= link_to 'option', billables_path, class: "text-blue-600 underline" %>
      and add questions in the "Questions for this option" section.
    </p>
  <% else %>
    <% @answer_data.each do |option, questions_hash| %>
      <div class="mt-8 mb-12">
        <h2 class="font-bold text-2xl mb-4"><%= option.name %></h2>

        <% questions_hash.each do |question, answers| %>
          <div class="mb-6">
            <h3 class="font-semibold text-xl mb-3"><%= question.question_text %></h3>

            <% if answers.any? %>
              <table class="table-auto mx-auto w-full max-w-4xl border-collapse">
                <thead>
                  <tr class="bg-gray-100">
                    <th class="border border-gray-300 px-4 py-2 text-left">Person</th>
                    <th class="border border-gray-300 px-4 py-2 text-left">Studio</th>
                    <th class="border border-gray-300 px-4 py-2 text-left">Answer</th>
                  </tr>
                </thead>
                <tbody>
                  <% answers.each do |answer| %>
                    <tr>
                      <td class="border border-gray-300 px-4 py-2">
                        <%= link_to answer.person.name, answer.person, class: "text-blue-600 hover:underline" %>
                      </td>
                      <td class="border border-gray-300 px-4 py-2">
                        <%= answer.person.studio&.name || 'N/A' %>
                      </td>
                      <td class="border border-gray-300 px-4 py-2">
                        <% if answer.answer_value.present? %>
                          <%= answer.answer_value %>
                        <% else %>
                          <span class="text-gray-400 italic">No answer provided</span>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            <% else %>
              <p class="text-gray-500 italic ml-4">No answers yet for this question.</p>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>

    <div class="mt-8 text-center">
      <%= link_to "Download PDF Report", report_answers_path(format: :pdf),
          class: "inline-block px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium" %>
    </div>
  <% end %>
</div>
